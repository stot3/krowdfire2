app.controller("CreatorInviteCtrl",["$scope","$location","UserService","CreatorInviteService","CreateCampaignService","$routeParams",function($scope,$location,UserService,CreatorInviteService,CreateCampaignService,$routeParams){$scope.emails={},$scope.campaign_id=$routeParams.campaign_id,$scope.loading=!1,$scope.inviteesTables=[],$scope.campaignInvitees=[],$scope.campaignInviteesLen=$scope.campaignInvitees.length,$scope.campaign_pathname="",$("#invitedParticipants").progress({total:6,text:{active:"{value} invited participants",success:"{total} invited particpants"}}),UserService.isLoggedIn()||$location.path("login"),CreateCampaignService.load($routeParams.campaign_id).then(data=>($scope.campaign_name=data.name,$scope.campaign_pathname=data.uri_paths[0].path.split("/").pop(),UserService.getProfile().then(profile=>{const inviterInformation=profile.data.info.invitedFundraisers,successAndInsurancePolicy=profile.data.info.campaignSuccess,campaignInvitees=profile.data.info[data.name+"_invitees"],pickSixComplete=profile.data.info["congratulationsPickSixComplete_"+$routeParams.campaign_id],userPaid=profile.data.info.paid;if(null!=userPaid&&!0!==userPaid&&$location.path(""),void 0!==inviterInformation)for(let email in inviterInformation)if(email.startsWith($routeParams.campaign_id+"_"))if(2===email.split("_").length){const campaignEmail=email.split("_")[1];$scope.inviteesTables.push({email:campaignEmail,status:inviterInformation[email].status,dateAdded:inviterInformation[email].dateAdded})}else{const campaignEmail=email.split("_")[1];$scope.campaignInvitees.push({email:campaignEmail,status:inviterInformation[email].status,dateAdded:inviterInformation[email].dateAdded}),$scope.campaignInviteesLen+=1}if(void 0!==campaignInvitees)for(let email in campaignInvitees)$scope.campaignInvitees.push({email:email,status:inviterInformation[email].status,dateAdded:inviterInformation[email].dateAdded});void 0===successAndInsurancePolicy&&$scope.successAndInsurancePolicyGuard(),null!=pickSixComplete&&!0===pickSixComplete&&$scope.openCompleteSubmit()}).catch(err=>{console.error(err)}))).catch(error=>{console.error(error)}),$scope.sendEmails=function(emails){let sendObj=emails;if(sendObj.campaign_id=$routeParams.campaign_id,sendObj.campaign_name=$scope.campaign_pathname,sendObj.campaign_owner_name=`${UserService.first_name} ${UserService.last_name}`,$scope.loading="Saving Participants","Saving Participants"===$scope.loading)return UserService.getPaidStatus(UserService.email).then(response=>(sendObj.uid=response.data.info.id,CreatorInviteService.sendEmails(sendObj).then(invitationResponse=>{"email/successfulSend"===invitationResponse.data.info.code&&$("#invitedParticipants").progress("increment",parseInt(invitationResponse.data.info.successfulSends)),$scope.loading=!1,$scope.inviteesTables=[],$scope.campaignInvitees=[];const invited=invitationResponse.data.info.invitedFundraisers;invitationResponse.data.first_time;for(let email in invited)if(email.startsWith($routeParams.campaign_id+"_"))if(2===email.split("_").length){const campaignEmail=email.split("_")[1];$scope.inviteesTables.push({email:campaignEmail,status:invited[email].status,dateAdded:invited[email].dateAdded})}else{const campaignEmail=email.split("_")[1];$scope.campaignInvitees.push({email:campaignEmail,status:invited[email].status,dateAdded:invited[email].dateAdded}),$scope.campaignInviteesLen+=1}}).catch(err=>{console.error(err)}))).catch(err=>{console.error(err)})},$scope.removeInviter=function(idx){},$scope.resendInvitation=function(){},$scope.removeFromInviteesTable=function(idx,uid){$scope.loading="loading";let objCopy={};const arrCopy=[...$scope.inviteesTables];arrCopy.splice(idx,1);for(let email of arrCopy)void 0===objCopy[email.email]&&(objCopy[email.email]=email);return UserService.updateInvitees(objCopy,uid).then(invitees=>{$scope.inviteesTables=[];const invitedFundraisers=invitees.data.emails;for(let email in invitedFundraisers)if(email.startsWith($routeParams.campaign_id+"_")){const campaignEmail=email.split("_")[1];$scope.campaignInvitees.push({email:campaignEmail,status:invitedFundraisers[email].status,dateAdded:invitedFundraisers[email].dateAdded})}else $scope.inviteesTables.push({email:email,status:invitedFundraisers[email].status,dateAdded:invitedFundraisers[email].dateAdded});$scope.loading=!1})},$scope.successAndInsurancePolicyGuard=function(){$("#completeSuccessWorkshop.ui.modal").modal("show")},$scope.openPickSixModal=function(){$("#pickSixModal.ui.modal").modal("show")},$scope.closePickSixModal=function(){$("#pickSixModal.ui.modal").modal("hide")},$scope.openCompleteSubmit=function(){$("#completeSubmit.ui.modal").modal("show")},$scope.closeCompleteSubmit=function(){$("#completeSubmit.ui.modal").modal("hide")}}]);