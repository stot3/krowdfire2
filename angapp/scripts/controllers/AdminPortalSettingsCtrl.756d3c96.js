app.controller("AdminPortalSettingsCtrl",["$scope","$rootScope","$location","$timeout","$window","Restangular","$translatePartialLoader","$translate","$q","SiteLogoService","ThemeService","UserService","DisqusShortnameService","FileUploadService","PortalSettingsService","StripeService","CurrencyService","Geolocator","LANG","AUTH_SCHEME","VideoLinkService","API_URL","ANONYMOUS_COMMENT","SOCIAL_SHARING_OPTIONS","$http",function($scope,$rootScope,$location,$timeout,$window,Restangular,$translatePartialLoader,$translate,$q,SiteLogoService,ThemeService,UserService,DisqusShortnameService,FileUploadService,PortalSettingsService,StripeService,CurrencyService,Geolocator,LANG,AUTH_SCHEME,VideoLinkService,API_URL,ANONYMOUS_COMMENT,SOCIAL_SHARING_OPTIONS,$http){angular.element(document).ready((function(){!0===$rootScope.showNewPlatformModal&&(delete $rootScope.showNewPlatformModal,$(".ui.modal.new-platform-modal").modal({onApprove:function(){var tab=$("#payment-settings-tab"),elem=angular.element(tab),data_tab=elem.attr("data-tab");elem.parent().find(".item").removeClass("active"),elem.parent().parent().find(".tab").removeClass("active"),elem.addClass("active"),$("[data-tab='"+data_tab+"']").addClass("active")}}).modal("show"))})),$scope.froalaOptionsMain={},$scope.froalaOptionsBot={},$scope.froalaOptionsExplore={},$scope.froalaFooterCustomHtmlBlock={},$scope.clearMessage=function(){$rootScope.floatingMessage=[]};var stripeAdminAccounts,user=UserService,msg=[],blockAlignmentsTexts=["tab_portalsetting_block_alignment_left","tab_portalsetting_block_alignment_center","tab_portalsetting_block_alignment_right"];$scope.blockAlignConfigs=[];for(var values=["left","center","right"],i=0;i<blockAlignmentsTexts.length;i++){var obj={text:blockAlignmentsTexts[i],value:values[i]};$scope.blockAlignConfigs.push(obj)}function initiateOptions(foption){for(var prop in $rootScope.froalaOptions)$rootScope.froalaOptions.hasOwnProperty(prop)&&(foption[prop]=$rootScope.froalaOptions[prop])}$scope.searchFilters=["name","campaign ID","description","manager"],$scope.run_mode=!0,$scope.runModeSelected=1,$scope.runMode=[{name:"Time_Based_Campaign",id:1},{name:"Continuous_Campaign",id:2}],$scope.inlineContributionOptions={register:!1,guest:!1,express:!1},$scope.stripe_no_keys=!1,$translate(["tab_portalsetting_set_explore_default_sort_dropdown_random","tab_portalsetting_set_explore_default_sort_dropdown","tab_portalsetting_set_explore_default_sort_dropdown_featured"]).then((function(value){var defaultText=value.tab_portalsetting_set_explore_default_sort_dropdown,featured_text=value.tab_portalsetting_set_explore_default_sort_dropdown_featured,random_text=value.tab_portalsetting_set_explore_default_sort_dropdown_random;$scope.exploreDefaultSort=[{type:defaultText,value:"default"},{type:featured_text,value:"-featured,display_priority"},{type:random_text,value:"entry_id%"}]})),$(".ui.accordion").accordion(),$(".site-attributes-non-admin-disallow").popup(),$scope.setRunMode=function(mode){$scope.runModeSelected=mode.id,$scope.public_settings.site_campaign_defaults_runMode=$scope.runModeSelected,2==mode.id?$scope.run_mode=!1:$scope.run_mode=!0},$rootScope.isConnectWithStripe&&$timeout((function(){$("a[data-tab='portal-settings/payment-settings']").click()})),initiateOptions($scope.froalaOptionsMain),initiateOptions($scope.froalaOptionsBot),initiateOptions($scope.froalaOptionsExplore),initiateOptions($scope.froalaFooterCustomHtmlBlock),$scope.loginRedirect={text:"",link:""},$scope.registerRedirect={text:"",link:""};var countries_orig;function translateArrays(arrayObj){var menuOptionsFaq=[];for(var menuFaq in arrayObj)menuOptionsFaq.push(arrayObj[menuFaq]);$translate(menuOptionsFaq).then((function(success){for(var menuFaq in arrayObj)arrayObj[menuFaq]=success[menuOptionsFaq[menuFaq]]}))}function processStripeApplicationAccount(){$scope.stripe_setting.publishable_key.indexOf("test")>=0?($("#testbtn").addClass("positive"),$scope.testmode=!0,$scope.livemode=!1,$scope.stripe_test1_clientId=$scope.stripe_setting.client_id,$scope.stripe_test1_publishkey=$scope.stripe_setting.publishable_key,$scope.stripe_test1_secretkey=$scope.stripe_setting.secret_key):$scope.stripe_setting.publishable_key.indexOf("live")>=0&&($("#livebtn").addClass("positive"),$scope.livemode=!0,$scope.stripe_live1_clientId=$scope.stripe_setting.client_id,$scope.stripe_live1_publishkey=$scope.stripe_setting.publishable_key,$scope.stripe_live1_secretkey=$scope.stripe_setting.secret_key),$scope.stripe_setting.country_id&&$scope.setStripeCountry($scope.stripe_setting.country_id),Restangular.one("account/stripe/connect").customGET().then((function(stripe_accounts){stripeAdminAccounts=stripe_accounts.plain(),$scope.admin_stripe_accounts=stripe_accounts.plain(),filterStripeAccount(stripeAdminAccounts,$scope.livemode),$rootScope.isConnectWithStripe&&$timeout((function(){$(".direct-transaction").dropdown("set selected",0)}),1e3)}));var cur_mode="defined"!=typeof $scope.livemode&&$scope.livemode?"live":"test";$scope.setMode(cur_mode)}function filterStripeAccount(stripeAccounts,isLiveMode){$scope.admin_stripe_accounts=stripeAdminAccounts.filter((function(account){return isLiveMode?/sk_live/.test(account.access_token):/sk_test/.test(account.access_token)}))}function updateSiteMenu(){Restangular.one("portal/setting").getList().then((function(success){$scope.public_settings={},$scope.private_settings={},angular.forEach(success,(function(value){3==value.setting_type_id?$scope.public_settings[value.name]=value.value:1==value.setting_type_id&&($scope.private_settings[value.name]=value.value)})),updateThemeColor(),void 0!==$scope.public_settings.site_set_explore_default_sort&&null!=$scope.public_settings.site_set_explore_default_sort||($scope.public_settings.site_set_explore_default_sort={default:$scope.exploreDefaultSort[0].value,default_text:$scope.exploreDefaultSort[0].type}),void 0!==$scope.public_settings.site_search_explore&&$scope.public_settings.site_search_explore||($scope.public_settings.site_search_explore=$scope.searchFilters[0]),void 0!==$scope.public_settings.site_stripe_tokenization&&$scope.public_settings.site_stripe_tokenization||($scope.public_settings.site_stripe_tokenization={toggle:!1,public_stripe_key:""}),void 0!==$scope.public_settings.site_infinite_scroller&&$scope.public_settings.site_infinite_scroller||($scope.public_settings.site_infinite_scroller={explore:!1,featured:!1,recent:!1,profile:!1}),void 0!==$scope.public_settings.site_default_campaign_rows&&$scope.public_settings.site_default_campaign_rows||($scope.public_settings.site_default_campaign_rows={featured:1,recent:1}),$scope.public_settings.site_campaign_defaults_runMode||($scope.public_settings.site_campaign_defaults_runMode=1),$scope.public_settings.site_campaign_currency_id||($scope.public_settings.site_campaign_currency_id=30),$scope.public_settings.site_campaign_enable_campaign_bio||($scope.public_settings.site_campaign_enable_campaign_bio=!1),$scope.public_settings.site_campaign_faq||($scope.public_settings.site_campaign_faq={name:"",description:"",toggle:!1}),void 0===$scope.public_settings.site_campaign_hide_profile&&($scope.public_settings.site_campaign_hide_profile=!1),$scope.public_settings.site_campaign_defaults||($scope.public_settings.site_campaign_defaults={hide_fundraise:!1,fundingGoal:1e8,toggle:!1,percentage_fee:10}),$scope.public_settings.site_campaign_defaults.percentage_fee||($scope.public_settings.site_campaign_defaults.percentage_fee=10),void 0!==$scope.public_settings.site_campaign_pledge_redirect&&$scope.public_settings.site_campaign_pledge_redirect||($scope.public_settings.site_campaign_pledge_redirect={toggle:!1,url:""}),CurrencyService.getCurrency((function(success){success&&($scope.native_lookup&&success.forEach((function(value){value.name=value.native_name?value.native_name:value.name})),$scope.currency_options=success,angular.forEach($scope.currency_options,(function(value){value.currency_id==$scope.public_settings.site_campaign_currency_id&&($scope.ccode=value.code_iso4217_alpha)})),$scope.public_settings.site_campaign_currency_id||($scope.public_settings.site_campaign_currency_id=success[0].currency_id),$scope.public_settings.site_tip_currency||angular.forEach(success,(function(value){value.currency_id==$scope.public_settings.site_campaign_currency_id&&($scope.public_settings.site_tip_currency=value)})),$scope.ccode||($scope.ccode="CAD"))})),$scope.default_country=$scope.public_settings.site_theme_default_shipping_country,Restangular.one("account/stripe/application").customGET().then((function(success){$scope.stripe_setting=success.plain(),$scope.stripe_setting_origin=angular.copy(success),processStripeApplicationAccount()}),(function(failure){"entity_not_found"==failure.data.code&&(void 0!==$scope.stripe_setting&&$scope.stripe_setting||($scope.stripe_setting={connect_code:null,secret_key:"",created:"2018-10-09 13:26:07.195958-07",disabled:0,stripe_account_id:"1",person_id:user.person_id,email:null,id:"1",country_id:null,stripe_account_type_id:1,currency_id:null,client_id:"",modified:"2018-10-10 20:20:32.108648-07",access_token:null,publishable_key:"",refresh_token:null,user_id:"acct_non_valid",not_in_database:!0,stripe_standard_mode:!0,stripe_express_mode:!1},$scope.stripe_setting_origin=angular.copy($scope.stripe_setting),processStripeApplicationAccount()))})),getPayPalApplication(),3==$scope.public_settings.site_payment_gateway&&($scope.public_settings.site_campaign_raise_modes.pledge_processing.default={1:"2",2:"2"}),Geolocator.getCountries().then((function(countries){if(countries_orig=countries,$scope.public_settings.site_theme_shipping_native_lookup)for(var i in countries)null!=countries[i].native_name&&(countries[i].name=countries[i].native_name);if($scope.countries=countries,$scope.default_country){for(var index in $scope.countries){var value=$scope.countries[index];if(value.id==$scope.default_country.id){$scope.default_country=value,$scope.countries.splice(index,1);break}}$scope.countries.splice(0,0,$scope.default_country)}})),void 0===$scope.public_settings.site_theme_banner_is_image&&($scope.public_settings.site_theme_banner_is_image=!0),$scope.loadPreviewVideo(),$scope.loginRedirect=null!=$scope.public_settings.site_login_redirect?$scope.public_settings.site_login_redirect:{},$scope.registerRedirect=null!=$scope.public_settings.site_register_redirect?$scope.public_settings.site_register_redirect:{},$scope.public_settings.site_theme_shipping_native_lookup=!!$scope.public_settings.site_theme_shipping_native_lookup,$scope.public_settings.site_theme_campaign_percentage_enabled=!!$scope.public_settings.site_theme_campaign_percentage_enabled,$scope.public_settings.site_theme_shipping_native_lookup&&$scope.default_country&&($scope.public_settings.site_theme_default_shipping_country.name=$scope.public_settings.site_theme_default_shipping_country.native_name),void 0===$scope.public_settings.site_verification&&($scope.public_settings.site_verification={toggle:!1}),void 0===$scope.public_settings.social_login&&($scope.public_settings.social_login={toggle:!1}),void 0===$scope.public_settings.site_theme_sticky_menu&&($scope.public_settings.site_theme_sticky_menu=!1),void 0===$scope.public_settings.site_tipping?$scope.public_settings.site_tipping={type:1,tier_type:1,tiers:[]}:(void 0===$scope.public_settings.site_tipping.type&&($scope.public_settings.site_tipping.type=1),void 0===$scope.public_settings.site_tipping.tier_type&&($scope.public_settings.site_tipping.tier_type=1),void 0===$scope.public_settings.site_tipping.tiers&&($scope.public_settings.site_tipping.tiers=[],$scope.public_settings.site_tipping.tiers.length=0)),void 0===$scope.public_settings.site_campaign_combine_amount_tip&&($scope.public_settings.site_campaign_combine_amount_tip=!1),3==$scope.public_settings.site_payment_gateway&&($scope.public_settings.site_campaign_combine_amount_tip=!0),void 0===$scope.public_settings.logo_links&&($scope.public_settings.logo_links=[],$scope.public_settings.logo_links.length=0),void 0===$scope.public_settings.site_campaign_business_section_custom||0==$scope.public_settings.site_campaign_business_section_custom.length?$scope.custom_link=[{name:"",id:""}]:$scope.custom_link=$scope.public_settings.site_campaign_business_section_custom,$scope.private_settings.site_campaign_processing_days||($scope.private_settings.site_campaign_processing_days=5),$scope.crimson=$scope.private_settings.site_crimson_setting,$scope.selected_mode=$scope.public_settings.site_campaign_raise_modes.default-1,$scope.raise_modes&&$("#mode_dtext").text($scope.raise_modes[$scope.selected_mode].description),$scope.public_settings.site_default_widget_makr_id&&($scope.widgetdefault_id=$scope.public_settings.site_default_widget_makr_id),void 0===$scope.public_settings.site_tos_contribution_ui?$("#contribcheck").checkbox("check"):$scope.contrib=$scope.public_settings.site_tos_contribution_ui,void 0===$scope.public_settings.site_campaign_hide_creator_info?$scope.public_settings.site_campaign_hide_creator_info=!1:($scope.site_campaign_hide_creator_info=$scope.public_settings.site_campaign_hide_creator_info,$scope.site_campaign_hide_creator_info&&$("#hidecheck").checkbox("check")),void 0===$scope.public_settings.site_campaign_allow_thumbnail_video?($scope.public_settings.site_campaign_allow_thumbnail_video=!0,$("#thumbnail-video-check").checkbox("check")):$scope.public_settings.site_campaign_allow_thumbnail_video&&$("#thumbnail-video-check").checkbox("check"),void 0===$scope.public_settings.site_payment_gateway?($timeout((function(){$("#card-type").dropdown("set text",$scope.paymenttype[0].name),$("#card-type").dropdown("set selected",$scope.paymenttype[0].type_id)})),$scope.showStripe=!0):(angular.forEach($scope.paymenttype,(function(value){value.type_id==$scope.public_settings.site_payment_gateway&&($("#default-payment-text").text(value.name),$scope.paymentId=$scope.public_settings.site_payment_gateway)})),3==$scope.public_settings.site_payment_gateway?($scope.showStripe=!1,$scope.showWidgetMkr=!1,$scope.showPayPal=!0):2==$scope.public_settings.site_payment_gateway?($scope.showStripe=!1,$scope.showWidgetMkr=!0,$scope.showPayPal=!1):($scope.showStripe=!0,$scope.showWidgetMkr=!1,$scope.showPayPal=!1)),1==$scope.public_settings.site_contribute_behaviour.default&&($scope.inlineContributionOptions.register=!0,$scope.inlineContributionOptions.guest=!1,$scope.inlineContributionOptions.express=!1),2==$scope.public_settings.site_contribute_behaviour.default&&($scope.inlineContributionOptions.register=!1,$scope.inlineContributionOptions.guest=!0,$scope.inlineContributionOptions.express=!1),3==$scope.public_settings.site_contribute_behaviour.default&&($scope.inlineContributionOptions.register=!0,$scope.inlineContributionOptions.guest=!0,$scope.inlineContributionOptions.express=!1),4==$scope.public_settings.site_contribute_behaviour.default&&($scope.inlineContributionOptions.register=!1,$scope.inlineContributionOptions.guest=!1,$scope.inlineContributionOptions.express=!1),5==$scope.public_settings.site_contribute_behaviour.default&&($scope.inlineContributionOptions.register=!1,$scope.inlineContributionOptions.guest=!1,$scope.inlineContributionOptions.express=!0),6==$scope.public_settings.site_contribute_behaviour.default&&($scope.inlineContributionOptions.register=!0,$scope.inlineContributionOptions.guest=!1,$scope.inlineContributionOptions.express=!0),7==$scope.public_settings.site_contribute_behaviour.default&&($scope.inlineContributionOptions.register=!1,$scope.inlineContributionOptions.guest=!0,$scope.inlineContributionOptions.express=!0),8==$scope.public_settings.site_contribute_behaviour.default&&($scope.inlineContributionOptions.register=!0,$scope.inlineContributionOptions.guest=!0,$scope.inlineContributionOptions.express=!0),$scope.public_settings.site_home_page_text.bottom_banner.learn_more_button_text&&0!=$scope.public_settings.site_home_page_text.bottom_banner.learn_more_button_text.length||($scope.public_settings.site_home_page_text.bottom_banner.learn_more_button_text="Learn more"),$scope.public_settings.site_home_page_text.bottom_banner.learn_more_button_text_link&&0!=$scope.public_settings.site_home_page_text.bottom_banner.learn_more_button_text_link.length||($scope.public_settings.site_home_page_text.bottom_banner.learn_more_button_text_link="about"),$scope.public_settings.site_home_page_text.main_banner.button_text&&0!=$scope.public_settings.site_home_page_text.main_banner.button_text.length||($scope.public_settings.site_home_page_text.main_banner.button_text="Start Project"),$scope.public_settings.site_home_page_text.main_banner.button_text_link&&0!=$scope.public_settings.site_home_page_text.main_banner.button_text_link.length||($scope.public_settings.site_home_page_text.main_banner.button_text_link="start"),void 0===$scope.public_settings.site_home_page_text.bottom_banner.learn_more_display_button&&($scope.public_settings.site_home_page_text.bottom_banner.learn_more_display_button=!0),void 0===$scope.private_settings.site_stripe?($scope.stripe_test_clientId=$scope.stripe_test1_clientId,$scope.stripe_test_secretkey=$scope.stripe_test1_secretkey,$scope.stripe_test_publishkey=$scope.stripe_test1_publishkey,$scope.stripe_live_clientId=$scope.stripe_live1_clientId,$scope.stripe_live_secretkey=$scope.stripe_live1_secretkey,$scope.stripe_live_publishkey=$scope.stripe_live1_publishkey,$scope.stripe_no_keys=!0):($scope.stripe_test_clientId=$scope.private_settings.site_stripe.test.clientId,$scope.stripe_test_secretkey=$scope.private_settings.site_stripe.test.secretkey,$scope.stripe_test_publishkey=$scope.private_settings.site_stripe.test.publishkey,$scope.stripe_live_clientId=$scope.private_settings.site_stripe.live.clientId,$scope.stripe_live_secretkey=$scope.private_settings.site_stripe.live.secretkey,$scope.stripe_live_publishkey=$scope.private_settings.site_stripe.live.publishkey),null==$scope.public_settings.stripe_standard_mode&&null==$scope.public_settings.stripe_express_mode||$scope.public_settings.stripe_standard_mode?($scope.public_settings.stripe_standard_mode=!0,$scope.public_settings.stripe_express_mode=!1,$("#standard-btn").addClass("positive")):null!=$scope.public_settings.express_mode&&$scope.public_settings.stripe_express_mode&&($scope.public_settings.stripe_express_mode=!0,$scope.public_settings.stripe_standard_mode=!1,$("#express-btn").addClass("positive")),$scope.public_settings.site_home_page_text.main_banner.html=$scope.replaceStyleTag($scope.public_settings.site_home_page_text.main_banner.html),$scope.public_settings.site_home_page_text.main_banner.block_alignment||($scope.public_settings.site_home_page_text.main_banner.block_alignment=$scope.blockAlignConfigs[1]),$scope.public_settings.site_home_page_text.bottom_banner.html=$scope.replaceStyleTag($scope.public_settings.site_home_page_text.bottom_banner.html),$scope.public_settings.site_explore_page_text.html=$scope.replaceStyleTag($scope.public_settings.site_explore_page_text.html),$scope.public_settings.site_explore_page_text.homeSetting||($scope.public_settings.site_explore_page_text.homeSetting=!1),$scope.featuredproject=$scope.public_settings.site_home_page_text.titles.top_show,$scope.newproject=$scope.public_settings.site_home_page_text.titles.bottom_show,$scope.recentProjectHideFeatured=$scope.public_settings.recentProjectHideFeatured,$scope.public_settings.site_auth_scheme&&1!=$scope.public_settings.site_auth_scheme.id||($scope.public_settings.site_auth_scheme=$scope.auth_scheme[0]),void 0===$scope.public_settings.site_theme_campaign_hide_min_contribute_message&&($scope.public_settings.site_theme_campaign_hide_min_contribute_message=!1),void 0===$scope.public_settings.site_theme_campaign_delayed_funding_setup&&($scope.public_settings.site_theme_campaign_delayed_funding_setup=!1),void 0===$scope.public_settings.site_theme_campaign_delayed_reward_setup&&($scope.public_settings.site_theme_campaign_delayed_reward_setup=!1),void 0===$scope.public_settings.payment_setting_enabled&&($scope.public_settings.payment_setting_enabled=!0),void 0!==$scope.public_settings.site_footer_custom_html_block&&$scope.public_settings.site_footer_custom_html_block.hasOwnProperty("html")||($scope.public_settings.site_footer_custom_html_block={html:""});for(var i=0;i<success.length;i++){if("site_campaign_fee_currency"==success[i].name){$scope.currency_setting={},$scope.currency_setting.currency_ids=[];for(var tmp=success[i].value,j=0;j<tmp.length;j++)$scope.currency_setting.currency_ids.push(tmp[j].currency_id)}"site_favicon"==success[i].name&&($scope.site_favicon=success[i]),"site_logo"==success[i].name&&($scope.site_logo=success[i]),"site_theme_main_background"==success[i].name&&($scope.main_background=success[i]),"site_theme_explore_background"==success[i].name&&($scope.explore_background=success[i]),"site_load_icon"==success[i].name&&($scope.site_load_icon=success[i]),"site_load_class"==success[i].name&&($scope.site_load_class=success[i].value),"site_api_connection_message"==success[i].name&&($scope.site_api_connection_message=success[i]),"site_campaign_fee_percentage"==success[i].name&&3==success[i].setting_type_id&&($scope.stripe_fee.campaign_fee=success[i].value),null==$scope.public_settings.site_theme_campaign_backer_option?($("#backer_dtext").text($scope.menuOptionsBacker[1]),$("#backer_dtext").removeClass("default")):($("#backer_dtext").text($scope.menuOptionsBacker[$scope.public_settings.site_theme_campaign_backer_option]),$("#backer_dtext").removeClass("default")),null==$scope.public_settings.site_theme_campaign_faq_option?($("#faq_dtext").text($scope.menuOptionsFaq[1]),$("#faq_dtext").removeClass("default")):($("#faq_dtext").text($scope.menuOptionsFaq[$scope.public_settings.site_theme_campaign_faq_option]),$("#faq_dtext").removeClass("default")),null==$scope.public_settings.site_theme_campaign_comment_option?($("#comment_dtext").text($scope.menuOptionsComment[1]),$("#comment_dtext").removeClass("default")):($("#comment_dtext").text($scope.menuOptionsComment[$scope.public_settings.site_theme_campaign_comment_option-1]),$("#comment_dtext").removeClass("default")),null==$scope.public_settings.site_theme_campaign_stream_option?($("#stream_dtext").text($scope.menuOptionsStream[1]),$("#stream_dtext").removeClass("default")):($("#stream_dtext").text($scope.menuOptionsStream[$scope.public_settings.site_theme_campaign_stream_option]),$("#stream_dtext").removeClass("default")),1==$scope.public_settings.site_theme_banner_video_mute?$translate("tab_portalsetting_video_toggle_mute_on").then((function(success){$scope.videoMuteToggle=success})):$translate("tab_portalsetting_video_toggle_mute_off").then((function(success){$scope.videoMuteToggle=success})),void 0!==$scope.public_settings.site_campaign_decimal_option&&0!=$scope.public_settings.site_campaign_decimal_option||($scope.public_settings.site_campaign_decimal_option=1),void 0===$scope.public_settings.comment_system&&($scope.public_settings.comment_system="disqus",$scope.comment="disqus",$scope.public_settings.custom_comment_show_comment_picture=!0,$scope.public_settings.custom_comment_auto_refresh=!1,$scope.public_settings.custom_comment_anonymous_commenting=ANONYMOUS_COMMENT.anonymous_disabled,$scope.public_settings.custom_comment_comment_background_color="FFFFFF",$scope.public_settings.custom_comment_font_color="000000"),"custom"==$scope.public_settings.comment_system?($("#custom-comment").addClass("positive"),$scope.comment="custom"):"disqus"==$scope.public_settings.comment_system?($("#disqus-comment").addClass("positive"),$scope.comment="disqus"):"facebook"==$scope.public_settings.comment_system&&($("#facebook-comment").addClass("positive"),$scope.comment="facebook"),1==$scope.public_settings.custom_comment_show_comment_picture&&$(".ui.checkbox#show_comment_picture").checkbox("check"),1==$scope.public_settings.custom_comment_auto_refresh&&$(".ui.checkbox#auto_refresh").checkbox("check")}$scope.anonymousValuesObject=ANONYMOUS_COMMENT,$scope.setAnonymousSetting=function(anonymousValue){anonymousValue==$scope.anonymousValuesObject.anonymous_disabled&&($scope.public_settings.custom_comment_anonymous_commenting_force=!1,$timeout((function(){$("#custom-comment-anonymous-force").checkbox("uncheck")}))),$scope.public_settings.custom_comment_anonymous_commenting=anonymousValue},$scope.sharingOptions=SOCIAL_SHARING_OPTIONS,$timeout((function(){if($scope.widgetdefault_id){var id="d"+$scope.widgetdefault_id;$("#"+id).attr("checked","checked")}$(".main-color-setting .color-item:nth-child("+$scope.public_settings.site_theme_color.button_color.index+")").addClass("active"),$(".table-color-setting .color-item:nth-child("+$scope.public_settings.site_theme_color.table_color.index+")").addClass("active"),$(".banner-color-setting .color-item:nth-child("+$scope.public_settings.site_theme_color.banner_color.index+")").addClass("active"),$(".font-color-setting .color-item:nth-child("+$scope.public_settings.site_theme_color.font_color.index+")").addClass("active"),$(".reward-color-setting .color-item:nth-child("+$scope.public_settings.site_theme_color.reward_block_color.index+")").addClass("active"),$(".top-nav-background-color-setting .color-item:nth-child("+$scope.public_settings.site_theme_color.top_nav_background_color.index+")").addClass("active"),$(".top-nav-font-color-setting .color-item:nth-child("+$scope.public_settings.site_theme_color.top_nav_font_color.index+")").addClass("active"),$(".footer-background-color-setting .color-item:nth-child("+$scope.public_settings.site_theme_color.footer_background_color.index+")").addClass("active"),$(".footer-font-color-setting .color-item:nth-child("+$scope.public_settings.site_theme_color.footer_font_color.index+")").addClass("active"),1==$scope.featuredproject&&$(".ui.checkbox #featured").checkbox("check"),$scope.featuredproject||$(".ui.checkbox #featured").checkbox("check"),1==$scope.newproject&&$(".ui.checkbox #new").checkbox("check"),$scope.newproject||$(".ui.checkbox #new").checkbox("check"),1==$scope.recentProjectHideFeatured&&$(".ui.checkbox #hide-featured-in-recent").checkbox("check"),$scope.recentProjectHideFeatured||$(".ui.checkbox #hide-featured-in-recent").checkbox("check"),$(".anonymous-commenting").dropdown("set selected",$scope.public_settings.custom_comment_anonymous_commenting),$(".dropdown.sharing-options").dropdown("set selected",$scope.public_settings.site_campaign_sharing_options)}))}),(function(failure){msg={header:failure.data.message},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))}$scope.selectTab=function($event){var $elem=$event.target,elem=angular.element($elem),data_tab=elem.attr("data-tab");elem.parent().find(".item").removeClass("active"),elem.parent().parent().find(".tab").removeClass("active"),elem.addClass("active"),$("[data-tab='"+data_tab+"']").addClass("active")},$scope.showDirectTransaction=!0,$scope.showMarketPlace=!1,$scope.stripe_test_clientId="",$scope.stripe_test_secretkey="",$scope.stripe_test_publishkey="",$scope.stripe_live_clientId="",$scope.stripe_live_secretkey="",$scope.stripe_live_publishkey="",$scope.comment="",$scope.menuSelect={headerSelect:[],footerLeftSelect:[],footerMiddleSelect:[],footerRightSelect:[]},$scope.widget_makr_links=[{name:"",widget_instance_id:"",api_key:"",widgetmakr_account_id:""}],$scope.paymenttype=[{name:"Stripe",type_id:1},{name:"PayPal",type_id:3}],$scope.decimal_option_modes=[{name:"tab_portalsetting_Decimal_Option_display_use",type_id:1},{name:"tab_portalsetting_Decimal_Option_display_only",type_id:2},{name:"tab_portalsetting_Decimal_Option_disable",type_id:3}],$scope.customSection=[{name:"Business Profile Section",type_id:1},{name:"Personal Profile Section",type_id:2}],$scope.custom_section_id=1,$scope.auth_scheme=AUTH_SCHEME,$scope.cur_type=1,$scope.customType=function(type){1==type.type_id&&($scope.cur_type=1,$scope.custom_section_id=1,void 0===$scope.public_settings.site_campaign_business_section_custom||0==$scope.public_settings.site_campaign_business_section_custom.length?$scope.custom_link=[{name:""}]:$scope.custom_link=$scope.public_settings.site_campaign_business_section_custom),2==type.type_id&&($scope.cur_type=2,$scope.custom_section_id=2,void 0===$scope.public_settings.site_campaign_personal_section_custom||0==$scope.public_settings.site_campaign_personal_section_custom.length?$scope.public_settings.site_campaign_personal_section_enhanced?$scope.custom_link=[{name:"",option:"Text",dropdown_array:null,profile_step_show:!1,profile_setting_register_show:!1,profile_setting_show:!1,register_show:!1}]:$scope.custom_link=[{name:""}]:$scope.custom_link=$scope.public_settings.site_campaign_personal_section_custom)},$scope.customTypeOption=["Text","Dropdown"],$scope.customFieldType=function(index,link){link.option=$scope.customTypeOption[index]},$scope.removeCustomFiled=function(link,index){$scope.custom_link.splice(index,1)},$scope.addCustomField=function(arr){arr&&arr.push(angular.copy({name:"",option:"Text",validate:"",dropdown_array:null,profile_step_show:!1,profile_setting_register_show:!1,profile_setting_show:!1,register_show:!1}))},$scope.saveCustomField=function(){$scope.customFieldSaveAttrPermission();var publicSettings,valcheck=!0;msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg,angular.forEach($scope.custom_link,(function(val,key,obj){if(obj[key].dropdown_array&&!Array.isArray(obj[key].dropdown_array)){var array=obj[key].dropdown_array.split(",");obj[key].dropdown_array=array}})),1==$scope.custom_section_id?publicSettings={site_campaign_business_section_custom:$scope.custom_link}:2==$scope.custom_section_id&&(publicSettings={site_campaign_personal_section_custom:$scope.custom_link,site_campaign_personal_section_enhanced:$scope.public_settings.site_campaign_personal_section_enhanced}),!$scope.public_settings.site_campaign_personal_section_enhanced||(angular.forEach($scope.custom_link,(function(value){value.name.length||(valcheck=!1)})),valcheck)?Restangular.one("portal/setting/public").customPUT(publicSettings).then((function(success){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()})):$timeout((function(){$rootScope.removeFloatingMessage(),msg={header:"pcustom_name_error"},$rootScope.floatingMessage=msg}),500)},$scope.paymentType=function(type){$scope.paymentId=type.type_id,1==$scope.paymentId&&($scope.showStripe=!0,$scope.showWidgetMkr=!1,$scope.showPayPal=!1),2==$scope.paymentId&&($scope.showStripe=!1,$scope.showWidgetMkr=!0,$scope.showPayPal=!1),3==$scope.paymentId&&($scope.showStripe=!1,$scope.showPayPal=!0)},$rootScope.$on("$locationChangeSuccess",(function(){updateSiteMenu()})),$scope.menuOptionsFaq={0:"tab_portalsetting_faq_tab_option1",1:"tab_portalsetting_faq_tab_option2",2:"tab_portalsetting_faq_tab_option3"},$scope.menuOptionsBacker={0:"tab_portalsetting_backers_tab_option1",1:"tab_portalsetting_backers_tab_option2",2:"tab_portalsetting_backers_tab_option3",3:"tab_portalsetting_backers_tab_option4"},$scope.menuOptionsComment={0:"tab_portalsetting_comments_tab_option1",1:"tab_portalsetting_comments_tab_option2"},$scope.menuOptionsStream={0:"tab_portalsetting_streams_tab_option1",1:"tab_portalsetting_streams_tab_option2",2:"tab_portalsetting_streams_tab_option3"},translateArrays($scope.menuOptionsFaq),translateArrays($scope.menuOptionsBacker),translateArrays($scope.menuOptionsComment),translateArrays($scope.menuOptionsStream),$scope.menuSections=["Navigation","Footer 1","Footer 2"],$scope.menuShow=!1,$scope.menu_links=[],$scope.color_list=[{index:1,name:"purple"},{index:2,name:"light green"},{index:3,name:"teal"},{index:4,name:"blue"},{index:5,name:"red"},{index:6,name:"orange"},{index:7,name:"yellow"},{index:8,name:"dark purple"},{index:9,name:"black"},{index:10,name:"white"},{index:11,name:"sky blue"},{index:12,name:"pink"}],setTimeout((function(){$translate(["button_color","table_color","banner_color","font_color","reward_block_color","top_nav_background_color","top_nav_font_color","footer_background_color","footer_font_color"]).then((function(value){$scope.color_sections=[{name:value.button_color,index:1,var_name:"button_color"},{name:"Table",index:2,var_name:"table_color"},{name:"Banner",index:3,var_name:"banner_color"},{name:"Font",index:4,var_name:"font_color"},{name:"Reward Block",index:5,var_name:"reward_block_color"},{name:"Top Nav Background",index:6,var_name:"top_nav_background_color"},{name:"Top Nav Font",index:7,var_name:"top_nav_font_color"},{name:"Footer Background",index:8,var_name:"footer_background_color"},{name:"Footer Font",index:9,var_name:"footer_font_color"}]}))}),1e3),updateSiteMenu(),Restangular.one("campaign/raise-mode").customGET().then((function(success){$scope.raise_modes=success,PortalSettingsService.getSettingsObj().then((function(success){angular.forEach($scope.raise_modes,(function(mode,index){success.public_setting.site_campaign_raise_modes.allowed.indexOf(mode.id)>-1&&(mode.allowed=!0,mode.id==success.public_setting.site_campaign_raise_modes.default&&(mode.default=!0))}))}))})),$scope.checkChecked=function($event){$($event.currentTarget).parent().hasClass("checked")?$translate("tab_portalsetting_video_toggle_mute_off").then((function(success){$scope.videoMuteToggle=success})):$translate("tab_portalsetting_video_toggle_mute_on").then((function(success){$scope.videoMuteToggle=success}))},$scope.stripeSettingsValidation=function(){var translation=$translate.instant(["tab_portalsetting_stripe_country_error"]),postTranslation=$translate.instant(["tab_portalsetting_post_processing_interval_error"]);$.fn.form.settings.rules.postProcessingRule=function(param){return!(param<1)&&!(param>6)},$("#stripe-settings-form.ui.form").form({stripe_country:{identifier:"stripe_country",rules:[{type:"empty",prompt:translation.tab_portalsetting_stripe_country_error}]}},{inline:!0,onSuccess:function(){$scope.valcheck=$scope.valcheck&&!0},onFailure:function(){$scope.valcheck=$scope.valcheck&&!1}}).form("validate form"),$("#post-processing-interval.ui.form").form({processing_days:{identifier:"processing_days",rules:[{type:"postProcessingRule[param]",prompt:postTranslation.tab_portalsetting_post_processing_interval_error}]}},{inline:!0,onSuccess:function(){$scope.valcheck=$scope.valcheck&&!0},onFailure:function(){$scope.valcheck=$scope.valcheck&&!1}}).form("validate form")},$scope.stripeTokenizationValidation=function(){if($scope.livemode){if($scope.public_settings.site_stripe_tokenization.toggle&&($scope.stripe_live_publishkey&&!$scope.stripe_live_publishkey.length||$scope.stripe_live_secretkey&&!$scope.stripe_live_secretkey.length))return msg={header:"stripe_tokenize_error"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage(),!1}else if($scope.testmode&&$scope.public_settings.site_stripe_tokenization.toggle&&($scope.stripe_test_publishkey&&!$scope.stripe_test_publishkey.length||$scope.stripe_test_secretkey&&!$scope.stripe_test_secretkey.length))return msg={header:"stripe_tokenize_error"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage(),!1;return!0},$scope.checkBank=function(){$scope.public_settings.site_campaign_country_funding_step&&($(".toggle-bank").checkbox("uncheck"),$scope.public_settings.site_campaign_country_funding_step=!1)},$scope.checkDirect=function(){$scope.public_settings.site_campaign_fee_direct_transaction||($(".toggle-stripe").checkbox("check"),$scope.public_settings.site_campaign_fee_direct_transaction=!0)},$scope.savePayment=function(){if($scope.valcheck=!0,$scope.showStripe&&$scope.countryCurrencyValidate(),$scope.public_settings.payment_setting_enabled&&($scope.showStripe&&($scope.stripeSettingsValidation(),$scope.directTransactionValidation(),$scope.stripeTokenizationValidation()||($scope.valcheck=!1)),$scope.showPayPal&&$scope.paypalValidate()),$rootScope.scrollToError(),$scope.valcheck){var privateSettings={site_campaign_processing_days:$scope.private_settings.site_campaign_processing_days};Restangular.one("portal/setting").customPUT(privateSettings).then((function(success){$scope.public_settings.payment_setting_enabled||(msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage(),$scope.stripe_setting[""]),$scope.public_settings.site_campaign_fee_direct_transaction&&(filterStripeAccount(0,$scope.livemode),$rootScope.isConnectWithStripe&&$timeout((function(){$(".direct-transaction").dropdown("set selected",0)}),1e3))})),$scope.testmode&&$scope.stripe_test_publishkey?$scope.public_settings.site_stripe_tokenization={toggle:!0,public_stripe_key:$scope.stripe_test_publishkey}:$scope.livemode&&$scope.stripe_live_publishkey&&($scope.public_settings.site_stripe_tokenization={toggle:!0,public_stripe_key:$scope.stripe_live_publishkey});var publicSettings={payment_setting_enabled:$scope.public_settings.payment_setting_enabled,site_payment_gateway:$scope.paymentId,site_default_widget_makr_id:$scope.widget_default_id,site_theme_portal_company_name:$scope.public_settings.site_theme_portal_company_name,site_theme_portal_company_number:$scope.public_settings.site_theme_portal_company_number,site_stripe_tokenization:$scope.public_settings.site_stripe_tokenization,site_campaign_country_funding_step:$scope.public_settings.site_campaign_country_funding_step,site_campaign_country_ids:$scope.public_settings.site_campaign_country_ids,site_campaign_contributions:$scope.public_settings.site_campaign_contributions,site_campaign_contributions_instruction:$scope.public_settings.site_campaign_contributions_instruction,site_campaign_strong_customer_auth:$scope.public_settings.site_campaign_strong_customer_auth,stripe_standard_mode:$scope.public_settings.stripe_standard_mode,stripe_express_mode:$scope.public_settings.stripe_express_mode};$scope.paypal_setting&&(publicSettings.paypal_publishable_key=$scope.paypal_setting.publishable_key),Restangular.one("portal/setting/public").customPUT(publicSettings).then((function(success){3==$scope.paymentId?$scope.savePayPal():$scope.updateStripe()}))}},Restangular.one("account/widgetmakr/widget").customGET().then((function(success){success.length>0?($scope.widget_accountID=success[0].widgetmakr_account_id,$scope.widgetMakr_link=success):$scope.widgetMakr_link=[{name:"",widget_instance_id:"",api_key:"",widgetmakr_account_id:""}]})),$scope.saveWidgetMkr=function(){msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg;var privateSettings={site_crimson_setting:$scope.crimson};Restangular.one("portal/setting").customPUT(privateSettings),$scope.widgetMakr_link.forEach((function(link,index){link.widgetmakr_account_id>0?($scope.widget_makr_links.widgetmakr_account_id=link.widget_accountID,Restangular.one("account/widgetmakr/widget",link.widgetmakr_account_id).customPUT(link).then((function(success){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))):Restangular.one("account/widgetmakr/widget").customPOST(link).then((function(success){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))}))},$scope.removeLink=function(link,index){$scope.widgetMakr_link.splice(index,1),link.widgetmakr_account_id&&Restangular.one("account/widgetmakr/widget",link.widgetmakr_account_id).customDELETE()},$scope.addWLink=function(arr){arr&&arr.push(angular.copy({name:"",widget_instance_id:"",api_key:"",widgetmakr_account_id:""}))},$scope.setMode=function(id){"live"===id?($scope.livemode=!0,$scope.testmode=!1,$("#livebtn").addClass("positive"),$("#testbtn").removeClass("positive"),null!=stripeAdminAccounts&&filterStripeAccount(0,$scope.livemode)):"test"===id?($scope.livemode=!1,$scope.testmode=!0,$("#livebtn").removeClass("positive"),$("#testbtn").addClass("positive"),null!=stripeAdminAccounts&&filterStripeAccount(0,$scope.livemode)):"standard"===id?($scope.public_settings.stripe_standard_mode=!0,$scope.public_settings.stripe_express_mode=!1,$("#standard-btn").addClass("positive"),$("#express-btn").removeClass("positive")):"express"===id?($scope.public_settings.stripe_standard_mode=!1,$scope.public_settings.stripe_express_mode=!0,$("#express-btn").addClass("positive"),$("#standard-btn").removeClass("positive")):"custom"===id?($scope.comment=id,$("#custom-comment").addClass("positive"),$("#disqus-comment").removeClass("positive"),$("#facebook-comment").removeClass("positive")):"disqus"===id?($scope.comment=id,$("#disqus-comment").addClass("positive"),$("#custom-comment").removeClass("positive"),$("#facebook-comment").removeClass("positive")):"facebook"===id&&($scope.comment=id,$("#disqus-comment").removeClass("positive"),$("#custom-comment").removeClass("positive"),$("#facebook-comment").addClass("positive"))},$scope.setPayPalMode=function(mode){"live"===mode?($scope.paypalLiveMode=!0,$scope.paypalTestMode=!1,$(".paypal-live").addClass("positive"),$(".paypal-test").removeClass("positive"),$scope.paypal_setting_live?($scope.paypal_setting=$scope.paypal_setting_live,$scope.paypal_live_secretkey=$scope.paypal_setting.secret_key,$scope.paypal_live_publishkey=$scope.paypal_setting.publishable_key):($scope.paypal_live_secretkey="",$scope.paypal_live_publishkey="")):"test"===mode&&($scope.paypalLiveMode=!1,$scope.paypalTestMode=!0,$(".paypal-live").removeClass("positive"),$(".paypal-test").addClass("positive"),$scope.paypal_setting_test?($scope.paypal_setting=$scope.paypal_setting_test,$scope.paypal_test_secretkey=$scope.paypal_setting.secret_key,$scope.paypal_test_publishkey=$scope.paypal_setting.publishable_key):($scope.paypal_live_secretkey="",$scope.paypal_live_publishkey=""))},$scope.loader_enabled=!1,void 0!==API_URL.loader_enabled&&($scope.loader_enabled=API_URL.loader_enabled),$scope.uploadLoadIcon=function(files){if(files.length){var $picNode=$(".loadScreenIcon");FileUploadService.upload("portal/resource/file",files,{resource_content_type:"image"},$picNode).then((function(success){var data={site_load_icon:success[0].data};SiteLogoService.setLoadIcon(data),$scope.site_load_icon.value||($scope.site_load_icon.value={}),$scope.site_load_icon.value.path_external=success[0].data.path_external}))}},$scope.deleteLoadIcon=function(){$scope.site_load_icon={},SiteLogoService.setLoadIcon({site_load_icon:{}})},$scope.uploadFavIcon=function(files){if(files.length){var $picNode=$(".websiteFavicon");FileUploadService.upload("portal/resource/file",files,{resource_content_type:"image"},$picNode).then((function(success){var data={site_favicon:success[0].data};SiteLogoService.setFavIcon(data),$scope.site_favicon.value||($scope.site_favicon.value={}),$scope.site_favicon.value.path_external=success[0].data.path_external}))}};var reqDeleteFileArr=[];function resetFileUpload(){$scope.currentUploadFile={title:"",label:"",fileName:"",icon:"file",path:"",resourceId:-1}}function updateThemeColor(){legacyColors=["#FAFAFA","#DB4DDB","#94CA20","#00B5AD","#4C9EE7","#D13F2B","#FF9E35","#FFCC00","#8B69DB","#333333","#ffffff","#00caf2","#FF0081"];var root=document.documentElement,colors=$scope.public_settings.site_theme_color;colors.top_nav_background_color.value?root.style.setProperty("--top-nav-bg-color",colors.top_nav_background_color.value):(root.style.setProperty("--top-nav-bg-color",legacyColors[colors.top_nav_background_color.index]),$scope.public_settings.site_theme_color.top_nav_background_color.value=legacyColors[colors.top_nav_background_color.index]),colors.top_nav_font_color.value?root.style.setProperty("--top-nav-font-color",colors.top_nav_font_color.value):(root.style.setProperty("--top-nav-font-color",legacyColors[colors.top_nav_font_color.index]),$scope.public_settings.site_theme_color.top_nav_font_color.value=legacyColors[colors.top_nav_font_color.index]),colors.table_color.value?root.style.setProperty("--table-color",colors.table_color.value):(root.style.setProperty("--table-color",legacyColors[colors.table_color.index]),$scope.public_settings.site_theme_color.table_color.value=legacyColors[colors.table_color.index]),colors.reward_block_color.value?root.style.setProperty("--reward-color",colors.reward_block_color.value):(root.style.setProperty("--reward-color",legacyColors[colors.reward_block_color.index]),$scope.public_settings.site_theme_color.reward_block_color.value=legacyColors[colors.reward_block_color.index]),colors.footer_font_color.value?root.style.setProperty("--footer-font-color",colors.footer_font_color.value):(root.style.setProperty("--footer-font-color",legacyColors[colors.footer_font_color.index]),$scope.public_settings.site_theme_color.footer_font_color.value=legacyColors[colors.footer_font_color.index]),colors.footer_background_color.value?root.style.setProperty("--footer-bg-color",colors.footer_background_color.value):(root.style.setProperty("--footer-bg-color",legacyColors[colors.footer_background_color.index]),$scope.public_settings.site_theme_color.footer_background_color.value=legacyColors[colors.footer_background_color.index]),colors.font_color.value?root.style.setProperty("--font-color",colors.font_color.value):(root.style.setProperty("--font-color",legacyColors[colors.font_color.index]),$scope.public_settings.site_theme_color.font_color.value=legacyColors[colors.font_color.index]),colors.button_color.value?root.style.setProperty("--button-color",colors.button_color.value):(root.style.setProperty("--button-color",legacyColors[colors.button_color.index]),$scope.public_settings.site_theme_color.button_color.value=legacyColors[colors.button_color.index]),colors.banner_color.value?root.style.setProperty("--banner-color",colors.banner_color.value):(root.style.setProperty("--banner-color",legacyColors[colors.banner_color.index]),$scope.public_settings.site_theme_color.banner_color.value=legacyColors[colors.banner_color.index])}function isDocumentWrite(htmlBlock){return!(!htmlBlock||!htmlBlock.match(/document.write/g))&&(msg={header:"document_write_prompt_msg"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage(),!0)}function resetStripeKeyErrors(){$(".secret-key-error").remove(),$(".publish-key-error").remove(),$(".client-key-error").remove(),$("#live_secret_key").removeClass("error"),$("#live_publish_key").removeClass("error"),$("#live_client_id").removeClass("error"),$("#test_secret_key").removeClass("error"),$("#test_publish_key").removeClass("error"),$("#test_client_id").removeClass("error")}function getPayPalApplication(){$scope.public_settings.paypal_live_id&&Restangular.one("account/paypal/application").customGET($scope.public_settings.paypal_live_id).then((function(success){$scope.paypal_setting_live=success.plain(),$scope.public_settings.paypal_mode&&"live"==$scope.public_settings.paypal_mode&&($scope.paypal_setting=success.plain(),$scope.paypal_setting_origin=angular.copy(success),$scope.paypal_setting.country_id&&$scope.setPaypalCountry($scope.paypal_setting.country_id)),$scope.paypalTestMode=!0,$scope.public_settings.paypal_mode&&"test"==$scope.public_settings.paypal_mode&&($("#testbtn").addClass("positive"),$scope.paypalTestMode=!0,$scope.paypalLiveMode=!1),$scope.public_settings.paypal_mode&&"live"==$scope.public_settings.paypal_mode&&($("#livebtn").addClass("positive"),$scope.paypalLiveMode=!0,$scope.paypalTestMode=!1,$scope.paypal_live_publishkey=$scope.paypal_setting.publishable_key,$scope.paypal_live_secretkey=$scope.paypal_setting.secret_key)}),(function(failure){"entity_not_found"==failure.data.code&&(void 0!==$scope.paypal_setting&&$scope.stripe_setting||($scope.paypal_setting={connect_code:null,secret_key:"",created:"2018-10-09 13:26:07.195958-07",disabled:0,stripe_account_id:"1",person_id:user.person_id,email:null,id:"1",country_id:null,currency_id:null,client_id:"",modified:"2018-10-10 20:20:32.108648-07",access_token:null,publishable_key:"",refresh_token:null,user_id:"acct_non_valid",not_in_database:!0},$scope.paypal_setting_origin=angular.copy($scope.paypal_setting),$scope.public_settings.paypal_mode&&"live"==$scope.public_settings.paypal_mode?($("#livebtn").addClass("positive"),$scope.paypalLiveMode=!0,$scope.paypalTestMode=!1):($("#testbtn").addClass("positive"),$scope.paypalTestMode=!0,$scope.paypalLiveMode=!1,$scope.paypal_test_publishkey=$scope.paypal_setting.publishable_key,$scope.paypal_test_secretkey=$scope.paypal_setting.secret_key)))})),$scope.public_settings.paypal_test_id&&Restangular.one("account/paypal/application").customGET($scope.public_settings.paypal_test_id).then((function(success){$scope.paypal_setting_test=success.plain(),$scope.public_settings.paypal_mode?"live"!=$scope.public_settings.paypal_mode&&($scope.paypal_setting=success.plain(),$scope.paypal_setting_origin=angular.copy(success),$scope.paypal_setting.country_id&&$scope.setPaypalCountry($scope.paypal_setting.country_id)):($scope.paypal_setting=success.plain(),$scope.paypal_setting_origin=angular.copy(success),$scope.paypal_setting.country_id&&$scope.setPaypalCountry($scope.paypal_setting.country_id)),$scope.paypalTestMode=!0,$scope.public_settings.paypal_mode&&"test"==$scope.public_settings.paypal_mode&&($("#testbtn").addClass("positive"),$scope.paypalTestMode=!0,$scope.paypalLiveMode=!1,$scope.paypal_test_publishkey=$scope.paypal_setting.publishable_key,$scope.paypal_test_secretkey=$scope.paypal_setting.secret_key),$scope.public_settings.paypal_mode&&"live"==$scope.public_settings.paypal_mode&&($("#livebtn").addClass("positive"),$scope.paypalLiveMode=!0,$scope.paypalTestMode=!1,$scope.paypal_live_publishkey=$scope.paypal_setting.publishable_key,$scope.paypal_live_secretkey=$scope.paypal_setting.secret_key)}),(function(failure){"entity_not_found"==failure.data.code&&(void 0!==$scope.paypal_setting&&$scope.stripe_setting||($scope.paypal_setting={connect_code:null,secret_key:"",created:"2018-10-09 13:26:07.195958-07",disabled:0,stripe_account_id:"1",person_id:user.person_id,email:null,id:"1",country_id:null,currency_id:null,client_id:"",modified:"2018-10-10 20:20:32.108648-07",access_token:null,publishable_key:"",refresh_token:null,user_id:"acct_non_valid",not_in_database:!0},$scope.paypal_setting_origin=angular.copy($scope.paypal_setting),$scope.public_settings.paypal_mode&&"live"==$scope.public_settings.paypal_mode?($("#livebtn").addClass("positive"),$scope.paypalLiveMode=!0,$scope.paypalTestMode=!1,$scope.paypal_live_publishkey=$scope.paypal_setting.publishable_key,$scope.paypal_live_secretkey=$scope.paypal_setting.secret_key):($("#testbtn").addClass("positive"),$scope.paypalTestMode=!0,$scope.paypalLiveMode=!1,$scope.paypal_test_publishkey=$scope.paypal_setting.publishable_key,$scope.paypal_test_secretkey=$scope.paypal_setting.secret_key)))})),$scope.public_settings.paypal_test_id||$scope.public_settings.paypal_live_id||void 0!==$scope.paypal_setting&&$scope.stripe_setting||($scope.paypal_setting={connect_code:null,secret_key:"",created:"2018-10-09 13:26:07.195958-07",disabled:0,stripe_account_id:"1",person_id:user.person_id,email:null,id:"1",country_id:null,currency_id:null,client_id:"",modified:"2018-10-10 20:20:32.108648-07",access_token:null,publishable_key:"",refresh_token:null,user_id:"acct_non_valid",not_in_database:!0},$scope.paypal_setting_origin=angular.copy($scope.paypal_setting),$scope.public_settings.paypal_mode&&"live"==$scope.public_settings.paypal_mode?($("#livebtn").addClass("positive"),$scope.paypalLiveMode=!0,$scope.paypalTestMode=!1,$scope.paypal_live_publishkey=$scope.paypal_setting.publishable_key,$scope.paypal_live_secretkey=$scope.paypal_setting.secret_key):($("#testbtn").addClass("positive"),$scope.paypalTestMode=!0,$scope.paypalLiveMode=!1,$scope.paypal_test_publishkey=$scope.paypal_setting.publishable_key,$scope.paypal_test_secretkey=$scope.paypal_setting.secret_key))}function isEmpty(obj){for(var key in obj)if(obj.hasOwnProperty(key))return!1;return!0}$scope.currentUploadFile={title:"",description:"",label:"",fileName:"",icon:"file",path:"",resourceId:-1},$scope.uploadStateFile=function(files){if(files.length){$scope.isUploading=!0;FileUploadService.uploadFile("portal/resource/file",files).then((function(success){var mimeType;$scope.currentUploadFile.resourceId=success.data.id,$scope.currentUploadFile.title=$scope.currentUploadFile.title?$scope.currentUploadFile.title:success.data.name,$scope.currentUploadFile.fileName=success.data.name,$scope.currentUploadFile.path=success.data.path_external,mimeType=success.data.mime_type,/image/.test(mimeType)?$scope.currentUploadFile.icon="file image":/pdf/.test(mimeType)?$scope.currentUploadFile.icon="file pdf":/text/.test(mimeType)?$scope.currentUploadFile.icon="file text":/excel/.test(mimeType)?$scope.currentUploadFile.icon="file excel":/powerpoint/.test(mimeType)?$scope.currentUploadFile.icon="file powerpoint":/msword/.test(mimeType)?$scope.currentUploadFile.icon="file word":/video/.test(mimeType)?$scope.currentUploadFile.icon="file video":/audio/.test(mimeType)?$scope.currentUploadFile.icon="file audio":$scope.currentUploadFile.icon="file",$scope.isUploading=!1}),(function(error){$scope.isUploading=!1}))}},$scope.addStateFile=function(){$("#currentUploadeFileTitleEditor").froalaEditor("codeView.isActive")&&""!=$("#currentUploadeFileTitleEditor").froalaEditor("codeView.get")&&($scope.currentUploadFile.title=$("#currentUploadeFileTitleEditor").froalaEditor("codeView.get")),$scope.currentUploadFile.fileName&&($scope.public_settings.site_campaign_state_settings||($scope.public_settings.site_campaign_state_settings=[]),$scope.public_settings.site_campaign_state_settings.push($scope.currentUploadFile),resetFileUpload())},$scope.cancelStateFile=function(){Restangular.one("portal").one("resource/file",$scope.currentUploadFile.resourceId).customDELETE(),resetFileUpload()},$scope.removeFileFromSetting=function(fileObjIndex){var resourceId;resourceId=$scope.public_settings.site_campaign_state_settings[fileObjIndex].resourceId,reqDeleteFileArr.push(resourceId),$scope.public_settings.site_campaign_state_settings.splice(fileObjIndex,1)},$scope.makedefault=function(link){$scope.widget_default_id=link.widgetmakr_account_id},$scope.deleteFavIcon=function(){$scope.site_favicon={},SiteLogoService.setFavIcon({site_favicon:{}})},$scope.uploadLogo=function(files){if(files.length){var $picNode=$(".websiteLogo");FileUploadService.upload("portal/resource/file",files,{resource_content_type:"image"},$picNode).then((function(success){var data={site_logo:success[0].data};SiteLogoService.setLogoUrl(data),$scope.site_logo.value||($scope.site_logo.value={}),$scope.site_logo.value.path_external=success[0].data.path_external}))}},$scope.deleteLogo=function(){$scope.site_logo={},SiteLogoService.setLogoUrl({site_logo:{}}),$(".imagePlace .dimmer").dimmer("hide"),$(".ui.progress.upload-bar").show(),$(".ui.loader.download-loader").hide()},$scope.uploadMainBackground=function(files){if(files.length){var $picNode=$("#home-media-image, #home-media-video");FileUploadService.upload("portal/resource/file",files,{resource_content_type:"image"},$picNode).then((function(success){var data={site_theme_main_background:success[0].data};SiteLogoService.setMainBackground(data),$scope.main_background.value||($scope.main_background.value={}),$scope.main_background.value.path_external=success[0].data.path_external}))}},$scope.deleteMainBackground=function(){$scope.main_background={},SiteLogoService.setMainBackground({site_theme_main_background:{}}),$(".imagePlace .dimmer").dimmer("hide"),$(".ui.progress.upload-bar").show(),$(".ui.loader.download-loader").hide()},$scope.uploadExploreBackground=function(files){if(files.length){var $picNode=$("#explore-media-image, #explore-media-video");FileUploadService.upload("portal/resource/file",files,{resource_content_type:"image"},$picNode).then((function(success){var data={site_theme_explore_background:success[0].data};SiteLogoService.setExploreBackground(data),$scope.explore_background.value||($scope.explore_background.value={}),$scope.explore_background.value.path_external=success[0].data.path_external}))}},$scope.deleteExploreBackground=function(){$scope.explore_background={},SiteLogoService.setExploreBackground({site_theme_explore_background:{}}),$(".imagePlace .dimmer").dimmer("hide"),$(".ui.progress.upload-bar").show(),$(".ui.loader.download-loader").hide()},$scope.menuManage=function(menu){$scope.menuShow=!0,$scope.menu_selected=menu,"Navigation"==menu?$scope.menu_links=$scope.public_settings.site_menu_header:"Footer 1"==menu?$scope.menu_links=$scope.public_settings.site_menu_footer.left:"Footer 2"==menu&&($scope.menu_links=$scope.public_settings.site_menu_footer.right)},$scope.findPageByID=function(id){for(var i=0;i<$scope.pages.length;i++)if($scope.pages[i].id==id)return $scope.pages[i];return{}},$scope.showExternalLinkFields=function(){$scope.externalLink={name:"",path:""},$scope.isAddExternalLink=!0},$scope.setExternalLink=function(){""!=$scope.externalLink.name&&""!=$scope.externalLink.path&&($scope.menu_links.push($scope.externalLink),$scope.isAddExternalLink=!1,$scope.externalLink={name:"",path:""})},$scope.clearExternalLink=function(){$scope.isAddExternalLink=!1,$scope.externalLink={name:"",path:""}},$scope.addLink=function(page){for(var $form={id:page.id},count=0,i=0;i<$scope.menu_links.length;i++)if($form.id==$scope.menu_links[i].id){count++;break}if(0==count){var insert=!0;"Navigation"==$scope.menu_selected&&$scope.menu_links.length>=7&&($translate(["too_many_links"]).then((function(value){$scope.$parent.formData.error=value.too_many_links})),$(".response-error-modal").modal("show"),insert=!1),insert&&$scope.menu_links.push($form)}},$scope.deleteLink=function(link){for(var i=0;i<$scope.menu_links.length;i++)(null!=link.id&&$scope.menu_links[i].id==link.id||null!=link.name&&$scope.menu_links[i].name==link.name)&&$scope.menu_links.splice(i,1)},$scope.deleteMultiLink=function(){$(".menu-item").each((function(){$(this).find(".t-check-box input").prop("checked")&&$scope.deleteLink($(this).scope().link)}))},$scope.editLink=function(link){link.edit?link.edit=!1:link.edit=!0},$scope.showContent=function(e){var tar=$(e.target);tar.closest(".portal-settings-wrap").find(".setting-content").toggle(400);var icon=tar.closest(".portal-settings-wrap").find(".ui.block.header i.triangle.icon");icon.hasClass("right")?(icon.removeClass("right"),icon.addClass("down")):icon.hasClass("down")&&(icon.removeClass("down"),icon.addClass("right"))},$scope.decimalNotationSelected=function(index){$scope.public_settings.site_campaign_decimal_option=index},$scope.faqSelected=function(index){$scope.public_settings.site_faq_option=index},$scope.backerSelected=function(index){$scope.public_settings.site_backer_option=index},$scope.commentSelected=function(index){index+=1,$scope.public_settings.site_comment_option=index},$scope.streamSelected=function(index){$scope.public_settings.site_stream_option=index},$scope.setRaiseMode=function(mode){$scope.public_settings.site_campaign_raise_modes.default=mode.id},$scope.setSharingOptions=function(sharingOption){$scope.public_settings.site_campaign_sharing_options=sharingOption},$("input.comment_display_replace_reward").on("change",(function(){$("input.comment_display").not(this).prop("checked",!1),$scope.public_settings.site_campaign_comments_display=!1})),$("input.comment_display").on("change",(function(){$("input.comment_display_replace_reward").not(this).prop("checked",!1),$scope.public_settings.site_campaign_comments_display_replace_reward=!1})),$scope.customFormattingValidation=function(){var translation=$translate.instant(["tab_portalsetting_custom_reward_text_error","tab_portalsetting_custom_contribution_text_error"]);$(".ui.form#custom-formatting-form").form({custom_reward_text:{identifier:"custom_reward_text",rules:[{type:"empty",prompt:translation.tab_portalsetting_custom_reward_text_error}]},custom_contribution_text:{identifier:"custom_contribution_text",rules:[{type:"empty",prompt:translation.tab_portalsetting_custom_contribution_text_error}]}},{inline:!0,onSuccess:function(){$scope.valcheck=$scope.valcheck&&!0},onFailure:function(){$scope.valcheck=$scope.valcheck&&!1}}).form("validate form")},$scope.selectTipCurrency=function(currency){$scope.public_settings.site_tip_currency=currency},$scope.scrollTo=function(idOrClass){setTimeout((function(){var element=jQuery(idOrClass),offset=element?element.offset():null,top=offset?offset.top:null;jQuery("html, body").animate({scrollTop:top-15},"fast")}))},$scope.saveCampaignSetting=function(){msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg,$scope.public_settings.site_theme_campaign_min_button_show?$scope.minamount=$scope.public_settings.site_theme_campaign_min_contribute_amount:$scope.minamount=1,$scope.public_settings.site_campaign_private&&($scope.public_settings.site_campaign_custom_uri=!0),2==$scope.public_settings.site_campaign_defaults_runMode&&($scope.public_settings.site_campaign_fixed_campaign_duration_end=null,$scope.public_settings.site_campaign_fixed_campaign_duration_start=null);var raise_modes_selected=[];if($scope.raise_modes.forEach((function(v){v.allowed&&raise_modes_selected.push(v)})),1==raise_modes_selected.length)$scope.setRaiseMode(raise_modes_selected[0]);else if(0==raise_modes_selected.length){var translate=$translate.instant(["tab_portalsetting_campaign_raise_mode_error_msg"]);return msg={header:translate.tab_portalsetting_campaign_raise_mode_error_msg},$rootScope.floatingMessage=msg,void $scope.hideFloatingMessage()}if($scope.public_settings.site_theme_alt_shipping_layout&&(console.log($scope.public_settings.site_theme_default_shipping_country),!$scope.public_settings.site_theme_default_shipping_country||!$scope.public_settings.site_theme_default_shipping_country.name)){translate=$translate.instant(["tab_portalsetting_campaign_default_shipping_error_msg"]);return msg={header:translate.tab_portalsetting_campaign_default_shipping_error_msg},$rootScope.floatingMessage=msg,void $scope.hideFloatingMessage()}if($scope.public_settings.site_campaign_referralcandy_analytics&&$scope.public_settings.site_campaign_referralcandy_analytics.toggle&&(!$scope.public_settings.site_campaign_referralcandy_analytics.id||!$scope.private_settings.site_campaign_referralcandy_analytics_secret||!$scope.private_settings.site_campaign_referralcandy_analytics_secret.secretkey)){translate=$translate.instant(["tab_portalsetting_campaign_missing_referralcandy_info"]);return msg={header:translate.tab_portalsetting_campaign_missing_referralcandy_info},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage(),void $scope.scrollTo("#refcandy-options")}var publicSettings={site_theme_no_campaign_message:$scope.public_settings.site_theme_no_campaign_message,site_theme_campaign_grid_display:$scope.public_settings.site_theme_campaign_grid_display,site_theme_campaign_min_button_show:$scope.public_settings.site_theme_campaign_min_button_show,site_theme_campaign_per_min:$scope.public_settings.site_theme_campaign_per_min,site_theme_campaign_per_max:$scope.public_settings.site_theme_campaign_per_max,site_theme_campaign_min_contribute_amount:$scope.minamount,site_theme_campaign_max_pledge_enabled:$scope.public_settings.site_theme_campaign_max_pledge_enabled,site_theme_campaign_max_contribute_amount:$scope.public_settings.site_theme_campaign_max_contribute_amount,site_campaign_custom_uri:$scope.public_settings.site_campaign_custom_uri,site_theme_campaign_show_start_date:$scope.public_settings.site_theme_campaign_show_start_date,site_theme_campaign_display_iso_date:$scope.public_settings.site_theme_campaign_display_iso_date,allow_admin_past_dates:$scope.public_settings.allow_admin_past_dates,site_theme_alt_shipping_layout:$scope.public_settings.site_theme_alt_shipping_layout,site_theme_default_shipping_country:$scope.public_settings.site_theme_default_shipping_country,site_theme_shipping_native_lookup:$scope.public_settings.site_theme_shipping_native_lookup,site_campaign_raise_modes:{allowed:[],default:$scope.public_settings.site_campaign_raise_modes.default,pledge_processing:$scope.public_settings.site_campaign_raise_modes.pledge_processing},site_theme_campaign_faq_option:$scope.public_settings.site_faq_option,site_theme_campaign_backer_option:$scope.public_settings.site_backer_option,site_theme_campaign_comment_option:$scope.public_settings.site_comment_option,site_theme_campaign_stream_option:$scope.public_settings.site_stream_option,site_campaign_continuous_run_mode:$scope.public_settings.site_campaign_continuous_run_mode,campaign_raise_mode_only_admin:$scope.public_settings.campaign_raise_mode_only_admin,site_theme_campaign_show_reward_section:$scope.public_settings.site_theme_campaign_show_reward_section,site_theme_campaign_show_reward_required:$scope.public_settings.site_theme_campaign_show_reward_required,site_theme_campaign_show_reward_enable_variation:$scope.public_settings.site_theme_campaign_show_reward_enable_variation,site_campaign_show_reward_enable_time_limit:$scope.public_settings.site_campaign_show_reward_enable_time_limit,site_theme_campaign_reward_modal:$scope.public_settings.site_theme_campaign_reward_modal,site_theme_campaign_reward_html_editor:$scope.public_settings.site_theme_campaign_reward_html_editor,site_theme_campaign_percentage_enabled:$scope.public_settings.site_theme_campaign_percentage_enabled,site_campaign_percentage_enabled_nonadmin:$scope.public_settings.site_campaign_percentage_enabled_nonadmin,site_campaign_percentage_required:$scope.public_settings.site_campaign_percentage_required,site_admin_campaign_management_only:$scope.public_settings.site_admin_campaign_management_only,campaign_keep_status:$scope.public_settings.campaign_keep_status,campaign_always_capture:$scope.public_settings.campaign_always_capture,site_campaign_categories_limit_1:$scope.public_settings.site_campaign_categories_limit_1,site_campaign_group_management_non_admin:$scope.public_settings.site_campaign_group_management_non_admin,site_campaign_always_anonymous_contribution:$scope.public_settings.site_campaign_always_anonymous_contribution,site_theme_campaign_contribution_type_radio:$scope.public_settings.site_theme_campaign_contribution_type_radio,site_campaign_sharing_options:$scope.public_settings.site_campaign_sharing_options,site_campaign_hide_creator_info:$scope.public_settings.site_campaign_hide_creator_info,site_campaign_allow_thumbnail_video:$scope.public_settings.site_campaign_allow_thumbnail_video,site_campaign_video_required:$scope.public_settings.site_campaign_video_required,site_campaign_exclude_shipping_cost:$scope.public_settings.site_campaign_exclude_shipping_cost,site_campaign_contact_user:$scope.public_settings.site_campaign_contact_user,site_campaign_decimal_option:$scope.public_settings.site_campaign_decimal_option,site_theme_campaign_hide_min_contribute_message:$scope.public_settings.site_theme_campaign_hide_min_contribute_message,site_theme_campaign_delayed_funding_setup:$scope.public_settings.site_theme_campaign_delayed_funding_setup,site_campaign_private:$scope.public_settings.site_campaign_private,dedicated_campaign_files:$scope.public_settings.dedicated_campaign_files,campaign_content_suggestion_enabled:$scope.public_settings.campaign_content_suggestion_enabled,campaign_content_suggestion:$scope.public_settings.campaign_content_suggestion,site_campaign_charity_helper_enable:$scope.public_settings.site_campaign_charity_helper_enable,site_campaign_charity_helper_alternate_form:$scope.public_settings.site_campaign_charity_helper_alternate_form,site_campaign_charity_helper_percentage:$scope.public_settings.site_campaign_charity_helper_percentage,site_theme_campaign_contract_number_enable:$scope.public_settings.site_theme_campaign_contract_number_enable,site_campaign_max_threshold_hide:$scope.public_settings.site_campaign_max_threshold_hide,site_campaign_remove_top_header_image:$scope.public_settings.site_campaign_remove_top_header_image,site_campaign_remove_raise_mode:$scope.public_settings.site_campaign_remove_raise_mode,site_campaign_remove_time_period:$scope.public_settings.site_campaign_remove_time_period,site_campaign_fixed_campaign_duration_enable:$scope.public_settings.site_campaign_fixed_campaign_duration_enable,site_campaign_fixed_campaign_duration_start:$scope.public_settings.site_campaign_fixed_campaign_duration_start,site_campaign_fixed_campaign_duration_end:$scope.public_settings.site_campaign_fixed_campaign_duration_end,site_campaign_remove_campaign_links:$scope.public_settings.site_campaign_remove_campaign_links,site_campaign_remove_campaign_faq:$scope.public_settings.site_campaign_remove_campaign_faq,site_campaign_remove_campaign_google_analytics:$scope.public_settings.site_campaign_remove_campaign_google_analytics,site_campaign_display_creator_info_name_only:$scope.public_settings.site_campaign_display_creator_info_name_only,site_campaign_creator_info_display:$scope.public_settings.site_campaign_creator_info_display,site_campaign_backers_list_display:$scope.public_settings.site_campaign_backers_list_display,site_campaign_comments_display:$scope.public_settings.site_campaign_comments_display,site_campaign_comments_display_replace_reward:$scope.public_settings.site_campaign_comments_display_replace_reward,site_campaign_comments_display_verbose_date:$scope.public_settings.site_campaign_comments_display_verbose_date,site_campaign_page_verbose_campaign_info:$scope.public_settings.site_campaign_page_verbose_campaign_info,site_campaign_page_line_up_sidebar:$scope.public_settings.site_campaign_page_line_up_sidebar,site_campaign_page_about_share_btn:$scope.public_settings.site_campaign_page_about_share_btn,site_campaign_page_alternate_share_btn:$scope.public_settings.site_campaign_page_alternate_share_btn,site_campaign_page_simplify_backer:$scope.public_settings.site_campaign_page_simplify_backer,site_campaign_page_show_share_header:$scope.public_settings.site_campaign_page_show_share_header,site_campaign_updates_display:$scope.public_settings.site_campaign_updates_display,site_campaign_anonymous_contribution_type_only:$scope.public_settings.site_campaign_anonymous_contribution_type_only,site_campaign_allow_contribution_message:$scope.public_settings.site_campaign_allow_contribution_message,site_campaign_switch_card_label:$scope.public_settings.site_campaign_switch_card_label,site_campaign_backer_hide_profile_link:$scope.public_settings.site_campaign_backer_hide_profile_link,site_campaign_backer_hide_backed_campaigns:$scope.public_settings.site_campaign_backer_hide_backed_campaigns,site_campaign_progress_bar_hide:$scope.public_settings.site_campaign_progress_bar_hide,site_campaign_state_settings:$scope.public_settings.site_campaign_state_settings,site_campaign_state_hide:$scope.public_settings.site_campaign_state_hide,site_campaign_state_card_image_omit:$scope.public_settings.site_campaign_state_card_image_omit,site_campaign_pledge_update:$scope.public_settings.site_campaign_pledge_update,site_campaign_defaults:$scope.public_settings.site_campaign_defaults,site_campaign_defaults_runMode:$scope.public_settings.site_campaign_defaults_runMode,site_campaign_enable_campaign_bio:$scope.public_settings.site_campaign_enable_campaign_bio,site_campaign_currency_id:$scope.public_settings.site_campaign_currency_id,site_campaign_faq:$scope.public_settings.site_campaign_faq,site_campaign_move_blurb_sidebar:$scope.public_settings.site_campaign_move_blurb_sidebar,site_campaign_reward_attributes_required:$scope.public_settings.site_campaign_reward_attributes_required,site_campaign_reward_phone_required:$scope.public_settings.site_campaign_reward_phone_required,site_campaign_hide_profile:$scope.public_settings.site_campaign_hide_profile,site_campaign_custom_button:$scope.public_settings.site_campaign_custom_button,site_campaign_withdraw_hide:$scope.public_settings.site_campaign_withdraw_hide,site_campaign_contribution_layout_toggle_1:$scope.public_settings.site_campaign_contribution_layout_toggle_1,site_campaign_alt_city_input_toggle:$scope.public_settings.site_campaign_alt_city_input_toggle,site_campaign_express_toggle:$scope.public_settings.site_campaign_express_toggle,site_campaign_ecommerce_analytics:$scope.public_settings.site_campaign_ecommerce_analytics,site_campaign_facebook_analytics:$scope.public_settings.site_campaign_facebook_analytics,site_campaign_referralcandy_analytics:$scope.public_settings.site_campaign_referralcandy_analytics,site_campaign_coupon_management:$scope.public_settings.site_campaign_coupon_management,site_campaign_enable_campaign_revisions:$scope.public_settings.site_campaign_enable_campaign_revisions,site_campaign_end_hide:$scope.public_settings.site_campaign_end_hide,site_campaign_goog_shortener:$scope.public_settings.site_campaign_goog_shortener,site_campaign_hide_campaign_card_creator_or_category:$scope.public_settings.site_campaign_hide_campaign_card_creator_or_category,site_campaign_display_backers_campaign_card:$scope.public_settings.site_campaign_display_backers_campaign_card,site_theme_campaign_delayed_reward_setup:$scope.public_settings.site_theme_campaign_delayed_reward_setup,site_campaign_creator_info_display_top_bottom:$scope.public_settings.site_campaign_creator_info_display_top_bottom,site_campaign_enable_explainer_text:$scope.public_settings.site_campaign_enable_explainer_text,site_campaign_management:$scope.public_settings.site_campaign_management,site_campaign_toggle_hide_days_to_go_by_default:$scope.public_settings.site_campaign_toggle_hide_days_to_go_by_default,site_campaign_move_embed_below_comments_accordion:$scope.public_settings.site_campaign_move_embed_below_comments_accordion,site_campaign_move_backers_accordion_below_creator_accordion:$scope.public_settings.site_campaign_move_backers_accordion_below_creator_accordion,site_campaign_creator_info_display_sidebar:$scope.public_settings.site_campaign_creator_info_display_sidebar,site_campaign_share_campaign_actions_display_sidebar:$scope.public_settings.site_campaign_share_campaign_actions_display_sidebar,site_campaign_enable_organization_name:$scope.public_settings.site_campaign_enable_organization_name,site_campaign_restrict_stripe_change:$scope.public_settings.site_campaign_restrict_stripe_change,site_campaign_creator_info_display_left_header:$scope.public_settings.site_campaign_creator_info_display_left_header,site_campaign_share_display_only_fb_email_twitter:$scope.public_settings.site_campaign_share_display_only_fb_email_twitter,site_campaign_display_reward_on_mobile_tabs:$scope.public_settings.site_campaign_display_reward_on_mobile_tabs,site_campaign_creation_hide_start_page:$scope.public_settings.site_campaign_creation_hide_start_page,site_campaign_creation_field_display_stacked:$scope.public_settings.site_campaign_creation_field_display_stacked,site_campaign_creation_hide_campaign_image_field:$scope.public_settings.site_campaign_creation_hide_campaign_image_field,site_campaign_creation_hide_campaign_blurb_field:$scope.public_settings.site_campaign_creation_hide_campaign_blurb_field,site_campaign_creation_hide_campaign_category_field:$scope.public_settings.site_campaign_creation_hide_campaign_category_field,site_campaign_creation_hide_campaign_manager_field:$scope.public_settings.site_campaign_creation_hide_campaign_manager_field,site_campaign_creation_hide_campaign_description_field:$scope.public_settings.site_campaign_creation_hide_campaign_description_field,site_campaign_creation_show_campaign_image_field:$scope.public_settings.site_campaign_creation_show_campaign_image_field,site_campaign_creation_hide_campaign_rewards_fields:$scope.public_settings.site_campaign_creation_hide_campaign_rewards_fields,site_campaign_creation_show_campaign_description_field:$scope.public_settings.site_campaign_creation_show_campaign_description_field,site_campaign_creation_hide_widget_step:$scope.public_settings.site_campaign_creation_hide_widget_step,site_campaign_creation_hide_campaign_website_widget_previews:$scope.public_settings.site_campaign_creation_hide_campaign_website_widget_previews,site_campaign_creation_show_campaign_user_address_fields:$scope.public_settings.site_campaign_creation_show_campaign_user_address_fields,site_campaign_creation_split_profile_name_address_fields_to_steps:$scope.public_settings.site_campaign_creation_split_profile_name_address_fields_to_steps,site_campaign_creation_make_user_profile_address_required:$scope.public_settings.site_campaign_creation_make_user_profile_address_required,site_campaign_creation_display_previous_button_on_header:$scope.public_settings.site_campaign_creation_display_previous_button_on_header,site_campaign_creation_launch_campaign_on_step5:$scope.public_settings.site_campaign_creation_launch_campaign_on_step5,site_campaign_creation_start_campaign_on_current_date:$scope.public_settings.site_campaign_creation_start_campaign_on_current_date,site_campaign_enable_contribute_button_per_campaign:$scope.public_settings.site_campaign_enable_contribute_button_per_campaign,site_campaign_display_funding_goal_amount_on_campaign_cards:$scope.public_settings.site_campaign_display_funding_goal_amount_on_campaign_cards,site_campaign_profile_data_on_pledge:$scope.public_settings.site_campaign_profile_data_on_pledge,site_campaign_pledge_redirect:$scope.public_settings.site_campaign_pledge_redirect,site_campaign_campaign_toggle_disclaimer_text:$scope.public_settings.site_campaign_campaign_toggle_disclaimer_text},privateSettings={site_hide_transaction_details_campaign_manager:$scope.private_settings.site_hide_transaction_details_campaign_manager,site_campaign_referralcandy_analytics_secret:$scope.private_settings.site_campaign_referralcandy_analytics_secret};if($scope.public_settings.site_campaign_defaults.toggle){if(1==$scope.public_settings.site_campaign_defaults_runMode){var validDate=!0;if(void 0!==!$scope.public_settings.site_campaign_fixed_campaign_duration_start&&null!=$scope.public_settings.site_campaign_fixed_campaign_duration_start||(validDate=!1),void 0!==!$scope.public_settings.site_campaign_fixed_campaign_duration_end&&null!=$scope.public_settings.site_campaign_fixed_campaign_duration_end||(validDate=!1),!validDate){translate=$translate.instant(["tab_portalsetting_campaign_defaults_error_msg"]);return msg={header:translate.tab_portalsetting_campaign_defaults_error_msg},$rootScope.floatingMessage=msg,void $scope.hideFloatingMessage()}}}else $scope.public_settings.site_campaign_defaults.hide_fundraise=!1;if(void 0!==publicSettings.site_campaign_custom_button){if(publicSettings.site_campaign_custom_button.toggle){if($scope.valcheck=!0,$scope.customFormattingValidation(),$rootScope.scrollToError(),!$scope.valcheck){translate=$translate.instant(["tab_portalsetting_campaign_custom_formatting_error_msg"]);return msg={header:translate.tab_portalsetting_campaign_custom_formatting_error_msg},$rootScope.floatingMessage=msg,void $scope.hideFloatingMessage()}}else publicSettings.site_campaign_custom_button.reward="",publicSettings.site_campaign_custom_button.contribution="";publicSettings.site_theme_campaign_show_reward_enable_variation||(publicSettings.site_campaign_custom_button.reward="")}0==$scope.public_settings.site_campaign_defaults.percentage_fee.length&&($scope.public_settings.site_campaign_defaults.percentage_fee=10),0==$scope.public_settings.site_campaign_defaults.fundingGoal.length&&($scope.public_settings.site_campaign_defaults.fundingGoal=1e8);for(var i=0;i<$scope.raise_modes.length;i++)$scope.raise_modes[i].allowed&&publicSettings.site_campaign_raise_modes.allowed.push($scope.raise_modes[i].id);var requestQueue=[Restangular.one("portal/setting/public").customPUT(publicSettings),Restangular.one("portal/setting").customPUT(privateSettings)];$q.all(requestQueue).then((function(){msg={header:"success_message_save_changes_button"},reqDeleteFileArr.length&&(reqDeleteFileArr.forEach((function(value){Restangular.one("portal").one("resource/file",value).customDELETE()})),reqDeleteFileArr=[]),$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}),(function(failed){msg={header:failed.data.message},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))},$scope.saveCompanyInfo=function(){msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg;var publicSettings={site_theme_portal_company_name:$scope.public_settings.site_theme_portal_company_name,site_theme_portal_company_number:$scope.public_settings.site_theme_portal_company_number};Restangular.one("portal/setting/public").customPUT(publicSettings).then((function(){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}),(function(failed){msg={header:failed.data.message},$rootScope.floatingMessage=failed.data.message,$scope.hideFloatingMessage()}))},$scope.setBlockAlign=function(config){$scope.public_settings.site_home_page_text.main_banner.block_alignment=config},$scope.confirmAPISetting=function(tab){var protocol_secure=!0;switch(tab){case"site_webhooks_processor":var api_array=$scope.private_settings.site_webhooks_processor;break;case"site_webhooks_campaign":api_array=$scope.private_settings.site_webhooks_campaign}angular.forEach(api_array,(function(value,key){var webhook_uri=value.uri;""!=webhook_uri&&"https://"!=webhook_uri.substring(0,8)&&(protocol_secure=!1)})),protocol_secure?$scope.saveAPISetting(tab):($(".ui.modal.api-setting-unsecure-modal").modal("show"),$(".api-setting-unsecure-modal").modal("setting",{onApprove:function(){$scope.saveAPISetting(tab)}}))},$scope.saveAPISetting=function(tab){var api_settings={};switch(tab){case"site_webhooks_processor":api_settings.site_webhooks_processor=$scope.private_settings.site_webhooks_processor;break;case"site_webhooks_campaign":api_settings.site_webhooks_campaign=$scope.private_settings.site_webhooks_campaign}msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg,Restangular.one("portal/setting").customPUT(api_settings).then((function(success){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}),(function(failed){msg={header:failed.data.message},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))},$scope.saveThemeSetting=function(){msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg,$scope.froalaOptionsMain.froalaEditor("events.trigger","form.submit",[],!0),$scope.froalaOptionsBot.froalaEditor("events.trigger","form.submit",[],!0),$scope.froalaOptionsExplore.froalaEditor("events.trigger","form.submit",[],!0),$scope.froalaFooterCustomHtmlBlock.froalaEditor("events.trigger","form.submit",[],!0),$("#featured").is(":checked")?$scope.public_settings.site_home_page_text.titles.top_show=1:$scope.public_settings.site_home_page_text.titles.top_show=0,$("#new").is(":checked")?$scope.public_settings.site_home_page_text.titles.bottom_show=1:$scope.public_settings.site_home_page_text.titles.bottom_show=0,$("#hide-featured-in-recent").is(":checked")?$scope.public_settings.recentProjectHideFeatured=!0:$scope.public_settings.recentProjectHideFeatured=!1,$("#banner_video_mute").is(":checked")?$scope.public_settings.site_theme_banner_video_mute=!0:$scope.public_settings.site_theme_banner_video_mute=!1,void 0!==$scope.public_settings.site_logo_link?0==$scope.public_settings.site_logo_link.length&&($scope.public_settings.site_logo_link=$location.protocol()+"://"+$location.host()):$scope.public_settings.site_logo_link=$location.protocol()+"://"+$location.host();var logoUrl=SiteLogoService.getLogoUrl(),mainBackground=SiteLogoService.getMainBackground(),exploreBackground=SiteLogoService.getExploreBackground(),favIcon=SiteLogoService.getFavIcon(),loadIcon=SiteLogoService.getLoadIcon();angular.forEach($scope.public_settings.site_menu_header,(function(link){link.hasOwnProperty("edit")&&delete link.edit})),angular.forEach($scope.public_settings.site_menu_footer.left,(function(link){link.hasOwnProperty("edit")&&delete link.edit})),angular.forEach($scope.public_settings.site_menu_footer.right,(function(link){link.hasOwnProperty("edit")&&delete link.edit})),""==$scope.public_settings.site_theme_banner_video_link&&($scope.public_settings.site_theme_banner_video_link="__NULL__");var publicSettings={site_theme_sticky_menu:$scope.public_settings.site_theme_sticky_menu,site_top_nav_theme:$scope.top_nav_theme,site_theme_category_display:$scope.public_settings.site_theme_category_display,site_theme_category_display_footer:$scope.public_settings.site_theme_category_display_footer,site_home_page_text:$scope.public_settings.site_home_page_text,site_explore_page_text:$scope.public_settings.site_explore_page_text,site_footer_text:$scope.public_settings.site_footer_text,site_menu_header:$scope.public_settings.site_menu_header,site_menu_footer:$scope.public_settings.site_menu_footer,site_company:$scope.public_settings.site_company,site_theme_color:$scope.public_settings.site_theme_color,site_favicon:favIcon?favIcon.site_favicon:null,site_logo:logoUrl?logoUrl.site_logo:null,site_load_icon:loadIcon?loadIcon.site_load_icon:null,site_load_class:$scope.site_load_class,site_theme_main_background:mainBackground?mainBackground.site_theme_main_background:null,site_theme_explore_background:exploreBackground?exploreBackground.site_theme_explore_background:null,site_logo_link:$scope.public_settings.site_logo_link,site_theme_category_display_explore_sidebar:$scope.public_settings.site_theme_category_display_explore_sidebar,site_theme_category_display_with_campaigns_only:$scope.public_settings.site_theme_category_display_with_campaigns_only,site_theme_banner_video_link:$scope.public_settings.site_theme_banner_video_link,site_theme_banner_is_image:$scope.public_settings.site_theme_banner_is_image,site_theme_banner_video_mute:$scope.public_settings.site_theme_banner_video_mute,recentProjectHideFeatured:$scope.public_settings.recentProjectHideFeatured,exclude_ended_from_recent:$scope.public_settings.exclude_ended_from_recent,campaign_randomize:$scope.public_settings.campaign_randomize,logo_links:$scope.public_settings.logo_links,site_enable_auto_select_subcat:$scope.public_settings.site_enable_auto_select_subcat,site_search_explore:$scope.public_settings.site_search_explore,site_homepage_custom_html_block:$scope.public_settings.site_homepage_custom_html_block,site_footer_custom_html_block:$scope.public_settings.site_footer_custom_html_block,site_search_explore:$scope.public_settings.site_search_explore,site_campaign_strong_customer_auth:$scope.public_settings.site_campaign_strong_customer_auth};if((void 0===$scope.public_settings.site_home_page_text.main_banner||($scope.public_settings.site_home_page_text.main_banner.html=$scope.replaceInsideStyleTag($scope.public_settings.site_home_page_text.main_banner.html),$scope.isCodeValid=!isDocumentWrite($scope.public_settings.site_home_page_text.main_banner.html),$scope.isCodeValid))&&(void 0===$scope.public_settings.site_home_page_text.bottom_banner||($scope.public_settings.site_home_page_text.bottom_banner.html=$scope.replaceInsideStyleTag($scope.public_settings.site_home_page_text.bottom_banner.html),$scope.isCodeValid=!isDocumentWrite($scope.public_settings.site_home_page_text.bottom_banner.html),$scope.isCodeValid))&&(void 0===$scope.public_settings.site_footer_custom_html_block||($scope.public_settings.site_footer_custom_html_block.html=$scope.replaceInsideStyleTag($scope.public_settings.site_footer_custom_html_block.html),$scope.isCodeValid=!isDocumentWrite($scope.public_settings.site_footer_custom_html_block.html),$scope.isCodeValid))&&(void 0===$scope.public_settings.site_homepage_custom_html_block||($scope.public_settings.site_homepage_custom_html_block.html=$scope.replaceInsideStyleTag($scope.public_settings.site_homepage_custom_html_block.html),$scope.isCodeValid=!isDocumentWrite($scope.public_settings.site_homepage_custom_html_block.html),$scope.isCodeValid))&&(void 0===$scope.public_settings.site_explore_page_text||($scope.public_settings.site_explore_page_text.html=$scope.replaceInsideStyleTag($scope.public_settings.site_explore_page_text.html),$scope.isCodeValid=!isDocumentWrite($scope.public_settings.site_explore_page_text.html),$scope.isCodeValid))&&$scope.isCodeValid){var request=Restangular.one("portal/setting/public").customPUT(publicSettings);SiteLogoService.setLogoUrl(null),SiteLogoService.setMainBackground(null),SiteLogoService.setExploreBackground(null),SiteLogoService.setFavIcon(null),SiteLogoService.setLoadIcon(null),updateThemeColor(),$scope.loadPreviewVideo(),request.then((function(){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}),(function(failed){msg={header:failed.data.message},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))}},$scope.setBannerIsImage=function(val){$scope.public_settings.site_theme_banner_is_image=val},setTimeout((function(){$translate(["allow_registereduser","allow_guest","allow_both","disabledguest"]).then((function(value){$scope.registeruser=value.allow_registereduser,$scope.guest=value.allow_guest,$scope.both=value.allow_both,$scope.disable=value.disabledguest,$scope.contribution_modes=[{type:$scope.registeruser,value:1},{type:$scope.guest,value:2},{type:$scope.both,value:3},{type:$scope.disable,value:4}]}))}),1e3),$scope.setExploreDefaultSort=function(item){$scope.public_settings.site_set_explore_default_sort.default=item.value,$scope.public_settings.site_set_explore_default_sort.default_text=item.type},$scope.customFieldSaveAttrPermission=function(){$scope.public_settings.site_person_attributes_non_admin=!0,$scope.saveSiteSetting()},$scope.validateTipTier=function(){var translation=$translate.instant(["tab_portalsetting_tipping_tier_specify"]);msg={header:translation.tab_portalsetting_tipping_tier_specify},$rootScope.floatingMessage=msg,$("html, body").animate({scrollTop:$(".campaign-tipping-form.ui.form").offset().top},1e3)},$scope.validateEmail=function(email){return!!/(?:"?([^"]*)"?\s)?(?:<?(.+@[^>]+)>?)/.test(email.toLowerCase())},$scope.validateMailSendFrom=function(){var translation=$translate.instant(["tab_portalsetting_Mail_SendFrom_invalid"]);msg={header:translation.tab_portalsetting_Mail_SendFrom_invalid},$rootScope.floatingMessage=msg,$("html, body").animate({scrollTop:$("#mail-sendfrom").offset().top},1e3)},$scope.validateMailAdmin=function(){var translation=$translate.instant(["tab_portalsetting_Mail_Admin_invalid"]);msg={header:translation.tab_portalsetting_Mail_Admin_invalid},$rootScope.floatingMessage=msg,$("html, body").animate({scrollTop:$("#mail-admin").offset().top},1e3)},$scope.validateTippingOptions=function(){var translation=$translate.instant(["tab_portalsetting_tipping_error"]);$(".campaign-tipping-form.ui.form").form({no_tip:{identifier:"tip_manual",rules:[{type:"checked",prompt:translation.tab_portalsetting_tipping_error}]},toggle_tiers:{identifier:"toggle_tiers",rules:[{type:"checked",prompt:translation.tab_portalsetting_tipping_error}]}},{inline:!0,onFailure:function(){$("html, body").animate({scrollTop:$(".field.error").offset().top},1e3)}}).form("validate form")},$.fn.form.settings.rules.url=function(value){return 0==value.indexOf("http://")||0==value.indexOf("https://")},$scope.validateOktaSettings=function(){if($scope.public_settings.social_login.okta_domain&&$scope.public_settings.social_login.okta_clientId&&$scope.private_settings.social_login.okta_apiKey&&(0==$scope.public_settings.social_login.okta_domain.indexOf("http://")||0==$scope.public_settings.social_login.okta_domain.indexOf("https://")))return!0;var translation=$translate.instant(["tab_portalsetting_social_login_okta_domain_invalid","tab_portalsetting_social_login_okta_domain_empty","tab_portalsetting_social_login_okta_client_id_empty","tab_portalsetting_social_login_okta_group_id_empty","tab_portalsetting_social_login_okta_api_key_empty"]);return $("#socialLogin-options").form({okta_domain:{identifier:"okta_domain",rules:[{type:"empty",prompt:translation.tab_portalsetting_social_login_okta_domain_empty},{type:"url",prompt:translation.tab_portalsetting_social_login_okta_domain_invalid}]},okta_clientId:{identifier:"okta_clientId",rules:[{type:"empty",prompt:translation.tab_portalsetting_social_login_okta_client_id_empty}]},okta_apiKey:{identifier:"okta_apiKey",rules:[{type:"empty",prompt:translation.tab_portalsetting_social_login_okta_api_key_empty}]}},{inline:!0,onFailure:function(){$("html, body").animate({scrollTop:$(".field.error").offset().top},1e3)}}).form("validate form"),!1},$scope.saveSiteSetting=function(){if($scope.public_settings.site_tipping.toggle_tiers&&0==$scope.public_settings.site_tipping.tiers.length)$scope.validateTipTier();else if(!$scope.public_settings.site_tipping.toggle||$scope.public_settings.site_tipping.toggle_tiers||$scope.public_settings.site_tipping.toggle_dynamic)if(!$scope.private_settings.site_email_address_from||$scope.validateEmail($scope.private_settings.site_email_address_from))if(!$scope.private_settings.site_email_address_admin||$scope.validateEmail($scope.private_settings.site_email_address_admin)){if(!$scope.public_settings.social_login.toggle||$scope.validateOktaSettings()){$scope.public_settings.site_analytics_code||($scope.public_settings.site_analytics_code="<script><\/script>"),msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg;var requestQueue=[];$scope.loginRedirect.text||$scope.loginRedirect.link||($scope.loginRedirect={text:"",link:""}),$scope.registerRedirect.text||$scope.registerRedirect.link||($scope.registerRedirect={text:"",link:""}),$scope.public_settings.site_contribute_behaviour;var register=!1,express=!1;angular.forEach($scope.inlineContributionOptions,(function(value,key,obj){value&&"register"==key&&(register=!0),(value&&"express"==key||value&&"guest"==key)&&(express=!0)})),register&&!express&&($scope.public_settings.site_contribute_behaviour.default=1),register||express||($scope.public_settings.site_contribute_behaviour.default=4),!register&&express&&($scope.public_settings.site_contribute_behaviour.default=5),register&&express&&($scope.public_settings.site_contribute_behaviour.default=6);var publicSettings={site_social_media_links:$scope.public_settings.site_social_media_links,site_maintenance_mode:$scope.site_maintenance_mode,site_api_connection_message:$scope.site_api_connection_message.value,site_analytics_code:$scope.public_settings.site_analytics_code,site_contribute_behaviour:$scope.public_settings.site_contribute_behaviour,site_auto_approve_new_users:$scope.public_settings.site_auto_approve_new_users,site_auto_account_approve_email_notify:$scope.public_settings.site_auto_account_approve_email_notify,site_auto_approve_new_campaigns:$scope.public_settings.site_auto_approve_new_campaigns,site_person_attributes_non_admin_read_all_disallow:$scope.public_settings.site_person_attributes_non_admin_read_all_disallow,site_tos_contribution_ui:$scope.public_settings.site_tos_contribution_ui,site_tos_campaign_submit:$scope.public_settings.site_tos_campaign_submit,site_tos_registration_ui:$scope.public_settings.site_tos_registration_ui,site_tos_login_ui:$scope.public_settings.site_tos_login_ui,site_case_insensitive_campaign_path:$scope.public_settings.site_case_insensitive_campaign_path,site_notify_admin_all_contributions:$scope.public_settings.site_notify_admin_all_contributions,site_auth_scheme:$scope.public_settings.site_auth_scheme,site_disable_account_setting:$scope.public_settings.site_disable_account_setting,site_person_attributes_non_admin:$scope.public_settings.site_person_attributes_non_admin,site_person_public_view:$scope.public_settings.site_person_public_view,site_login_redirect:$scope.loginRedirect,site_register_redirect:$scope.registerRedirect,site_enable_advanced_widget:$scope.public_settings.site_enable_advanced_widget,site_remove_user_profile_bio:$scope.public_settings.site_remove_user_profile_bio,site_allow_anonymous_contact_message:$scope.public_settings.site_allow_anonymous_contact_message,site_increase_featured_campaigns_limit:$scope.public_settings.site_increase_featured_campaigns_limit,site_set_explore_default_sort:$scope.public_settings.site_set_explore_default_sort,site_infinite_scroller:$scope.public_settings.site_infinite_scroller,site_default_campaign_rows:$scope.public_settings.site_default_campaign_rows,site_enable_cookie_consent:$scope.public_settings.site_enable_cookie_consent,site_disable_unsupported_browsers:$scope.public_settings.site_disable_unsupported_browsers,site_tipping:$scope.public_settings.site_tipping,site_verification:$scope.public_settings.site_verification,social_login:$scope.public_settings.social_login,site_campaign_combine_amount_tip:$scope.public_settings.site_campaign_combine_amount_tip,site_tip_currency:$scope.public_settings.site_tip_currency};if(publicSettings.social_login={toggle:$scope.public_settings.social_login.toggle,providers:$scope.public_settings.social_login.providers},$scope.isCodeValid=!isDocumentWrite($scope.public_settings.site_analytics_code),$scope.isCodeValid){requestQueue.push(Restangular.one("portal/setting/public").customPUT(publicSettings));var privateSettings={site_email_address_from:$scope.private_settings.site_email_address_from,site_email_address_admin:$scope.private_settings.site_email_address_admin};$scope.private_settings.social_login&&(privateSettings.okta_domain=$scope.private_settings.social_login.okta_domain,privateSettings.otka_clientId=$scope.private_settings.social_login.otka_clientId),$scope.public_settings.social_login&&(publicSettings.social_login={toggle:$scope.public_settings.social_login.toggle,toggle_iframe:$scope.public_settings.social_login.toggle_iframe,providers:$scope.public_settings.social_login.providers,okta_clientId:$scope.public_settings.social_login.okta_clientId,okta_domain:$scope.public_settings.social_login.okta_domain}),$scope.private_settings.social_login&&(privateSettings.social_login={okta_apiKey:$scope.private_settings.social_login.okta_apiKey}),requestQueue.push(Restangular.one("portal/setting").customPUT(privateSettings)),$q.all(requestQueue).then((function(){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}),(function(failed){msg={header:failed.data.message},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))}}}else $scope.validateMailAdmin();else $scope.validateMailSendFrom();else $scope.validateTippingOptions()},$scope.getStripeCountry=function(){return Restangular.one("account/stripe/country").customGET().then((function(success){$scope.stripeCountries=success}))},$scope.getStripeCountry(),$scope.setStripeCountry=function(cid){$scope.stripe_setting.country_id=cid,$scope.stripe_setting_origin.country_id=cid,Restangular.one("account/stripe").customGET("currency",{country_id:cid}).then((function(success){$scope.public_settings.site_theme_shipping_native_lookup&&success.forEach((function(value){value.name=value.native_name?value.native_name:value.name})),$scope.stripeSupportedCurrencies=success}))},$scope.stripeCountryEnter=function(event){if(13==event.keyCode){var country_id=event.target.querySelector("input").value;$scope.setStripeCountry(country_id)}},$scope.saveStripePortalSettings=function(){var privateSettings={site_stripe:{test:{clientId:$scope.stripe_test_clientId,publishkey:$scope.stripe_test_publishkey,secretkey:$scope.stripe_test_secretkey},live:{clientId:$scope.stripe_live_clientId,publishkey:$scope.stripe_live_publishkey,secretkey:$scope.stripe_live_secretkey}}};Restangular.one("portal/setting").customPUT(privateSettings).then((function(){angular.copy($scope.stripe_setting_origin,$scope.stripe_setting)}))},$scope.updateStripeApplication=function(){resetStripeKeyErrors(),Restangular.one("account/stripe/application").customPUT($scope.stripe_setting).then((function(success){$scope.saveStripePortalSettings(),msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage(),$scope.public_settings.site_campaign_fee_currency=[];for(var j=0;j<$scope.currency_setting.currency_ids.length;j++)for(var i=0;i<$scope.stripeSupportedCurrencies.length;i++)$scope.stripeSupportedCurrencies[i].currency_id==$scope.currency_setting.currency_ids[j]&&$scope.public_settings.site_campaign_fee_currency.push($scope.stripeSupportedCurrencies[i]);$scope.public_settings.site_campaign_fee_direct_transaction&&($scope.stripe_fee.campaign_fee=0);var data={site_campaign_fee_percentage:$scope.stripe_fee.campaign_fee,site_campaign_fee_currency:$scope.public_settings.site_campaign_fee_currency,site_campaign_fee_direct_transaction:$scope.public_settings.site_campaign_fee_direct_transaction},public_setting_call=Restangular.one("portal/setting/public").customPUT(data),private_data={site_campaign_fee_direct_transaction_account:$scope.private_settings.site_campaign_fee_direct_transaction_account},private_setting_call=Restangular.one("portal/setting").customPUT(private_data);$q.all([public_setting_call,private_setting_call]).then((function(success){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}),(function(failure){msg={header:failure.data.message},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))}),(function(failure){var translation;msg={header:failure.data.message},"account_profile_stripe_application_update"!=failure.data.code&&"account_profile_stripe_group_application_update"!=failure.data.code||(msg.header=$translate.instant("tab_portalsetting_payment_Setting_stripe_keys_incorrect")),translation=$translate.instant(["tab_portalsetting_payment_Setting_public_key_format","tab_portalsetting_payment_Setting_secret_key_format","tab_portalsetting_payment_Setting_client_key_format"]),$scope.livemode?($(".secret-key-error").remove(),$("#live_secret_key").append('<div class="secret-key-error ui red pointing prompt label transition visible">'+translation.tab_portalsetting_payment_Setting_secret_key_format+"</div>"),$("#live_secret_key").addClass("error"),$(".publish-key-error").remove(),$("#live_publish_key").append('<div class="publish-key-error ui red pointing prompt label transition visible">'+translation.tab_portalsetting_payment_Setting_public_key_format+"</div>"),$("#live_publish_key").addClass("error"),$("#live_client_id").parent().hasClass("ng-hide")||($(".client-key-error").remove(),$("#live_client_id").append('<div class="client-key-error ui red pointing prompt label transition visible">'+translation.tab_portalsetting_payment_Setting_client_key_format+"</div>"),$("#live_client_id").addClass("error"))):($(".secret-key-error").remove(),$("#test_secret_key").append('<div class="secret-key-error ui red pointing prompt label transition visible">'+translation.tab_portalsetting_payment_Setting_secret_key_format+"</div>"),$("#test_secret_key").addClass("error"),$(".publish-key-error").remove(),$("#test_publish_key").append('<div class="publish-key-error ui red pointing prompt label transition visible">'+translation.tab_portalsetting_payment_Setting_public_key_format+"</div>"),$("#test_publish_key").addClass("error"),$("#test_client_id").parent().hasClass("ng-hide")||($(".client-key-error").remove(),$("#test_client_id").append('<div class="client-key-error ui red pointing prompt label transition visible">'+translation.tab_portalsetting_payment_Setting_client_key_format+"</div>"),$("#test_client_id").addClass("error"))),$rootScope.floatingMessage=msg,$scope.hideFloatingMessage(),$rootScope.scrollToError()}))},$scope.createStripeApplication=function(){Restangular.one("account/stripe/application").customPOST($scope.stripe_setting).then((function(success){$scope.saveStripePortalSettings(),msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage(),$scope.public_settings.site_campaign_fee_currency=[];for(var j=0;j<$scope.currency_setting.currency_ids.length;j++)for(var i=0;i<$scope.stripeSupportedCurrencies.length;i++)$scope.stripeSupportedCurrencies[i].currency_id==$scope.currency_setting.currency_ids[j]&&$scope.public_settings.site_campaign_fee_currency.push($scope.stripeSupportedCurrencies[i]);$scope.public_settings.site_campaign_fee_direct_transaction&&($scope.stripe_fee.campaign_fee=0);var data={site_campaign_fee_percentage:$scope.stripe_fee.campaign_fee,site_campaign_fee_currency:$scope.public_settings.site_campaign_fee_currency,site_campaign_fee_direct_transaction:$scope.public_settings.site_campaign_fee_direct_transaction},public_setting_call=Restangular.one("portal/setting/public").customPUT(data);$q.all([public_setting_call]).then((function(success){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}),(function(failure){msg={header:failure.data.message},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))}),(function(failure){msg={header:failure.data.message},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))},$scope.currency_setting={},$scope.updateStripe=function(){msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg;var privateSettings={site_stripe:{test:{clientId:$scope.stripe_test_clientId,publishkey:$scope.stripe_test_publishkey,secretkey:$scope.stripe_test_secretkey},live:{clientId:$scope.stripe_live_clientId,publishkey:$scope.stripe_live_publishkey,secretkey:$scope.stripe_live_secretkey}}};if($("#livebtn").hasClass("positive")&&($scope.public_settings.site_campaign_fee_direct_transaction?$scope.stripe_setting.client_id="client_id_dummy":$scope.stripe_setting.client_id=privateSettings.site_stripe.live.clientId,$scope.stripe_setting.publishable_key=privateSettings.site_stripe.live.publishkey,$scope.stripe_setting.secret_key=privateSettings.site_stripe.live.secretkey),$("#testbtn").hasClass("positive")&&($scope.public_settings.site_campaign_fee_direct_transaction?$scope.stripe_setting.client_id="client_id_dummy":$scope.stripe_setting.client_id=privateSettings.site_stripe.test.clientId,$scope.stripe_setting.publishable_key=privateSettings.site_stripe.test.publishkey,$scope.stripe_setting.secret_key=privateSettings.site_stripe.test.secretkey),$("#standard-btn").hasClass("positive")?($scope.public_settings.stripe_standard_mode=!0,$scope.public_settings.stripe_express_mode=!1,$("#standard-btn").addClass("positive"),$("#express-btn").removeClass("positive")):$("#express-btn").hasClass("positive")&&($scope.public_settings.stripe_standard_mode=!1,$scope.public_settings.stripe_express_mode=!0,$("#express-btn").addClass("positive"),$("#standard-btn").removeClass("positive")),$scope.testmode&&isEmpty(privateSettings.site_stripe.test)&&($scope.stripe_no_keys=!0),$scope.livemode&&isEmpty(privateSettings.site_stripe.live)&&($scope.stripe_no_keys=!0),(!$scope.public_settings.site_campaign_fee_direct_transaction&&$scope.stripe_setting.client_id!==$scope.stripe_setting_origin.client_id||$scope.stripe_setting.secret_key!==$scope.stripe_setting_origin.secret_key||$scope.stripe_setting.publishable_key!==$scope.stripe_setting_origin.publishable_key)&&$scope.public_settings.payment_setting_enabled)$rootScope.floatingMessage=[],Restangular.one("account/stripe/application").customGET().then((function(success){msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage();var stripe_setting=success.plain(),hide_modal=!1;stripe_setting.publishable_key&&"public_id_dummy"!=stripe_setting.publishable_key||(hide_modal=!0),stripe_setting.secret_key&&"secret_key_dummy"!=stripe_setting.secret_key||(hide_modal=!0),hide_modal?1==$scope.stripe_setting.not_in_database?($scope.stripe_setting.skip_user_id=!0,delete $scope.stripe_setting.not_in_database,$scope.createStripeApplication()):$scope.updateStripeApplication():$(".ui.modal.dangerous-action-alert").modal({onApprove:function(){$scope.updateStripeApplication()},onDeny:function(){angular.copy($scope.stripe_setting_origin,$scope.stripe_setting)}}).modal("show")}));else{$scope.saveStripePortalSettings(),msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg,$scope.public_settings.site_campaign_fee_currency=[];for(var j=0;j<$scope.currency_setting.currency_ids.length;j++)for(var i=0;i<$scope.stripeSupportedCurrencies.length;i++)$scope.stripeSupportedCurrencies[i].currency_id==$scope.currency_setting.currency_ids[j]&&$scope.public_settings.site_campaign_fee_currency.push($scope.stripeSupportedCurrencies[i]);$scope.public_settings.site_campaign_fee_direct_transaction&&($scope.stripe_fee.campaign_fee=100);var data={site_campaign_fee_percentage:$scope.stripe_fee.campaign_fee,site_campaign_fee_currency:$scope.public_settings.site_campaign_fee_currency,site_campaign_fee_direct_transaction:$scope.public_settings.site_campaign_fee_direct_transaction},paymentSettingReq=[],public_setting_call=Restangular.one("portal/setting/public").customPUT(data);if(paymentSettingReq.push(public_setting_call),$scope.public_settings.payment_setting_enabled){$scope.stripe_setting.skip_user_id=!1;var site_campaign_contribution_request=Restangular.one("portal/setting/public").customPUT({site_campaign_contributions:!0})}else{$scope.stripe_setting.skip_user_id=!0;site_campaign_contribution_request=Restangular.one("portal/setting/public").customPUT({site_campaign_contributions:!1,site_campaign_contributions_instruction:$scope.public_settings.site_campaign_contributions_instruction?$scope.public_settings.site_campaign_contributions_instruction:"<p>Your campaign contribution instructions.</p>"})}paymentSettingReq.push(site_campaign_contribution_request),$scope.stripe_setting.secret_key||($scope.stripe_setting.secret_key="secret_key_dummy"),$scope.stripe_setting.client_id||($scope.stripe_setting.client_id="client_id_dummy"),$scope.stripe_setting.publishable_key||($scope.stripe_setting.publishable_key="public_id_dummy"),$scope.public_settings.stripe_standard_mode||$scope.public_settings.stripe_express_mode||($scope.public_settings.stripe_standard_mode=!0,$scope.public_settings.stripe_express_mode=!1),!$scope.public_settings.stripe_standard_mode&&$scope.public_settings.stripe_express_mode&&($scope.public_settings.stripe_standard_mode=!1,$scope.public_settings.stripe_express_mode=!0);var save_stripe_application=Restangular.one("account/stripe/application").customPUT($scope.stripe_setting);paymentSettingReq.push(save_stripe_application),$q.all(paymentSettingReq).then((function(success){updateSiteMenu(),msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}),(function(failure){msg={header:failure.data.message},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))}},$scope.paypalValidate=function(){var translation=$translate.instant(["tab_portalsetting_Paypalsetting_country_incorrect","tab_portalsetting_currency_prompt_empty","tab_portalsetting_Paypalsetting_client_key_incorrect","tab_portalsetting_Paypalsetting_secret_key_incorrect"]),validation={paypal_country:{identifier:"paypal_country",rules:[{type:"empty",prompt:translation.tab_portalsetting_Paypalsetting_country_incorrect}]},test_secret_key:{identifier:"test_secret_key_paypal",rules:[{type:"empty",prompt:translation.tab_portalsetting_Paypalsetting_secret_key_incorrect}]},test_publish_key:{identifier:"test_publish_key_paypal",rules:[{type:"empty",prompt:translation.tab_portalsetting_Paypalsetting_client_key_incorrect}]}};$scope.paypalLiveMode&&(validation={paypal_country:{identifier:"paypal_country",rules:[{type:"empty",prompt:translation.tab_portalsetting_Paypalsetting_country_incorrect}]},live_secret_key:{identifier:"live_secret_key_paypal",rules:[{type:"empty",prompt:translation.tab_portalsetting_Paypalsetting_secret_key_incorrect}]},live_publish_key:{identifier:"live_publish_key_paypal",rules:[{type:"empty",prompt:translation.tab_portalsetting_Paypalsetting_client_key_incorrect}]}}),$(".ui.form").form(validation,{inline:!0,onSuccess:function(){$scope.valcheck=$scope.valcheck&&!0},onFailure:function(){$scope.valcheck=$scope.valcheck&&!1}}).form("validate form"),$(".paypal-currency-field .select2-choices li").hasClass("select2-search-choice")?($(".select-error").remove(),$(".paypal-currency-field").removeClass("error"),$scope.valcheck=$scope.valcheck&&!0):($(".select-error").remove(),$(".paypal-currency-field").append('<div class="select-error ui red pointing prompt label transition visible">'+translation.tab_portalsetting_currency_prompt_empty+"</div>"),$(".paypal-currency-field").addClass("error"),$scope.valcheck=$scope.valcheck&&!1)},$scope.getPaypalCountry=function(){return Restangular.one("account/paypal/country").customGET().then((function(success){$scope.paypalCountries=success}))},$scope.getPaypalCountry(),$scope.setPaypalCountry=function(cid){$scope.paypal_setting.country_id=cid,$scope.paypal_setting_origin.country_id=cid,Restangular.one("account/paypal").customGET("currency",{country_id:cid}).then((function(success){$scope.public_settings.site_theme_shipping_native_lookup&&success.forEach((function(value){value.name=value.native_name?value.native_name:value.name})),$scope.paypalSupportedCurrencies=success}))},$scope.paypalCountryEnter=function(event){if(13==event.keyCode){var country_id=event.target.querySelector("input").value;$scope.setPaypalCountry(country_id)}},$scope.savePayPal=function(){console.log("savePaypal"),msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg,$(".paypal-live").hasClass("positive")&&($scope.paypal_setting.publishable_key=$scope.paypal_live_publishkey,$scope.paypal_setting.secret_key=$scope.paypal_live_secretkey),$(".paypal-test").hasClass("positive")&&($scope.paypal_setting.publishable_key=$scope.paypal_test_publishkey,$scope.paypal_setting.secret_key=$scope.paypal_test_secretkey),$scope.paypalTestMode&&isEmpty($scope.paypal_test_secretkey)&&isEmpty($scope.paypal_test_publishkey)&&($scope.paypal_no_keys=!0),$scope.paypalLiveMode&&isEmpty($scope.paypal_test_secretkey)&&isEmpty($scope.paypal_live_publishkey)&&($scope.paypal_no_keys=!0),$rootScope.floatingMessage=[];var application_id="1";$scope.public_settings.paypal_test_id&&$scope.public_settings.paypal_mode&&"test"==$scope.public_settings.paypal_mode&&(application_id=$scope.public_settings.paypal_test_id),$scope.public_settings.paypal_live_id&&$scope.public_settings.paypal_mode&&"live"==$scope.public_settings.paypal_mode&&(application_id=$scope.public_settings.paypal_live_id),$scope.public_settings.site_campaign_fee_currency=[];for(var j=0;j<$scope.currency_setting.currency_ids.length;j++)for(var i=0;i<$scope.paypalSupportedCurrencies.length;i++)$scope.paypalSupportedCurrencies[i].currency_id==$scope.currency_setting.currency_ids[j]&&$scope.public_settings.site_campaign_fee_currency.push($scope.paypalSupportedCurrencies[i]);$scope.public_settings.site_campaign_fee_currency[0]&&($scope.paypal_setting.currency_id=$scope.public_settings.site_campaign_fee_currency[0].currency_id),Restangular.one("account/paypal/application").customGET(application_id).then((function(success){msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage(),$scope.public_settings.paypal_live_id&&$scope.paypalLiveMode&&!parseInt($scope.public_settings.paypal_live_id)||$scope.public_settings.paypal_test_id&&$scope.paypalLiveMode&&$scope.public_settings.paypal_test_id==$scope.paypal_setting.id||$scope.public_settings.paypal_test_id&&$scope.paypalTestMode&&!parseInt($scope.public_settings.paypal_test_id)||$scope.public_settings.paypal_live_id&&$scope.paypalTestMode&&$scope.public_settings.paypal_live_id==$scope.paypal_setting.id?($scope.paypal_setting.not_in_database=!1,$scope.paypal_setting.id="1",Restangular.one("account/paypal/application").customPOST($scope.paypal_setting).then((function(success){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage(),$scope.paypalSaveApplicationID(success)}))):Restangular.one("account/paypal/application").customPUT($scope.paypal_setting).then((function(success){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage(),$scope.paypalSaveApplicationID(success)}))}),(function(failure){"entity_not_found"==failure.data.code&&Restangular.one("account/paypal/application").customPOST($scope.paypal_setting).then((function(success){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage(),$scope.paypalSaveApplicationID(success)}))}))},$scope.paypalSaveApplicationID=function(application){var paymentSettingReq=[];$scope.paypalLiveMode&&($scope.public_settings.paypal_live_id=application.id),$scope.paypalTestMode&&($scope.public_settings.paypal_test_id=application.id),$scope.public_settings.site_campaign_fee_currency=[];for(var j=0;j<$scope.currency_setting.currency_ids.length;j++)for(var i=0;i<$scope.paypalSupportedCurrencies.length;i++)$scope.paypalSupportedCurrencies[i].currency_id==$scope.currency_setting.currency_ids[j]&&$scope.public_settings.site_campaign_fee_currency.push($scope.paypalSupportedCurrencies[i]);$scope.public_settings.site_payment_gateway=$scope.paymentId,$scope.public_settings.paypal_publishable_key=$scope.paypal_setting.publishable_key,$scope.public_settings.paypal_mode="live",$scope.paypalTestMode&&($scope.public_settings.paypal_mode="test");var public_setting_call=Restangular.one("portal/setting/public").customPUT($scope.public_settings);paymentSettingReq.push(public_setting_call),$q.all(paymentSettingReq).then((function(success){getPayPalApplication(),msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}),(function(failure){msg={header:failure.data.message},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))},$scope.raiseModeChange=function(mode){if(0==mode.allowed){mode.default=!1;for(var count=0,i=0;i<$scope.raise_modes.length;i++)if($scope.raise_modes[i].allowed){count++;break}if(0==count)$scope.error_content="tab_portalsetting_select_raise_mode_error",$(".error-modal").modal("show"),mode.allowed=!0;else if(1==count){for(var index=0,j=0;j<$scope.raise_modes.length;j++)$scope.raise_modes[j].allowed&&(index=j);$(".default_mode").attr("value",index+1),$(".default-mode-text").text($scope.raise_modes[index].description)}else $(".default_mode").val()==mode.id&&($(".default_mode").removeAttr("value"),$(".default-mode-text").text("Select Default Mode"))}mode.default&&mode.allowed&&($scope.default_mode=mode.description)},$scope.currencypicker={width:"100%"},$scope.restoreThemeSettings=function(){$scope.public_settings.site_theme_color.banner_color.index=4,$scope.public_settings.site_theme_color.banner_color.value="#4C9EE7",$scope.public_settings.site_theme_color.button_color.index=4,$scope.public_settings.site_theme_color.button_color.value="#4C9EE7",$scope.public_settings.site_theme_color.font_color.index=4,$scope.public_settings.site_theme_color.font_color.value="#4C9EE7",$scope.public_settings.site_theme_color.footer_background_color.index=9,$scope.public_settings.site_theme_color.footer_background_color.value="#333333",$scope.public_settings.site_theme_color.footer_font_color.index=10,$scope.public_settings.site_theme_color.footer_font_color.value="#ffffff",$scope.public_settings.site_theme_color.reward_block_color.index=3,$scope.public_settings.site_theme_color.reward_block_color.value="#00B5AD",$scope.public_settings.site_theme_color.table_color.index=4,$scope.public_settings.site_theme_color.table_color.value="#4C9EE7",$scope.public_settings.site_theme_color.top_nav_background_color.index=9,$scope.public_settings.site_theme_color.top_nav_background_color.value="#333333",$scope.public_settings.site_theme_color.top_nav_font_color.index=10,$scope.public_settings.site_theme_color.top_nav_font_color.value="#ffffff"},$scope.selectLoadClass=function(semantic_icon){$scope.site_load_class=semantic_icon.name},$scope.selectColorSection=function(section){$scope.selected_color_section=section},$scope.selectSocialMedia=function(obj){$scope.media_selected=obj},$scope.selectSearchFilter=function(index){$scope.public_settings.site_search_explore=$scope.searchFilters[index]},$scope.validateFacebookComment=function(){var translation=$translate.instant(["tab_portalsetting_facebook_app_id_validation"]);$(".ui.form").form({facebook_app_id:{identifier:"facebook_app_id",rules:[{type:"empty",prompt:translation.tab_portalsetting_facebook_app_id_validation}]}},{inline:!0,onSuccess:function(){$scope.valcheck=$scope.valcheck&&!0},onFailure:function(){$scope.valcheck=$scope.valcheck&&!1}}).form("validate form")},$scope.saveDisqusShortname=function(value){$scope.valcheck=!0,$scope.comment&&"facebook"==$scope.comment&&$scope.validateFacebookComment(),$scope.valcheck&&(msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg,publicSettings={custom_comment_show_comment_picture:$scope.public_settings.custom_comment_show_comment_picture,comment_system:$scope.comment,custom_comment_comment_background_color:$scope.public_settings.custom_comment_comment_background_color,custom_comment_auto_refresh:$scope.public_settings.custom_comment_auto_refresh,custom_comment_anonymous_commenting:$scope.public_settings.custom_comment_anonymous_commenting,custom_comment_anonymous_force:$scope.public_settings.custom_comment_anonymous_commenting_force,custom_comment_font_family:$scope.public_settings.custom_comment_font_family,custom_comment_font_color:$scope.public_settings.custom_comment_font_color,site_facebook_app_id:$scope.public_settings.site_facebook_app_id},Restangular.one("portal/setting/public").customPUT(publicSettings).then((function(success){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}),(function(failure){msg={header:failure.data.message},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()})),"disqus"==$scope.comment&&(window.disqus_shortname=value,DisqusShortnameService.setDisqusShortname(value).then((function(success){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}),(function(failure){msg={header:failure.data.message},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))))},$scope.widget_dropdown=[{name:"WordPress",idx:2},{name:"Twitter",idx:3}],$scope.displayWidgetSection=function(obj){$scope.widget_display=obj.idx},$scope.saveComponentSettings=function(){msg={loading:!0,loading_message:"saving_settings"},$rootScope.floatingMessage=msg;var requestQueue=[],publicSettings={site_widget_contact_form_receiver:$scope.public_settings.site_widget_contact_form_receiver,site_widget_twitter_widget:$scope.public_settings.site_widget_twitter_widget};if($scope.public_settings.hasOwnProperty("site_widget_twitter_widget")&&$scope.public_settings.site_widget_twitter_widget.hasOwnProperty("code")&&($scope.isCodeValid=!isDocumentWrite($scope.public_settings.site_widget_twitter_widget.code)),$scope.public_settings.hasOwnProperty("site_widget_wp_api")&&$scope.public_settings.site_widget_wp_api.hasOwnProperty("url")&&($scope.isCodeValid=$scope.public_settings.site_widget_wp_api.url.length>0),publicSettings.site_widget_contact_form_receiver&&0!=publicSettings.site_widget_contact_form_receiver.length||(publicSettings.site_widget_contact_form_receiver=$scope.private_settings.site_email_address_admin),$scope.public_settings.hasOwnProperty("site_widget_wp_api")&&$scope.public_settings.site_widget_wp_api.url){var req={method:"GET",url:$scope.public_settings.site_widget_wp_api.url+"posts",transformRequest:function(data,headersGetter){var headers=headersGetter();return delete headers["X-Auth-Token"],headers},withCredentials:!1,functionLocation:"wp_service"};$http(req).then((function(data,status,headers,config){$scope.wp_error=!1,publicSettings.site_widget_wp_api=$scope.public_settings.site_widget_wp_api,requestQueue.push(Restangular.one("portal/setting/public").customPUT(publicSettings))}),(function(failure){200!=failure.status&&($scope.wp_error=!0,requestQueue.push(Restangular.one("portal/setting/public").customPUT(publicSettings)))}))}else requestQueue.push(Restangular.one("portal/setting/public").customPUT(publicSettings));$q.all(requestQueue).then((function(){msg={header:"success_message_save_changes_button"},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}),(function(failed){msg={header:failed.data.message},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))},$scope.stripeConnect=function(){if($scope.stripe_setting.client_id&&$scope.stripe_setting.publishable_key&&$scope.stripe_setting.secret_key){$scope.public_settings.site_campaign_fee_direct_transaction&&($scope.stripe_fee.campaign_fee=100);var data={site_campaign_fee_percentage:$scope.stripe_fee.campaign_fee,site_campaign_fee_direct_transaction:$scope.public_settings.site_campaign_fee_direct_transaction};Restangular.one("portal/setting/public").customPUT(data);var client_id=$scope.stripe_setting.client_id,redirect=StripeService.redirectURL(),state=StripeService.generateStateParam("/admin/dashboard#portal-settings");$window.location.href="https://connect.stripe.com/oauth/authorize?response_type=code&client_id="+client_id+"&scope=read_write&redirect_uri="+redirect+"&state="+state}else setTimeout((function(){$translate(["stripe_not_setup"]).then((function(value){$scope.notsetup=value.stripe_not_setup,msg={header:$scope.notsetup},$rootScope.floatingMessage=msg,$scope.hideFloatingMessage()}))}),50)},$scope.showBannerEditor=function(place){$scope.bannerEditor="main"==place?"main":"bot"},$scope.$watch("public_settings.site_campaign_custom_button.toggle",(function(newValue,oldValue){newValue||$timeout((function(){$(".ui.form#custom-formatting-form").form("reset")}))})),$scope.$watch("public_settings.site_theme_campaign_show_reward_enable_variation",(function(newValue,oldValue){$scope.rewardAttributesEnabled=!!newValue})),$scope.$watch("public_settings.site_theme_alt_shipping_layout",(function(newValue,oldValue){var $defCountry=$(".defaultCountry");newValue&&$defCountry.removeClass("disabled"),newValue!==oldValue&&(newValue?$defCountry.removeClass("disabled"):($scope.public_settings.site_theme_default_shipping_country={},$defCountry.dropdown("clear"),$defCountry.addClass("disabled")))})),$scope.$watch("currency_setting.currency_ids",(function(newValue,oldValue){newValue&&$("#campaign-currency-field .select2-choices li").hasClass("select2-search-choice")&&($(".select-error").remove(),$("#campaign-currency-field").removeClass("error"))})),$scope.setCountry=function(country){for(var i in countries_orig)countries_orig[i].id==country.id&&($scope.public_settings.site_theme_default_shipping_country=countries_orig[i])},$scope.setAuthScheme=function(auth){$scope.public_settings.site_auth_scheme=auth},$scope.setInlineContrib=function(inline){$scope.public_settings.site_contribute_behaviour.default=inline},$scope.loadPreviewVideo=function(){if(0==$scope.public_settings.site_theme_banner_is_image&&void 0!==$scope.public_settings.site_theme_banner_video_link){VideoLinkService.setSettings({mute:!1,autoplay:!1});var initialVideoLink=$scope.public_settings.site_theme_banner_video_link;VideoLinkService.processVideoLink(initialVideoLink),$scope.site_theme_banner_video_link_type=VideoLinkService.get_video_type(),$scope.site_theme_banner_video_link_preview=VideoLinkService.get_video_link()}},$scope.deletePreviewVideo=function(){$scope.public_settings.site_theme_banner_video_link="",$scope.site_theme_banner_video_link_preview="",$scope.site_theme_banner_video_link_type="none"},$scope.setAccord=function(){$("#homeAccordion").accordion("open",0)},$scope.load_icons=[{index:0,name:"add user"},{index:1,name:"add to cart"},{index:2,name:"adjust"},{index:3,name:"alarm"},{index:4,name:"alarm outline"},{index:5,name:"alarm slash"},{index:6,name:"alarm slash outline"},{index:7,name:"anchor"},{index:8,name:"archive"},{index:9,name:"asterisk"},{index:10,name:"at"},{index:11,name:"ban"},{index:12,name:"bar"},{index:13,name:"bomb"},{index:14,name:"book"},{index:15,name:"bookmark"},{index:16,name:"browser"},{index:17,name:"bug"},{index:18,name:"bullseye"},{index:19,name:"calculator"},{index:20,name:"calendar"},{index:21,name:"calendar outline"},{index:22,name:"call"},{index:23,name:"call square"},{index:24,name:"certificate"},{index:25,name:"checkered flag"},{index:26,name:"circle"},{index:27,name:"circle notched"},{index:28,name:"circle thin"},{index:29,name:"cloud"},{index:30,name:"cloud download"},{index:31,name:"cloud upload"},{index:32,name:"cocktail"},{index:33,name:"code"},{index:34,name:"comment"},{index:35,name:"comment outline"},{index:36,name:"comments"},{index:37,name:"comments outline"},{index:38,name:"compress"},{index:39,name:"configure"},{index:40,name:"copyright"},{index:41,name:"crosshairs"},{index:42,name:"cube"},{index:43,name:"cubes"},{index:44,name:"dashboard"},{index:45,name:"diamond"},{index:46,name:"download"},{index:47,name:"edit"},{index:48,name:"ellipsis horizontal"},{index:49,name:"ellipsis vertical"},{index:50,name:"empty heart"},{index:51,name:"empty star"},{index:52,name:"erase"},{index:53,name:"exchange"},{index:54,name:"expand"},{index:55,name:"external"},{index:56,name:"external share"},{index:57,name:"external square"},{index:58,name:"eyedropper"},{index:59,name:"fax"},{index:60,name:"feed"},{index:61,name:"filter"},{index:62,name:"find"},{index:63,name:"fire"},{index:64,name:"fire extinguisher"},{index:65,name:"flag"},{index:66,name:"flag outline"},{index:67,name:"forward mail"},{index:68,name:"frown"},{index:69,name:"gift"},{index:70,name:"heart"},{index:71,name:"heartbeat"},{index:72,name:"hide"},{index:73,name:"history"},{index:74,name:"home"},{index:75,name:"idea"},{index:76,name:"in cart"},{index:77,name:"inbox"},{index:78,name:"lab"},{index:79,name:"leaf"},{index:80,name:"legal"},{index:81,name:"lemon"},{index:82,name:"life ring"},{index:83,name:"lightning"},{index:84,name:"lock"},{index:85,name:"magnet"},{index:86,name:"mail"},{index:87,name:"mail outline"},{index:88,name:"mail square"},{index:89,name:"map"},{index:90,name:"meh"},{index:91,name:"money"},{index:92,name:"moon"},{index:93,name:"options"},{index:94,name:"paint brush"},{index:95,name:"payment"},{index:96,name:"pin"},{index:97,name:"plane"},{index:98,name:"print"},{index:99,name:"privacy"},{index:100,name:"protect"},{index:101,name:"puzzle"},{index:102,name:"quote left"},{index:103,name:"quote right"},{index:104,name:"rain"},{index:105,name:"random"},{index:106,name:"recycle"},{index:107,name:"refresh"},{index:108,name:"remove bookmark"},{index:109,name:"remove user"},{index:110,name:"repeat"},{index:111,name:"reply"},{index:112,name:"reply all"},{index:113,name:"retweet"},{index:114,name:"road"},{index:115,name:"rocket"},{index:116,name:"search"},{index:117,name:"send"},{index:118,name:"send outline"},{index:119,name:"setting"},{index:120,name:"settings"},{index:121,name:"share"},{index:122,name:"share alternate"},{index:123,name:"share alternate square"},{index:124,name:"share square"},{index:125,name:"shipping"},{index:126,name:"shop"},{index:127,name:"sign in"},{index:128,name:"sign out"},{index:129,name:"signal"},{index:130,name:"sitemap"},{index:131,name:"smile"},{index:132,name:"soccer"},{index:133,name:"spinner"},{index:134,name:"star"},{index:135,name:"star half"},{index:136,name:"star half empty"},{index:137,name:"suitcase"},{index:138,name:"sun"},{index:139,name:"tag"},{index:140,name:"tags"},{index:141,name:"tasks"},{index:142,name:"terminal"},{index:143,name:"text telephone"},{index:144,name:"theme"},{index:145,name:"thumbs down"},{index:146,name:"thumbs outline down"},{index:147,name:"thumbs outline up"},{index:148,name:"thumbs up"},{index:149,name:"ticket"},{index:150,name:"translate"},{index:151,name:"travel"},{index:152,name:"treatment"},{index:153,name:"trophy"},{index:154,name:"undo"},{index:155,name:"unhide"},{index:156,name:"unlock"},{index:157,name:"unlock alternate"},{index:158,name:"upload"},{index:159,name:"wait"},{index:160,name:"wifi"},{index:161,name:"wizard"},{index:162,name:"world"},{index:163,name:"write"},{index:164,name:"write square"}],$scope.uploadPartnerLogo=function(files,index){if(files.length){var $picNode=$(".partner-logo");FileUploadService.upload("portal/resource/file",files,{resource_content_type:"image"},$picNode).then((function(success){$scope.public_settings.logo_links[index].image_link=success[0].data.path_external}))}},$scope.addPartnerLogo=function(arr){if(arr.length<6){arr&&arr.push(angular.copy({name:"",url:""}))}},$scope.removePartnerLogo=function(link,index){$scope.public_settings.logo_links.splice(index,1)},$scope.addTier=function(){$scope.public_settings.site_tipping.tiers&&0!=$scope.public_settings.site_tipping.tiers.length||($scope.public_settings.site_tipping.tiers=[],$scope.public_settings.site_tipping.tiers.length=0);$scope.public_settings.site_tipping.tiers.push(angular.copy({name:"",value:"",type:"Dollar"}))},$scope.updateTierType=function(index,type){$scope.public_settings.site_tipping.tiers[index].type=type},$scope.removeTier=function(index){$scope.public_settings.site_tipping.tiers.splice(index,1)},$scope.setTipDefault=function(type){$scope.public_settings.site_tipping.selectedTipDefault=type},$scope.$watchGroup(["testmode","stripe_test_secretkey","stripe_test_publishkey","livemode","stripe_live_secretkey","stripe_live_publishkey"],(function(newValue,oldValue){if(newValue!=oldValue){for(var isTestMode=!0,isLiveMode=!0,i=0;i<=2;i++)isTestMode=isTestMode&&!!newValue[i];for(i=4;i<=5;i++)isLiveMode=isLiveMode&&!!newValue[i];resetStripeKeyErrors()}})),$scope.directTransactionValidation=function(){var translation=$translate.instant(["tab_portalsetting_payment_Setting_public_key_incorrect","tab_portalsetting_payment_Setting_secret_key_incorrect","tab_portalsetting_payment_Setting_client_key_incorrect","tab_portalsetting_payment_Setting_stripe_country_incorrect","tab_portalsetting_payment_Setting_transaction_key_incorrect","tab_portalsetting_payment_Setting_transaction_key_empty","tab_portalsetting_currency_prompt_empty","tab_portalsetting_bank_form_country_empty"]);$.fn.form.settings.rules.transactionFeeRange=function(param){return param>=0&&param<=100},$scope.public_settings.site_campaign_fee_direct_transaction?$scope.livemode?($(".ui.form").form({live_secret_key:{identifier:"live_secret_key",rules:[{type:"empty",prompt:translation.tab_portalsetting_payment_Setting_secret_key_incorrect}]},live_publish_key:{identifier:"live_publish_key",rules:[{type:"empty",prompt:translation.tab_portalsetting_payment_Setting_public_key_incorrect}]}},{inline:!0,onSuccess:function(){$scope.valcheck=$scope.valcheck&&!0},onFailure:function(){$scope.valcheck=$scope.valcheck&&!1}}).form("validate form"),$scope.public_settings.site_campaign_country_funding_step&&($("#bankform-country-field .select2-choices li").hasClass("select2-search-choice")?($(".bankform-select-error").remove(),$("#bankform-country-field").removeClass("error"),$scope.valcheck=$scope.valcheck&&!0):($(".bankform-select-error").remove(),$("#bankform-country-field").append('<div class="bankform-select-error ui red pointing prompt label transition visible">'+translation.tab_portalsetting_bank_form_country_empty+"</div>"),$("#bankform-country-field").addClass("error"),$scope.valcheck=$scope.valcheck&&!1))):($(".ui.form").form({test_secret_key:{identifier:"test_secret_key",rules:[{type:"empty",prompt:translation.tab_portalsetting_payment_Setting_secret_key_incorrect}]},test_publish_key:{identifier:"test_publish_key",rules:[{type:"empty",prompt:translation.tab_portalsetting_payment_Setting_public_key_incorrect}]}},{inline:!0,onSuccess:function(){$scope.valcheck=$scope.valcheck&&!0},onFailure:function(){$scope.valcheck=$scope.valcheck&&!1}}).form("validate form"),$scope.public_settings.site_campaign_country_funding_step&&($("#bankform-country-field .select2-choices li").hasClass("select2-search-choice")?($(".bankform-select-error").remove(),$("#bankform-country-field").removeClass("error"),$scope.valcheck=$scope.valcheck&&!0):($(".bankform-select-error").remove(),$("#bankform-country-field").append('<div class="bankform-select-error ui red pointing prompt label transition visible">'+translation.tab_portalsetting_bank_form_country_empty+"</div>"),$("#bankform-country-field").addClass("error"),$scope.valcheck=$scope.valcheck&&!1))):$scope.livemode?($(".ui.form").form({live_secret_key:{identifier:"live_secret_key",rules:[{type:"empty",prompt:translation.tab_portalsetting_payment_Setting_secret_key_incorrect}]},live_publish_key:{identifier:"live_publish_key",rules:[{type:"empty",prompt:translation.tab_portalsetting_payment_Setting_public_key_incorrect}]},live_client_id:{identifier:"live_client_id",rules:[{type:"empty",prompt:translation.tab_portalsetting_payment_Setting_client_key_incorrect}]},campaign_fee:{identifier:"campaign_fee",rules:[{type:"empty",prompt:translation.tab_portalsetting_payment_Setting_transaction_key_empty},{type:"integer",prompt:translation.tab_portalsetting_payment_Setting_transaction_key_empty},{type:"transactionFeeRange[param]",prompt:translation.tab_portalsetting_payment_Setting_transaction_key_incorrect}]}},{inline:!0,onSuccess:function(){$scope.valcheck=$scope.valcheck&&!0},onFailure:function(){$scope.valcheck=$scope.valcheck&&!1}}).form("validate form"),$scope.public_settings.site_campaign_country_funding_step&&($("#bankform-country-field .select2-choices li").hasClass("select2-search-choice")?($(".bankform-select-error").remove(),$("#bankform-country-field").removeClass("error"),$scope.valcheck=$scope.valcheck&&!0):($(".bankform-select-error").remove(),$("#bankform-country-field").append('<div class="bankform-select-error ui red pointing prompt label transition visible">'+translation.tab_portalsetting_bank_form_country_empty+"</div>"),$("#bankform-country-field").addClass("error"),$scope.valcheck=$scope.valcheck&&!1))):($(".ui.form").form({test_secret_key:{identifier:"test_secret_key",rules:[{type:"empty",prompt:translation.tab_portalsetting_payment_Setting_secret_key_incorrect}]},test_publish_key:{identifier:"test_publish_key",rules:[{type:"empty",prompt:translation.tab_portalsetting_payment_Setting_public_key_incorrect}]},test_client_id:{identifier:"test_client_id",rules:[{type:"empty",prompt:translation.tab_portalsetting_payment_Setting_client_key_incorrect}]},campaign_fee:{identifier:"campaign_fee",rules:[{type:"empty",prompt:translation.tab_portalsetting_payment_Setting_transaction_key_empty},{type:"integer",prompt:translation.tab_portalsetting_payment_Setting_transaction_key_empty},{type:"transactionFeeRange[param]",prompt:translation.tab_portalsetting_payment_Setting_transaction_key_incorrect}]}},{inline:!0,onSuccess:function(){$scope.valcheck=$scope.valcheck&&!0},onFailure:function(){$scope.valcheck=$scope.valcheck&&!1}}).form("validate form"),$scope.public_settings.site_campaign_country_funding_step&&($("#bankform-country-field .select2-choices li").hasClass("select2-search-choice")?($(".bankform-select-error").remove(),$("#bankform-country-field").removeClass("error"),$scope.valcheck=$scope.valcheck&&!0):($(".bankform-select-error").remove(),$("#bankform-country-field").append('<div class="bankform-select-error ui red pointing prompt label transition visible">'+translation.tab_portalsetting_bank_form_country_empty+"</div>"),$("#bankform-country-field").addClass("error"),$scope.valcheck=$scope.valcheck&&!1)))},$scope.countryCurrencyValidate=function(){var translation=$translate.instant(["tab_portalsetting_payment_Setting_stripe_country_incorrect","tab_portalsetting_currency_prompt_empty"]);$(".ui.form").form({stripe_country:{identifier:"stripe_country",rules:[{type:"empty",prompt:translation.tab_portalsetting_payment_Setting_stripe_country_incorrect}]}},{inline:!0,onSuccess:function(){$scope.valcheck=$scope.valcheck&&!0},onFailure:function(){$scope.valcheck=$scope.valcheck&&!1}}).form("validate form"),$("#campaign-currency-field .select2-choices li").hasClass("select2-search-choice")?($(".select-error").remove(),$("#campaign-currency-field").removeClass("error"),$scope.valcheck=$scope.valcheck&&!0):($(".select-error").remove(),$("#campaign-currency-field").append('<div class="select-error ui red pointing prompt label transition visible">'+translation.tab_portalsetting_currency_prompt_empty+"</div>"),$("#campaign-currency-field").addClass("error"),$scope.valcheck=$scope.valcheck&&!1)},$scope.$watch("currency_setting.currency_ids",(function(newValue,oldValue){newValue&&$("#campaign-currency-field .select2-choices li").hasClass("select2-search-choice")&&void 0!==newValue&&newValue.length&&$timeout((function(){$(".select-error").remove(),$("#campaign-currency-field").removeClass("error"),$scope.valcheck=$scope.valcheck&&!0}))})),$scope.clickCC=function(a,b){a&&b&&($(".site-campaign-contribution").removeClass("disabled"),angular.element(document.querySelector(".site-campaign-contribution")).click()),a||b||($(".site-campaign-contribution").removeClass("disabled"),angular.element(document.querySelector(".site-campaign-contribution")).click()),!a&&b&&($(".site-campaign-contribution").removeClass("disabled"),angular.element(document.querySelector(".site-campaign-contribution")).click())}}]);