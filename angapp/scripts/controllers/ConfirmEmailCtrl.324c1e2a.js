app.controller("confirmEmailCtrl",["$scope","$rootScope","UserService","Restangular","$routeParams","$location","$timeout","$translatePartialLoader","$translate",function($scope,$rootScope,UserService,Restangular,$routeParams,$location,$timeout,$translatePartialLoader,$translate){var $msg,token=$routeParams.token;$form={token:token},$scope.success=!1,$scope.formData={},$scope.valueCheck=!0,$scope.$emit("loading_finished"),Restangular.one("account/email/confirm",token).get().then((function(success){$scope.success=!0}),(function(failure){$msg={header:"confirm_email_email_invalid_expired_error"},$rootScope.floatingMessage=$msg,$scope.hideFloatingMessage()})),$scope.confirmResetEmail=function(){var translation;translation=$translate.instant(["confirm_email_new_email_message","confirm_email_new_email_error"]),$("form[name='email_form']").form({new_email:{identifier:"new_email",rules:[{type:"empty",prompt:translation.confirm_email_new_email_message},{type:"email",prompt:translation.confirm_email_new_email_message}]},confirm_email:{identifier:"confirm_email",rules:[{type:"empty",prompt:translation.confirm_email_new_email_error},{type:"match[new_email]",prompt:translation.confirm_email_new_email_error}]}},{inline:!0,on:"blur",onSuccess:function(){$scope.valueCheck=!0},onFailure:function(){$scope.valueCheck=!1}}).form("validate form"),$scope.valueCheck&&(UserService.isLoggedIn()?$scope.formData.new_email==$scope.formData.confirm_email&&($form={token:token,email:$scope.formData.new_email},Restangular.one("account/email/confirm").customPOST($form).then((function(success){$msg={header:"confirm_email_email_sent"},$rootScope.floatingMessage=$msg,$scope.hideFloatingMessage()}),(function(failure){$msg={header:failure.data.message},$rootScope.floatingMessage=$msg,$scope.hideFloatingMessage()}))):($msg={header:"confirm_email_email_please_login"},$rootScope.floatingMessage=$msg,$scope.hideFloatingMessage()))}}]);