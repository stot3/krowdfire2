app.controller("CustomPageCtrl",["$route","$scope","Restangular","$routeParams","$location","$timeout","$anchorScroll","$rootScope","anchorSmoothScroll","UserService","RequestCacheService","$translate",function($route,$scope,Restangular,$routeParams,$location,$timeout,$anchorScroll,$rootScope,anchorSmoothScroll,UserService,RequestCacheService,$translate){var $msg,paras=$location.$$path.split("/");$scope.path=paras[1],paras.shift(),$scope.page_content="",$scope.page_id="",$scope.pages=[],$scope.successMessage=[],$scope.errorMessage=[],$scope.content_loading=!0,$scope.page,$scope.is404=0,$scope.pageContent=!0,$scope.campaignContent=!1,$scope.urlPath=$location.path(),$scope.urlPath=$scope.urlPath.replace(/\/$/,"").slice(1),Restangular.one("portal/setting").getList().then((function(success){$scope.public_settings={},$scope.private_settings={},angular.forEach(success,(function(value){3==value.setting_type_id&&($scope.public_settings[value.name]=value.value)})),$scope.public_settings.site_case_insensitive_campaign_path?Restangular.one("campaign").customGET(null,{use_path_lookup:1,path_lookup_case_insensitive:!0,path:$scope.urlPath}).then((function(success){$rootScope.campaignId=success.entry_id,$scope.pageContent=!1,$scope.campaignContent=!0}),(function(failed){$scope.$on("$routeUpdate",(function(){$route.reload()})),RequestCacheService.getPage().then((function(success){$scope.$emit("loading_finished"),$scope.pages=success,$scope.pageContent=!0,$scope.content_loading=!1;for(var i=0;i<$scope.pages.length;i++){var stripped_path="/"+$location.$$path.replace(/\/$/,"").slice(1),regex=$scope.pages[i].path.replace(/\*/g,"[a-z0-9/-]*");if(stripped_path.match("^/"+regex+"$")){$scope.page_id=$scope.path,$scope.page=$scope.pages[i],$scope.page_content=$scope.page.content;break}}var pages=success;for(i=0;i<pages.length;i++)if(pages[i].path){stripped_path="/"+$location.$$path.replace(/\/$/,"").slice(1),regex=pages[i].path.replace(/\*/g,"[a-z0-9/-]*");if(stripped_path.match("^/"+regex+"$")){$scope.is404=0;break}$scope.is404=1}$timeout((function(){$(".ui.sticky").sticky({context:"#faq-wrap"}),$(".ui.accordion").accordion(),$(".ui.dropdown").dropdown({on:"hover"}),$(".demo.menu .item").tab({history:!1}),$(".tabular.menu .item").tab(),$("a").click((function(e){if($(this).attr("href")&&"#"==$(this).attr("href")[0]){e.preventDefault();var url=$(this).attr("href").slice(1);$location.hash(url),anchorSmoothScroll.scrollTo(url)}}))}),200)}))})):Restangular.one("campaign").customGET(null,{use_path_lookup:1,path:$scope.urlPath}).then((function(success){$rootScope.campaignId=success.entry_id,$scope.pageContent=!1,$scope.campaignContent=!0}),(function(failed){$scope.$on("$routeUpdate",(function(){$route.reload()})),RequestCacheService.getPage().then((function(success){$scope.$emit("loading_finished"),$scope.pages=success,$scope.pageContent=!0,$scope.content_loading=!1;for(var i=0;i<$scope.pages.length;i++)if($scope.pages[i].path){var stripped_path="/"+$location.$$path.replace(/\/$/,"").slice(1),regex=$scope.pages[i].path.replace(/\*/g,"[a-z0-9/-]*");if(stripped_path.match("^/"+regex+"$")){$scope.page_id=$scope.path,$scope.page=$scope.pages[i],$scope.page_content=$scope.page.content;break}if(-1!==$location.$$path.indexOf("blog/post")&&-1!==$scope.pages[i].path.indexOf("blog/post")){$scope.page_id=$scope.path,$scope.page=$scope.pages[i],$scope.page_content=$scope.page.content;break}}var pages=success;for(i=0;i<pages.length;i++)if(pages[i].path){stripped_path="/"+$location.$$path.replace(/\/$/,"").slice(1),regex=pages[i].path.replace(/\*/g,"[a-z0-9/-]*");if(stripped_path.match("^/"+regex+"$")){$scope.is404=0;break}-1!==$location.$$path.indexOf("blog/post")?$scope.is404=0:$scope.is404=1}$timeout((function(){$(".ui.sticky").sticky({context:"#faq-wrap"}),$(".ui.accordion").accordion(),$(".ui.dropdown").dropdown({on:"hover"}),$(".demo.menu .item").tab({history:!1}),$(".tabular.menu .item").tab(),$("a").click((function(e){if($(this).attr("href")&&"#"==$(this).attr("href")[0]){e.preventDefault();var url=$(this).attr("href").slice(1);$location.hash(url),anchorSmoothScroll.scrollTo(url)}}))}),200)}))}))})),$timeout((function(){$("#contact")&&$("#contact .field-message textarea").attr("name","description"),$translate(["contact_email_validate_error","contact_name_validate_error","contact_description_validate_error"]).then((function(translation){$(".contact-form").form({email:{identifier:"email",rules:[{type:"email",prompt:translation.contact_email_validate_error}]},name:{identifier:"name",rules:[{type:"empty",prompt:translation.contact_name_validate_error}]},description:{identifier:"description",rules:[{type:"empty",prompt:translation.contact_description_validate_error}]}},{inline:!0}),$(".contact-form .button").click((function(){$scope.successMessage=[],$scope.errorMessage=[],$form={},$form.name=$(".field-name input").val(),$form.email=$(".field-email input").val(),$form.business_organization=$(".field-business input").val(),$form.phone=$(".field-phone input").val(),$form.description=$(".field-message textarea").val(),Restangular.one("portal/contact").customPOST($form).then((function(success){$msg={header:"Message has been sent successfully"},$scope.successMessage.push($msg),$(".ui.dimmer.contact-success-dimmer").dimmer("show"),$timeout((function(){$(".field-name input").val(""),$(".field-email input").val(""),$(".field-business input").val(""),$(".contact-form .field:nth-child(4) input").val(""),$(".field-phone input").val(""),$(".field-message textarea").val(""),$(".ui.dimmer.contact-success-dimmer").dimmer("hide")}),2e3)}),(function(failure){$msg={header:"Error"},$lst=[],$.each(failure.data.errors,(function(key,value){$lst.push(value[0].message)})),$msg.item=$lst,$scope.errorMessage.push($msg)}))}))}))}),2e3)}]);