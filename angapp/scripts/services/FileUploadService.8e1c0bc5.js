app.service("FileUploadService",["$q","$upload","$timeout","API_URL",function($q,$upload,$timeout,API_URL){var prog,fileUpload={};function loadProgress(loaded,total){prog=parseInt(100*loaded/total),$(".ui.progress.upload-bar").progress({percent:prog,total:100}),100==prog&&($(".ui.progress.upload-bar").fadeOut("slow"),$(".ui.loader.download-loader").fadeIn("slow"),prog=0)}return $(".imagePlace .dimmer").dimmer({closable:!1}),fileUpload.upload=function(endpoint,files,params,node){var upload_endpoint=API_URL.url+API_URL.loc+endpoint,promises=[];node.find(".imagePlace .dimmer").dimmer({closable:!1}).dimmer("show"),$(".ui.progress.download-loader").hide(),$(".ui.progress.upload-bar").fadeIn();for(var i=0;i<files.length;i++){params.resource=files[i];var result=$upload.upload({url:upload_endpoint,method:"POST",headers:{},useXDomain:!0,data:params});result.then((function(success){}),(function(failure){}),(function(evt){loadProgress(evt.loaded,evt.total)})),promises.push(result)}return $q.all(promises)},fileUpload.modify=function(endpoint,files,params,id,node){var upload_endpoint=API_URL.url+API_URL.loc+endpoint+id,promises=[];node.find(".imagePlace .dimmer").dimmer({closable:!1}).dimmer("show"),$(".ui.progress.download-loader").hide(),$(".ui.progress.upload-bar").show();for(var i=0;i<files.length;i++){params.resource=files[i];var result=$upload.upload({url:upload_endpoint,method:"PUT",headers:{},useXDomain:!0,data:params});result.then((function(success){}),(function(failure){}),(function(evt){loadProgress(evt.loaded,evt.total)})),promises.push(result)}return $q.all(promises)},fileUpload.uploadFile=function(endpoint,files){if(files.length){var uploadEndpoint=API_URL.url+API_URL.loc+endpoint,params={resource_type:"file",resource_content_type:"generic",resource:files[0]};return $upload.upload({url:uploadEndpoint,method:"POST",headers:{},useXDomain:!0,data:params})}return null},fileUpload}]);