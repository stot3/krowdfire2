app.service("UserService",["$location","$http","$browser","APIRegister","ipCookie","Restangular","$timeout","redirectService","$translate",function($location,$http,$browser,APIRegister,ipCookie,Restangular,$timeout,redirectService,$translate){var User={email:"",first_name:"",last_name:"",auth_token:"",subscribed:!1};function copyObjectProperties(srcObj,destObj){for(var key in srcObj)destObj[key]=srcObj[key]}return User.updateUserData=function(data){if(!data)return!1;copyObjectProperties(data,User),ipCookie("current.user",User,{expires:1440,expirationUnit:"minutes",path:"/"})},User.getPaidStatus=function(email){return $http.post("https://us-central1-sistrunk-software.cloudfunctions.net/getProfile",{email:email},{headers:{"Content-Type":"application/json"}}).catch((function(err){console.error(err)}))},User.setInvitationInformation=function(email,campaign_id,campaign_name){return $http.post("https://us-central1-sistrunk-software.cloudfunctions.net/saveInvitation",{email:email,campaign_id:campaign_id,campaign_name:campaign_name},{headers:{"Content-Type":"application/json"}}).catch((function(err){console.error(err)}))},User.getPaidGuard=function(){return $http.post("https://us-central1-sistrunk-software.cloudfunctions.net/getProfile",{email:User.email},{headers:{"Content-Type":"application/json"}}).then((function(hasPaid){return!0===hasPaid.data.info.paid})).catch((function(err){console.error(err)}))},User.setPaidStatus=function(email){return $http.post("https://us-central1-sistrunk-software.cloudfunctions.net/userPaid",{email:email},{headers:{"Content-Type":"application/json"}}).catch((function(err){console.error(err)}))},User.getMatchingCampaign=function(campaign_name,campaign_id){return $http.post("https://us-central1-sistrunk-software.cloudfunctions.net/getProfile",{email:User.email},{headers:{"Content-Type":"application/json"}}).then((function(hasPaid){return hasPaid.data.info.inviterInformation.campaign_name==campaign_name&&hasPaid.data.info.inviterInformation.campaign_id==campaign_id})).catch((function(err){return err}))},User.isLoggedIn=function(){return!!ipCookie("current.user")&&(copyObjectProperties(ipCookie("current.user"),User),User.auth_token)},User.setLoggedIn=function(data,redirect){if(data.attributes&&delete data.attributes,redirect||(redirect=!1),!(data=data||ipCookie("current.user")))return!1;copyObjectProperties(data,User),ipCookie("current.user",data,{expires:1440,expirationUnit:"minutes",path:"/"});var url=redirectService.getUrl();return 0==redirect&&(url&&"/login"!=url&&"register"!=url.split("/")[1]&&"authenticate"!=url.split("/")[1]?User.getPaidStatus(data.email).then((function(status){if(!0===status.data.info.paid)$location.url("/start");else{const campaign_id=status.data.info.inviterInformation.campaign_id,campaign_name=status.data.info.inviterInformation.campaign_name;$location.url(`/campaign/${campaign_id}/${campaign_name}`)}})).catch((function(err){console.error(err),$location.path("/login")})):$location.path("/")),!0},User.setLoggedOut=function(okta_settings=null){ipCookie("current.user")&&ipCookie("current.user").auth_token?(ipCookie.remove("current.user",{path:"/"}),Restangular.one("logout").customPOST().then((function(success){User.email="",User.first_name="",User.last_name="",User.auth_token="",$location.path("/login")}),(function(failure){}))):(User.email="",User.first_name="",User.last_name="",User.auth_token="")},User.showInvitationModal=function(){$("#payModal.ui.modal").modal({closeable:!0,allowMultiple:!1,blurring:!0,detachable:!1,dimmerSettings:{closeable:!0}}).modal("show")},User.hideInvitationModal=function(){return $("#payModal.ui.modal").modal("hide")},User}]);