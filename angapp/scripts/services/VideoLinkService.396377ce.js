app.service("VideoLinkService",["$sce","RESOURCE_REGIONS",function($sce,RESOURCE_REGIONS){var video_type="",video_link="",settings={mute:!0,autoplay:!1};this.get_video_type=function(){return video_type},this.get_video_link=function(){return video_link},this.set_video_type=function(type){video_type=type},this.set_video_link=function(link,trust){video_link=trust?$sce.trustAsResourceUrl(link):link},this.setSettings=function(setting_data){settings=setting_data},this.check_video_type=function(link){video_type="custom",!link||link.length<=0?video_type="none":link.indexOf("youtube")>=0||link.indexOf("youtu.be")>=0?video_type="youtube":link.indexOf("vimeo")>=0&&(video_type="vimeo")},this.processVideoLink=function(link,campaign_id){if(""!=video_type&&""==link||this.check_video_type(link),"youtube"==video_type){var video_id,url=new URL(link);if("youtu.be"==url.hostname){if(!url.pathname)return;video_id=url.pathname.slice(1,url.pathname.length)}else{if(!url.searchParams)return;video_id=url.searchParams.get("v")}this.set_video_link(video_id,!1)}else if("vimeo"==video_type){var lastIndex=link.lastIndexOf("/");lastIndex>=0&&(lastIndex=(video_id=link.substring(lastIndex+1)).lastIndexOf("?"))>=0&&(video_id=video_id.substring(0,lastIndex));var vimeo_link="https://player.vimeo.com/video/"+video_id+"?&badge=0&loop=1&title=false&byline=false";(settings.mute&&1==settings.mute||settings.thumbnail&&1==settings.thumbnail)&&(vimeo_link+="&muted=1"),1==settings.autoplay&&(vimeo_link+="&autoplay=1"),this.set_video_link(vimeo_link,!0)}else this.set_video_link(link,!0)},this.proccessCampaigns=function(campaigns){if(campaigns.length<=0)return campaigns;for(var i=0;i<campaigns.length;i++)if(campaigns[i].links){for(var thumbnailVideoLink="",j=0;j<campaigns[i].links.length;j++)campaigns[i].links[j].region_id==RESOURCE_REGIONS.campaign.thumbnail_video&&(thumbnailVideoLink=campaigns[i].links[j].uri);if(""!=thumbnailVideoLink){this.setSettings({mute:!0,autoplay:!0}),this.processVideoLink(thumbnailVideoLink,campaigns[i].id),campaigns[i].thumbnail_video_type=this.get_video_type(),campaigns[i].thumbnail_video_link=this.get_video_link()}}return campaigns},this.onYouTubePlayerAPIReady=function(id,campaign_id){void 0===id&&(id="");var youtubeTarget="ytplayer";""!=campaign_id&&void 0!==campaign_id&&(youtubeTarget+="-"+campaign_id);new YT.Player(youtubeTarget,{playerVars:{autoplay:settings.autoplay?1:0,controls:0,modestbranding:1,showinfo:0,loop:1,playlist:id},videoId:id,events:{onReady:this.onPlayerReady}})},this.onPlayerReady=function(event){(settings.mute&&1==settings.mute||settings.thumbnail&&1==settings.thumbnail)&&event.target.mute()}}]);