app.service("UserService",["$location","$http","$browser","APIRegister","ipCookie","Restangular","$timeout","redirectService","$translate",function($location,$http,$browser,APIRegister,ipCookie,Restangular,$timeout,redirectService,$translate){var User={email:"",first_name:"",last_name:"",auth_token:"",subscribed:!1,uid:""};function copyObjectProperties(srcObj,destObj){for(var key in srcObj)destObj[key]=srcObj[key]}return User.updateUserData=function(data){if(!data)return!1;copyObjectProperties(data,User),ipCookie("current.user",User,{expires:1440,expirationUnit:"minutes",path:"/"})},User.getPaidStatus=function(email){return $http.post("https://us-central1-sistrunk-software.cloudfunctions.net/getProfile",{email:email},{headers:{"Content-Type":"application/json"}}).catch((function(err){console.error(err)}))},User.setInvitationInformation=function(email,campaign_id,campaign_name,inviterUid){return $http.post("https://us-central1-sistrunk-software.cloudfunctions.net/saveInvitation",{email:email,campaign_id:campaign_id,campaign_name:campaign_name,inviterUid:inviterUid},{headers:{"Content-Type":"application/json"}}).catch((function(err){console.error(err)}))},User.getPaidGuard=function(){return $http.post("https://us-central1-sistrunk-software.cloudfunctions.net/getProfile",{email:User.email},{headers:{"Content-Type":"application/json"}}).then((function(hasPaid){return!0===hasPaid.data.info.paid})).catch((function(err){console.error(err)}))},User.setPaidStatus=function(email,inviterUid,campaignId){return $http.post("https://us-central1-sistrunk-software.cloudfunctions.net/userPaid",{email:email,inviterUid:inviterUid,campaign_id:campaignId},{headers:{"Content-Type":"application/json"}}).catch((function(err){console.error(err)}))},User.getMatchingCampaign=function(campaign_name,campaign_id){return $http.post("https://us-central1-sistrunk-software.cloudfunctions.net/getProfile",{email:User.email},{headers:{"Content-Type":"application/json"}}).then((function(hasPaid){return hasPaid.data.info.inviterInformation.campaign_name==campaign_name&&hasPaid.data.info.inviterInformation.campaign_id==campaign_id})).catch((function(err){return err}))},User.isLoggedIn=function(){return!!ipCookie("current.user")&&(copyObjectProperties(ipCookie("current.user"),User),User.auth_token)},User.setLoggedIn=function(data,redirect){if(data.attributes&&delete data.attributes,redirect||(redirect=!1),!(data=data||ipCookie("current.user")))return!1;copyObjectProperties(data,User),ipCookie("current.user",data,{expires:1440,expirationUnit:"minutes",path:"/"});var url=redirectService.getUrl();if(0==redirect){if(url&&"/login"!=url&&"register"!=url.split("/")[1]&&"authenticate"!=url.split("/")[1])return User.getPaidStatus(data.email).then((function(status){const paid=status.data.info.paid;if(!0===paid)return $location.path("/start"),!0;if(void 0===paid)return $location.path("/"),!0;{const campaign_id=status.data.info.inviterInformation.campaign_id,campaign_name=status.data.info.inviterInformation.campaign_name;return $location.url(`/campaign/${campaign_id}/${campaign_name}`),!0}})).catch((function(err){return console.error(err),$location.path("/login"),err}));$location.path("/")}return!0},User.setLoggedOut=function(okta_settings=null){ipCookie("current.user")&&ipCookie("current.user").auth_token?(ipCookie.remove("current.user",{path:"/"}),Restangular.one("logout").customPOST().then((function(success){User.email="",User.first_name="",User.last_name="",User.auth_token="",$location.path("/login")}),(function(failure){}))):(User.email="",User.first_name="",User.last_name="",User.auth_token="")},User.showInvitationModal=function(){$("#payModal.ui.modal").modal({closeable:!0,allowMultiple:!1,blurring:!0,detachable:!1,dimmerSettings:{closeable:!0}}).modal("show")},User.hideInvitationModal=function(){return $("#payModal.ui.modal").modal("hide")},User.getProfile=function(){return $http.post("https://us-central1-sistrunk-software.cloudfunctions.net/getProfile",{email:User.email}).then(profile=>(User.uid=profile.data.info.id,profile))},User.updateInvitees=function(emails,uid){return $http.post("https://us-central1-sistrunk-software.cloudfunctions.net/removeInvitation",{emails:emails,uid:User.uid})},User.saveCampaignSuccess=function(){return $http.post("https://us-central1-sistrunk-software.cloudfunctions.net/setSuccessCampaign",{uid:User.uid})},User}]);