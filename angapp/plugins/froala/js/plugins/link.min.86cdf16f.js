(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof module==="object"&&module.exports){module.exports=function(t,i){if(i===undefined){if(typeof window!=="undefined"){i=require("jquery")}else{i=require("jquery")(t)}}return e(i)}}else{e(window.jQuery)}})(function(e){e.extend(e.FE.POPUP_TEMPLATES,{"link.edit":"[_BUTTONS_]","link.insert":"[_BUTTONS_][_INPUT_LAYER_]"});e.extend(e.FE.DEFAULTS,{linkEditButtons:["linkOpen","linkStyle","linkEdit","linkRemove"],linkInsertButtons:["linkBack","|","linkList"],linkAttributes:{},linkAutoPrefix:"http://",linkStyles:{"fr-green":"Green","fr-strong":"Thick"},linkMultipleStyles:true,linkConvertEmailAddress:true,linkAlwaysBlank:false,linkAlwaysNoFollow:false,linkList:[{text:"Froala",href:"https://froala.com",target:"_blank"},{text:"Google",href:"https://google.com",target:"_blank"},{displayText:"Facebook",href:"https://facebook.com"}],linkText:true});e.FE.PLUGINS.link=function(t){function i(){var i=t.image?t.image.get():null;if(!i&&t.$wp){var n=t.selection.ranges(0).commonAncestorContainer;if(n&&(n.contains&&n.contains(t.el)||!t.el.contains(n)||t.el==n))n=null;if(n&&n.tagName==="A")return n;var r=t.selection.element();var a=t.selection.endElement();if(r.tagName!="A"&&!t.node.isElement(r)){r=e(r).parentsUntil(t.$el,"a:first").get(0)}if(a.tagName!="A"&&!t.node.isElement(a)){a=e(a).parentsUntil(t.$el,"a:first").get(0)}if(a&&(a.contains&&a.contains(t.el)||!t.el.contains(a)||t.el==a))a=null;if(r&&(r.contains&&r.contains(t.el)||!t.el.contains(r)||t.el==r))r=null;if(a&&a==r&&a.tagName=="A"){return r}return null}else if(t.el.tagName=="A"){return t.el}else{if(i&&i.get(0).parentNode&&i.get(0).parentNode.tagName=="A"){return i.get(0).parentNode}}}function n(){var e=t.image?t.image.get():null;var i=[];if(e){if(e.get(0).parentNode.tagName=="A"){i.push(e.get(0).parentNode)}}else{var n;var r;var a;var l;if(t.win.getSelection){var s=t.win.getSelection();if(s.getRangeAt&&s.rangeCount){l=t.doc.createRange();for(var o=0;o<s.rangeCount;++o){n=s.getRangeAt(o);r=n.commonAncestorContainer;if(r&&r.nodeType!=1){r=r.parentNode}if(r&&r.nodeName.toLowerCase()=="a"){i.push(r)}else{a=r.getElementsByTagName("a");for(var f=0;f<a.length;++f){l.selectNodeContents(a[f]);if(l.compareBoundaryPoints(n.END_TO_START,n)<1&&l.compareBoundaryPoints(n.START_TO_END,n)>-1){i.push(a[f])}}}}}}else if(t.doc.selection&&t.doc.selection.type!="Control"){n=t.doc.selection.createRange();r=n.parentElement();if(r.nodeName.toLowerCase()=="a"){i.push(r)}else{a=r.getElementsByTagName("a");l=t.doc.body.createTextRange();for(var p=0;p<a.length;++p){l.moveToElementText(a[p]);if(l.compareEndPoints("StartToEnd",n)>-1&&l.compareEndPoints("EndToStart",n)<1){i.push(a[p])}}}}}return i}function r(n){l();setTimeout(function(){if(!n||n&&(n.which==1||n.type!="mouseup")){var r=i();var l=t.image?t.image.get():null;if(r&&!l){if(t.image){var s=t.node.contents(r);if(s.length==1&&s[0].tagName=="IMG"){var o=t.selection.ranges(0);if(o.startOffset===0&&o.endOffset===0){e(r).before(e.FE.MARKERS)}else{e(r).after(e.FE.MARKERS)}t.selection.restore();return false}}if(n){n.stopPropagation()}a(r)}}},t.helpers.isIOS()?100:0)}function a(i){var n=t.popups.get("link.edit");if(!n)n=s();var r=e(i);if(!t.popups.isVisible("link.edit")){t.popups.refresh("link.edit")}t.popups.setContainer("link.edit",t.$sc);var a=r.offset().left+e(i).outerWidth()/2;var l=r.offset().top+r.outerHeight();t.popups.show("link.edit",a,l,r.outerHeight())}function l(){t.popups.hide("link.edit")}function s(){var e="";if(t.opts.linkEditButtons.length>1){if(t.el.tagName=="A"&&t.opts.linkEditButtons.indexOf("linkRemove")>=0){t.opts.linkEditButtons.splice(t.opts.linkEditButtons.indexOf("linkRemove"),1)}e='<div class="fr-buttons">'+t.button.buildList(t.opts.linkEditButtons)+"</div>"}var n={buttons:e};var r=t.popups.create("link.edit",n);if(t.$wp){t.events.$on(t.$wp,"scroll.link-edit",function(){if(i()&&t.popups.isVisible("link.edit")){a(i())}})}return r}function o(){}function f(){var n=t.popups.get("link.insert");var r=i();if(r){var a=e(r);var l=n.find('input.fr-link-attr[type="text"]');var s=n.find('input.fr-link-attr[type="checkbox"]');var o;var f;for(o=0;o<l.length;o++){f=e(l[o]);f.val(a.attr(f.attr("name")||""))}s.prop("checked",false);for(o=0;o<s.length;o++){f=e(s[o]);if(a.attr(f.attr("name"))==f.data("checked")){f.prop("checked",true)}}n.find('input.fr-link-attr[type="text"][name="text"]').val(a.text())}else{n.find('input.fr-link-attr[type="text"]').val("");n.find('input.fr-link-attr[type="checkbox"]').prop("checked",false);n.find('input.fr-link-attr[type="text"][name="text"]').val(t.selection.text())}n.find("input.fr-link-attr").trigger("change");var p=t.image?t.image.get():null;if(p){n.find('.fr-link-attr[name="text"]').parent().hide()}else{n.find('.fr-link-attr[name="text"]').parent().show()}}function p(){var e=t.$tb.find('.fr-command[data-cmd="insertLink"]');var i=t.popups.get("link.insert");if(!i)i=d();if(!i.hasClass("fr-active")){t.popups.refresh("link.insert");t.popups.setContainer("link.insert",t.$tb||t.$sc);if(e.is(":visible")){var n=e.offset().left+e.outerWidth()/2;var r=e.offset().top+(t.opts.toolbarBottom?10:e.outerHeight()-10);t.popups.show("link.insert",n,r,e.outerHeight())}else{t.position.forSelection(i);t.popups.show("link.insert")}}}function d(e){if(e){t.popups.onRefresh("link.insert",f);t.popups.onHide("link.insert",o);return true}var n="";if(t.opts.linkInsertButtons.length>=1){n='<div class="fr-buttons">'+t.button.buildList(t.opts.linkInsertButtons)+"</div>"}var r='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="10" height="10" viewBox="0 0 32 32"><path d="M27 4l-15 15-7-7-5 5 12 12 20-20z" fill="#FFF"></path></svg>';var a="";var l=0;a='<div class="fr-link-insert-layer fr-layer fr-active" id="fr-link-insert-layer-'+t.id+'">';a+='<div class="fr-input-line"><input id="fr-link-insert-layer-url-'+t.id+'" name="href" type="text" class="fr-link-attr" placeholder="URL" tabIndex="'+ ++l+'"></div>';if(t.opts.linkText){a+='<div class="fr-input-line"><input id="fr-link-insert-layer-text-'+t.id+'" name="text" type="text" class="fr-link-attr" placeholder="'+t.language.translate("Text")+'" tabIndex="'+ ++l+'"></div>'}for(var s in t.opts.linkAttributes){if(t.opts.linkAttributes.hasOwnProperty(s)){var p=t.opts.linkAttributes[s];a+='<div class="fr-input-line"><input name="'+s+'" type="text" class="fr-link-attr" placeholder="'+t.language.translate(p)+'" tabIndex="'+ ++l+'"></div>'}}a+='<div class="fr-action-buttons"><button class="fr-command fr-submit" role="button" data-cmd="linkInsert" href="#" tabIndex="'+ ++l+'" type="button">'+t.language.translate("Insert")+"</button></div></div>";var d={buttons:n,input_layer:a};var u=t.popups.create("link.insert",d);if(t.$wp){t.events.$on(t.$wp,"scroll.link-insert",function(){var e=t.image?t.image.get():null;if(e&&t.popups.isVisible("link.insert")){E()}if(i&&t.popups.isVisible("link.insert")){m()}})}return u}function u(){var n=i();var r=t.image?t.image.get():null;if(t.events.trigger("link.beforeRemove",[n])===false)return false;if(r&&n){r.unwrap();t.image.edit(r)}else if(n){t.selection.save();e(n).replaceWith(e(n).html());t.selection.restore();l()}}function c(){t.events.on("keyup",function(t){if(t.which!=e.FE.KEYCODE.ESC){r(t)}});t.events.on("window.mouseup",r);t.events.$on(t.$el,"click","a",function(e){if(t.edit.isDisabled()){e.preventDefault()}});if(t.helpers.isMobile()){t.events.$on(t.$doc,"selectionchange",r)}d(true);if(t.el.tagName=="A"){t.$el.addClass("fr-view")}t.events.on("toolbar.esc",function(){if(t.popups.isVisible("link.edit")){t.events.disableBlur();t.events.focus();return false}},true)}function k(i){var n=t.opts.linkList[i];var r=t.popups.get("link.insert");var a=r.find('input.fr-link-attr[type="text"]');var l=r.find('input.fr-link-attr[type="checkbox"]');var s;var o;for(o=0;o<a.length;o++){s=e(a[o]);if(n[s.attr("name")]){s.val(n[s.attr("name")])}else if(s.attr("name")!="text"){s.val("")}}for(o=0;o<l.length;o++){s=e(l[o]);s.prop("checked",s.data("checked")==n[s.attr("name")])}t.accessibility.focusPopup(r)}function g(){var i=t.popups.get("link.insert");var n=i.find('input.fr-link-attr[type="text"]');var r=i.find('input.fr-link-attr[type="checkbox"]');var a=n.filter('[name="href"]').val();var l=n.filter('[name="text"]').val();var s={};var o;var f;for(f=0;f<n.length;f++){o=e(n[f]);if(["href","text"].indexOf(o.attr("name"))<0){s[o.attr("name")]=o.val()}}for(f=0;f<r.length;f++){o=e(r[f]);if(o.is(":checked")){s[o.attr("name")]=o.data("checked")}else{s[o.attr("name")]=o.data("unchecked")||null}}var p=t.helpers.scrollTop();h(a,l,s);e(t.o_win).scrollTop(p)}function v(){if(!t.selection.isCollapsed()){t.selection.save();var i=t.$el.find(".fr-marker").addClass("fr-unprocessed").toArray();while(i.length){var n=e(i.pop());n.removeClass("fr-unprocessed");var r=t.node.deepestParent(n.get(0));if(r){var a=n.get(0);var l="";var s="";do{a=a.parentNode;if(!t.node.isBlock(a)){l=l+t.node.closeTagString(a);s=t.node.openTagString(a)+s}}while(a!=r);var o=t.node.openTagString(n.get(0))+n.html()+t.node.closeTagString(n.get(0));n.replaceWith('<span id="fr-break"></span>');var f=e(r).html();f=f.replace(/<span id="fr-break"><\/span>/g,l+o+s);e(r).html(f)}i=t.$el.find(".fr-marker.fr-unprocessed").toArray()}t.selection.restore()}}function h(a,l,s){if(typeof s=="undefined")s={};if(t.events.trigger("link.beforeInsert",[a,l,s])===false)return false;var o=t.image?t.image.get():null;if(!o&&t.el.tagName!="A"){t.selection.restore();t.popups.hide("link.insert")}else if(t.el.tagName=="A"){t.$el.focus()}var f=a;if(t.opts.linkConvertEmailAddress){var p=/^[\w._]+@[a-z\u00a1-\uffff0-9_-]+?\.[a-z\u00a1-\uffff0-9]{2,}$/i;if(p.test(a)&&!/^mailto:.*/i.test(a)){a="mailto:"+a}}var d=/^([A-Za-z]:(\\){1,2}|[A-Za-z]:((\\){1,2}[^\\]+)+)(\\)?$/i;if(t.opts.linkAutoPrefix!==""&&!/^(mailto|tel|sms|notes|data):.*/i.test(a)&&!/^data:image.*/i.test(a)&&!/^(https?:|ftps?:|file:|)\/\//i.test(a)&&!d.test(a)){if(["/","{","[","#","("].indexOf((a||"")[0])<0){a=t.opts.linkAutoPrefix+a}}a=t.helpers.sanitizeURL(a);if(t.opts.linkAlwaysBlank)s.target="_blank";if(t.opts.linkAlwaysNoFollow)s.rel="nofollow";if(s.target=="_blank"){if(!s.rel)s.rel="noopener noreferrer";else s.rel+=" noopener noreferrer"}l=l||"";if(a===t.opts.linkAutoPrefix){var u=t.popups.get("link.insert");u.find('input[name="href"]').addClass("fr-error");t.events.trigger("link.bad",[f]);return false}var c=i();var k;if(c){k=e(c);k.attr("href",a);if(l.length>0&&k.text()!=l&&!o){k.text(l)}if(!o){k.prepend(e.FE.START_MARKER).append(e.FE.END_MARKER)}k.attr(s);if(!o){t.selection.restore()}}else{if(!o){t.format.remove("a");if(t.selection.isCollapsed()){l=l.length===0?f:l;t.html.insert('<a href="'+a+'">'+e.FE.START_MARKER+l+e.FE.END_MARKER+"</a>");t.selection.restore()}else{if(l.length>0&&l!=t.selection.text().replace(/\n/g,"")){t.selection.remove();t.html.insert('<a href="'+a+'">'+e.FE.START_MARKER+l+e.FE.END_MARKER+"</a>");t.selection.restore()}else{v();t.format.apply("a",{href:a})}}}else{o.wrap('<a href="'+a+'"></a>')}var g=n();for(var h=0;h<g.length;h++){k=e(g[h]);k.attr(s);k.removeAttr("_moz_dirty")}if(g.length==1&&t.$wp&&!o){e(g[0]).prepend(e.FE.START_MARKER).append(e.FE.END_MARKER);t.selection.restore()}}if(!o){r()}else{var m=t.popups.get("link.insert");m.find("input:focus").blur();t.image.edit(o)}}function m(){l();var n=i();if(n){var r=t.popups.get("link.insert");if(!r)r=d();if(!t.popups.isVisible("link.insert")){t.popups.refresh("link.insert");t.selection.save();if(t.helpers.isMobile()){t.events.disableBlur();t.$el.blur();t.events.enableBlur()}}t.popups.setContainer("link.insert",t.$sc);var a=(t.image?t.image.get():null)||e(n);var s=a.offset().left+a.outerWidth()/2;var o=a.offset().top+a.outerHeight();t.popups.show("link.insert",s,o,a.outerHeight())}}function b(){var e=t.image?t.image.get():null;if(!e){t.events.disableBlur();t.selection.restore();t.events.enableBlur();var n=i();if(n&&t.$wp){t.selection.restore();l();r()}else if(t.el.tagName=="A"){t.$el.focus();r()}else{t.popups.hide("link.insert");t.toolbar.showInline()}}else{t.image.back()}}function E(){var e=t.image?t.image.get():null;if(e){var i=t.popups.get("link.insert");if(!i)i=d();f(true);t.popups.setContainer("link.insert",t.$sc);var n=e.offset().left+e.outerWidth()/2;var r=e.offset().top+e.outerHeight();t.popups.show("link.insert",n,r,e.outerHeight())}}function y(n,a,l){if(typeof l=="undefined")l=t.opts.linkMultipleStyles;if(typeof a=="undefined")a=t.opts.linkStyles;var s=i();if(!s)return false;if(!l){var o=Object.keys(a);o.splice(o.indexOf(n),1);e(s).removeClass(o.join(" "))}e(s).toggleClass(n);r()}return{_init:c,remove:u,showInsertPopup:p,usePredefined:k,insertCallback:g,insert:h,update:m,get:i,allSelected:n,back:b,imageLink:E,applyStyle:y}};e.FE.DefineIcon("insertLink",{NAME:"link"});e.FE.RegisterShortcut(e.FE.KEYCODE.K,"insertLink",null,"K");e.FE.RegisterCommand("insertLink",{title:"Insert Link",undo:false,focus:true,refreshOnCallback:false,popup:true,callback:function(){if(!this.popups.isVisible("link.insert")){this.link.showInsertPopup()}else{if(this.$el.find(".fr-marker").length){this.events.disableBlur();this.selection.restore()}this.popups.hide("link.insert")}},plugin:"link"});e.FE.DefineIcon("linkOpen",{NAME:"external-link"});e.FE.RegisterCommand("linkOpen",{title:"Open Link",undo:false,refresh:function(e){var t=this.link.get();if(t){e.removeClass("fr-hidden")}else{e.addClass("fr-hidden")}},callback:function(){var e=this.link.get();if(e){this.o_win.open(e.href)}}});e.FE.DefineIcon("linkEdit",{NAME:"edit"});e.FE.RegisterCommand("linkEdit",{title:"Edit Link",undo:false,refreshAfterCallback:false,popup:true,callback:function(){this.link.update()},refresh:function(e){var t=this.link.get();if(t){e.removeClass("fr-hidden")}else{e.addClass("fr-hidden")}}});e.FE.DefineIcon("linkRemove",{NAME:"unlink"});e.FE.RegisterCommand("linkRemove",{title:"Unlink",callback:function(){this.link.remove()},refresh:function(e){var t=this.link.get();if(t){e.removeClass("fr-hidden")}else{e.addClass("fr-hidden")}}});e.FE.DefineIcon("linkBack",{NAME:"arrow-left"});e.FE.RegisterCommand("linkBack",{title:"Back",undo:false,focus:false,back:true,refreshAfterCallback:false,callback:function(){this.link.back()},refresh:function(e){var t=this.link.get()&&this.doc.hasFocus();var i=this.image?this.image.get():null;if(!i&&!t&&!this.opts.toolbarInline){e.addClass("fr-hidden");e.next(".fr-separator").addClass("fr-hidden")}else{e.removeClass("fr-hidden");e.next(".fr-separator").removeClass("fr-hidden")}}});e.FE.DefineIcon("linkList",{NAME:"search"});e.FE.RegisterCommand("linkList",{title:"Choose Link",type:"dropdown",focus:false,undo:false,refreshAfterCallback:false,html:function(){var e='<ul class="fr-dropdown-list" role="presentation">';var t=this.opts.linkList;for(var i=0;i<t.length;i++){e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="linkList" data-param1="'+i+'">'+(t[i].displayText||t[i].text)+"</a></li>"}e+="</ul>";return e},callback:function(e,t){this.link.usePredefined(t)}});e.FE.RegisterCommand("linkInsert",{focus:false,refreshAfterCallback:false,callback:function(){this.link.insertCallback()},refresh:function(e){var t=this.link.get();if(t){e.text(this.language.translate("Update"))}else{e.text(this.language.translate("Insert"))}}});e.FE.DefineIcon("imageLink",{NAME:"link"});e.FE.RegisterCommand("imageLink",{title:"Insert Link",undo:false,focus:false,popup:true,callback:function(){this.link.imageLink()},refresh:function(e){var t=this.link.get();var i;if(t){i=e.prev();if(i.hasClass("fr-separator")){i.removeClass("fr-hidden")}e.addClass("fr-hidden")}else{i=e.prev();if(i.hasClass("fr-separator")){i.addClass("fr-hidden")}e.removeClass("fr-hidden")}}});e.FE.DefineIcon("linkStyle",{NAME:"magic"});e.FE.RegisterCommand("linkStyle",{title:"Style",type:"dropdown",html:function(){var e='<ul class="fr-dropdown-list" role="presentation">';var t=this.opts.linkStyles;for(var i in t){if(t.hasOwnProperty(i)){e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="linkStyle" data-param1="'+i+'">'+this.language.translate(t[i])+"</a></li>"}}e+="</ul>";return e},callback:function(e,t){this.link.applyStyle(t)},refreshOnShow:function(t,i){var n=this.link.get();if(n){var r=e(n);i.find(".fr-command").each(function(){var t=e(this).data("param1");var i=r.hasClass(t);e(this).toggleClass("fr-active",i).attr("aria-selected",i)})}}})});