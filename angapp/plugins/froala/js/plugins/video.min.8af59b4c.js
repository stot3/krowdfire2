(function(e){if(typeof define==="function"&&define.amd){define(["jquery"],e)}else if(typeof module==="object"&&module.exports){module.exports=function(t,i){if(i===undefined){if(typeof window!=="undefined"){i=require("jquery")}else{i=require("jquery")(t)}}return e(i)}}else{e(window.jQuery)}})(function(e){var t,i;var r,o;e.extend(e.FE.POPUP_TEMPLATES,{"video.insert":"[_BUTTONS_][_BY_URL_LAYER_][_EMBED_LAYER_][_UPLOAD_LAYER_][_PROGRESS_BAR_]","video.edit":"[_BUTTONS_]","video.size":"[_BUTTONS_][_SIZE_LAYER_]"});e.extend(e.FE.DEFAULTS,{videoAllowedTypes:["mp4","webm","ogg"],videoAllowedProviders:[".*"],videoDefaultAlign:"center",videoDefaultDisplay:"block",videoDefaultWidth:600,videoEditButtons:["videoReplace","videoRemove","|","videoDisplay","videoAlign","videoSize"],videoInsertButtons:["videoBack","|","videoByURL","videoEmbed","videoUpload"],videoMaxSize:50*1024*1024,videoMove:true,videoResize:true,videoSizeButtons:["videoBack","|"],videoSplitHTML:false,videoTextNear:true,videoUploadMethod:"POST",videoUploadParam:"file",videoUploadParams:{},videoUploadToS3:false,videoUploadURL:"https://i.froala.com/upload"});e.FE.VIDEO_PROVIDERS=[{test_regex:/^.*((youtu.be)|(youtube.com))\/((v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))?\??v?=?([^#\&\?]*).*/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/)?([0-9a-zA-Z_\-]+)(.+)?/g,url_text:"//www.youtube.com/embed/$1",html:'<iframe width="640" height="360" src="{url}?wmode=opaque" frameborder="0" allowfullscreen></iframe>',provider:"youtube"},{test_regex:/^.*(?:vimeo.com)\/(?:channels(\/\w+\/)?|groups\/*\/videos\/â€‹\d+\/|video\/|)(\d+)(?:$|\/|\?)/,url_regex:/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/|)(\d+)(?:[a-zA-Z0-9_\-]+)?/i,url_text:"//player.vimeo.com/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"vimeo"},{test_regex:/^.+(dailymotion.com|dai.ly)\/(video|hub)?\/?([^_]+)[^#]*(#video=([^_&]+))?/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:dailymotion\.com|dai\.ly)\/(?:video|hub)?\/?(.+)/g,url_text:"//www.dailymotion.com/embed/video/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"dailymotion"},{test_regex:/^.+(screen.yahoo.com)\/[^_&]+/,url_regex:"",url_text:"",html:'<iframe width="640" height="360" src="{url}?format=embed" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>',provider:"yahoo"},{test_regex:/^.+(rutube.ru)\/[^_&]+/,url_regex:/(?:https?:\/\/)?(?:www\.)?(?:rutube\.ru)\/(?:video)?\/?(.+)/g,url_text:"//rutube.ru/play/embed/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true" allowtransparency="true"></iframe>',provider:"rutube"},{test_regex:/^(?:.+)vidyard.com\/(?:watch)?\/?([^.&/]+)\/?(?:[^_.&]+)?/,url_regex:/^(?:.+)vidyard.com\/(?:watch)?\/?([^.&/]+)\/?(?:[^_.&]+)?/g,url_text:"//play.vidyard.com/$1",html:'<iframe width="640" height="360" src="{url}" frameborder="0" allowfullscreen></iframe>',provider:"vidyard"}];e.FE.VIDEO_EMBED_REGEX=/^\W*((<iframe.*><\/iframe>)|(<embed.*>))\W*$/i;e.FE.PLUGINS.video=function(a){var s;var n;var d;var l;var f=1;var v=2;var u=3;var p=4;var c=5;var h=6;var g=7;var m={};m[f]="Video cannot be loaded from the passed link.",m[v]="No link in upload response.",m[u]="Error during file upload.",m[p]="Parsing response failed.",m[c]="File is too large.",m[h]="Video file type is invalid.",m[g]="Files can be uploaded only to same domain in IE 8 and IE 9.";function b(){var e=a.popups.get("video.insert");var t=e.find(".fr-video-by-url-layer input");t.val("").trigger("change");var i=e.find(".fr-video-embed-layer textarea");i.val("").trigger("change");i=e.find(".fr-video-upload-layer input");i.val("").trigger("change")}function y(){var e=a.$tb.find('.fr-command[data-cmd="insertVideo"]');var t=a.popups.get("video.insert");if(!t)t=E();$();if(!t.hasClass("fr-active")){a.popups.refresh("video.insert");a.popups.setContainer("video.insert",a.$tb);var i=e.offset().left+e.outerWidth()/2;var r=e.offset().top+(a.opts.toolbarBottom?10:e.outerHeight()-10);a.popups.show("video.insert",i,r,e.outerHeight())}}function w(){var e=a.popups.get("video.edit");if(!e)e=le();if(e){a.popups.setContainer("video.edit",a.$sc);a.popups.refresh("video.edit");var t=l.find("iframe, embed, video");var i=t.offset().left+t.outerWidth()/2;var r=t.offset().top+t.outerHeight();a.popups.show("video.edit",i,r,t.outerHeight())}}function E(e){if(e){a.popups.onRefresh("video.insert",b);a.popups.onHide("image.insert",Ce);return true}var t="";if(a.opts.videoInsertButtons.length>1){t='<div class="fr-buttons">'+a.button.buildList(a.opts.videoInsertButtons)+"</div>"}var i="";var r=a.opts.videoInsertButtons.indexOf("videoUpload");var o=a.opts.videoInsertButtons.indexOf("videoByURL");var s=a.opts.videoInsertButtons.indexOf("videoEmbed");var n;if(o>=0){n=" fr-active";if(o>r&&r>=0||o>s&&s>=0){n=""}i='<div class="fr-video-by-url-layer fr-layer'+n+'" id="fr-video-by-url-layer-'+a.id+'"><div class="fr-input-line"><input id="fr-video-by-url-layer-text-'+a.id+'" type="text" placeholder="http://" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoInsertByURL" tabIndex="2" role="button">'+a.language.translate("Insert")+"</button></div></div>"}var d="";if(s>=0){n=" fr-active";if(s>r&&r>=0||s>o&&o>=0){n=""}d='<div class="fr-video-embed-layer fr-layer'+n+'" id="fr-video-embed-layer-'+a.id+'"><div class="fr-input-line"><textarea id="fr-video-embed-layer-text'+a.id+'" type="text" placeholder="'+a.language.translate("Embedded Code")+'" tabIndex="1" aria-required="true" rows="5"></textarea></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoInsertEmbed" tabIndex="2" role="button">'+a.language.translate("Insert")+"</button></div></div>"}var l="";if(r>=0){n=" fr-active";if(r>s&&s>=0||r>o&&o>=0){n=""}l='<div class="fr-video-upload-layer fr-layer'+n+'" id="fr-video-upload-layer-'+a.id+'"><strong>'+a.language.translate("Drop video")+"</strong><br>("+a.language.translate("or click")+')<div class="fr-form"><input type="file" accept="video/'+a.opts.videoAllowedTypes.join(", video/").toLowerCase()+'" tabIndex="-1" aria-labelledby="fr-video-upload-layer-'+a.id+'" role="button"></div></div>'}var f='<div class="fr-video-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="videoDismissError" tabIndex="2" role="button">OK</button></div></div>';var v={buttons:t,by_url_layer:i,embed_layer:d,upload_layer:l,progress_bar:f};var u=a.popups.create("video.insert",v);se(u);return u}function C(e){var t=a.popups.get("video.insert");var i;var r;if(!l&&!a.opts.toolbarInline){var o=a.$tb.find('.fr-command[data-cmd="insertVideo"]');i=o.offset().left+o.outerWidth()/2;r=o.offset().top+(a.opts.toolbarBottom?10:o.outerHeight()-10)}if(a.opts.toolbarInline){r=t.offset().top-a.helpers.getPX(t.css("margin-top"));if(t.hasClass("fr-above")){r+=t.outerHeight()}}t.find(".fr-layer").removeClass("fr-active");t.find(".fr-"+e+"-layer").addClass("fr-active");a.popups.show("video.insert",i,r,0);a.accessibility.focusPopup(t)}function _(e){var t=a.popups.get("video.insert");if(t.find(".fr-video-by-url-layer").hasClass("fr-active")){e.addClass("fr-active").attr("aria-pressed",true)}}function x(e){var t=a.popups.get("video.insert");if(t.find(".fr-video-embed-layer").hasClass("fr-active")){e.addClass("fr-active").attr("aria-pressed",true)}}function A(e){var t=a.popups.get("video.insert");if(t.find(".fr-video-upload-layer").hasClass("fr-active")){e.addClass("fr-active").attr("aria-pressed",true)}}function D(e){a.events.focus(true);a.selection.restore();var t=false;if(l){Ee();t=true}a.html.insert('<span contenteditable="false" draggable="true" class="fr-jiv fr-video">'+e+"</span>",false,a.opts.videoSplitHTML);a.popups.hide("video.insert");var i=a.$el.find(".fr-jiv");i.removeClass("fr-jiv");_e(i,a.opts.videoDefaultDisplay,a.opts.videoDefaultAlign);i.toggleClass("fr-draggable",a.opts.videoMove);a.events.trigger(t?"video.replaced":"video.inserted",[i])}function R(){var t=e(this);a.popups.hide("video.insert");t.removeClass("fr-uploading");if(t.parent().next().is("br")){t.parent().next().remove()}O(t.parent());a.events.trigger("video.loaded",[t.parent()])}function S(e,t,i,r,o){a.edit.off();B("Loading video");if(t)e=a.helpers.sanitizeURL(e);var s=document.createElement("video");s.oncanplay=function(){var t;var s;if(r){if(!a.undo.canDo()&&!r.find("video").hasClass("fr-uploading"))a.undo.saveStep();var n=r.find("video").data("fr-old-src");var d=r.data("fr-replaced");r.data("fr-replaced",false);if(a.$wp){t=r.clone();t.find("video").removeData("fr-old-src").removeClass("fr-uploading");t.find("video").off("canplay");if(n)r.find("video").attr("src",n);r.replaceWith(t)}else{t=r}var l=t.find("video").get(0).attributes;for(var f=0;f<l.length;f++){var v=l[f];if(v.nodeName.indexOf("data-")===0){t.find("video").removeAttr(v.nodeName)}}if(typeof i!="undefined"){for(s in i){if(i.hasOwnProperty(s)){if(s!="path_external"&&s!="path_internal"){t.find("video").attr("data-"+s,i[s])}}}}t.find("video").on("canplay",R);t.find("video").attr("src",e);a.edit.on();G();a.undo.saveStep();a.$el.blur();a.events.trigger(d?"video.replaced":"video.inserted",[t,o])}else{t=V(e,i,R);G();a.undo.saveStep();a.events.trigger("video.inserted",[t,o])}};s.onerror=function(){de(f)};I("Loading video");s.src=e}function I(e){var t=a.popups.get("video.insert");if(!t)t=E();t.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive");t.find(".fr-video-progress-bar-layer").addClass("fr-active");t.find(".fr-buttons").hide();if(l){var i=l.find("video");a.popups.setContainer("video.insert",a.$sc);var r=i.offset().left+i.width()/2;var o=i.offset().top+i.height();a.popups.show("video.insert",r,o,i.outerHeight())}if(typeof e=="undefined"){B(a.language.translate("Uploading"),0)}}function $(e){var t=a.popups.get("video.insert");if(t){t.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive");t.find(".fr-video-progress-bar-layer").removeClass("fr-active");t.find(".fr-buttons").show();if(e||a.$el.find("video.fr-error").length){a.events.focus();if(a.$el.find("video.fr-error").length){a.$el.find("video.fr-error").parent().remove();a.undo.saveStep();a.undo.run();a.undo.dropRedo()}if(!a.$wp&&l){var i=l;ee(true);a.selection.setAfter(i.find("video").get(0));a.selection.restore()}a.popups.hide("video.insert")}}}function B(e,t){var i=a.popups.get("video.insert");if(i){var r=i.find(".fr-video-progress-bar-layer");r.find("h3").text(e+(t?" "+t+"%":""));r.removeClass("fr-error");if(t){r.find("div").removeClass("fr-indeterminate");r.find("div > span").css("width",t+"%")}else{r.find("div").addClass("fr-indeterminate")}}}function k(e){I();var t=a.popups.get("video.insert");var i=t.find(".fr-video-progress-bar-layer");i.addClass("fr-error");var r=i.find("h3");r.text(e);a.events.disableBlur();r.focus()}function F(t){if(typeof t=="undefined"){var i=a.popups.get("video.insert");t=i.find('.fr-video-by-url-layer input[type="text"]').val()||""}var r=null;if(a.helpers.isURL(t)){for(var o=0;o<e.FE.VIDEO_PROVIDERS.length;o++){var s=e.FE.VIDEO_PROVIDERS[o];if(s.test_regex.test(t)&&new RegExp(a.opts.videoAllowedProviders.join("|")).test(s.provider)){r=t.replace(s.url_regex,s.url_text);r=s.html.replace(/\{url\}/,r);break}}}if(r){D(r)}else{a.events.trigger("video.linkError",[t])}}function U(t){if(typeof t=="undefined"){var i=a.popups.get("video.insert");t=i.find(".fr-video-embed-layer textarea").val()||""}if(t.length===0||!e.FE.VIDEO_EMBED_REGEX.test(t)){a.events.trigger("video.codeError",[t])}else{D(t)}}function O(e){J.call(e.get(0))}function P(t){try{if(a.events.trigger("video.uploaded",[t],true)===false){a.edit.on();return false}var i=e.parseJSON(t);if(i.path_external||i.data.path_external){return i}else{de(v,t);return false}}catch(e){de(p,t);return false}}function z(t){try{var i=e(t).find("Location").text();var r=e(t).find("Key").text();if(a.events.trigger("video.uploadedToS3",[i,r,t],true)===false){a.edit.on();return false}return i}catch(e){de(p,t);return false}}function L(e){B("Loading video");var i=this.status;var r=this.response;var s=this.responseXML;var n=this.responseText;try{if(a.opts.videoUploadToS3){if(i==201){var d=z(s);if(d){S(d,false,[],e,r||s)}}else{de(p,r||s)}}else{if(i>=200&&i<300){var l=P(n);if(l){var f;if(o=="admin"||o=="campaign-setup"||o=="campaign-manager"||o=="rewards"){if(l.path_external){f=t+"/static/images/"+l.path_external}else if(l.data.path_external){f=t+"/static/images/"+l.data.path_external}}S(f,false,l,e,r||n)}}else{de(u,r||n)}}}catch(e){de(p,r||n)}}function T(){de(p,this.response||this.responseText||this.responseXML)}function M(e){if(e.lengthComputable){var t=e.loaded/e.total*100|0;B(a.language.translate("Uploading"),t)}}function N(){a.edit.on();$(true)}function V(t,i,r){var o="";var s;if(i&&typeof i!="undefined"){for(s in i){if(i.hasOwnProperty(s)){if(s!="link"&&s!="path_internal"){o+=" data-"+s+'="'+i[s]+'"'}}}}var n=a.opts.videoDefaultWidth;if(n&&n!="auto"){n=n+"px"}var d=e('<span contenteditable="false" draggable="true" class="fr-video fr-dv'+a.opts.videoDefaultDisplay[0]+(a.opts.videoDefaultAlign!="center"?" fr-fv"+a.opts.videoDefaultAlign[0]:"")+'"><video src="'+t+'" '+o+(n?' style="width: '+n+';"':"")+'" controls>'+a.language.translate("Your browser does not support HTML5 video.")+"</video></span>");d.toggleClass("fr-draggable",a.opts.videoMove);d.find("video").on("canplay",r);a.edit.on();a.events.focus(true);a.selection.restore();a.undo.saveStep();if(a.opts.videoSplitHTML){a.markers.split()}else{a.markers.insert()}var l=a.$el.find(".fr-marker");if(a.node.isLastSibling(l)&&l.parent().hasClass("fr-deletable")){l.insertAfter(l.parent())}l.replaceWith(d);a.html.wrap();a.selection.clear();return d}function Y(t){if(!a.core.sameInstance(d))return true;t.preventDefault();t.stopPropagation();var i=t.pageX||(t.originalEvent.touches?t.originalEvent.touches[0].pageX:null);var r=t.pageY||(t.originalEvent.touches?t.originalEvent.touches[0].pageY:null);if(!i||!r){return false}if(t.type=="mousedown"){var o=a.$oel.get(0);var l=o.ownerDocument;var f=l.defaultView||l.parentWindow;var v=false;try{v=f.location!=f.parent.location}catch(e){}if(v&&f.frameElement){i+=a.helpers.getPX(e(f.frameElement).offset().left)+f.frameElement.clientLeft;r=t.clientY+a.helpers.getPX(e(f.frameElement).offset().top)+f.frameElement.clientTop}}if(!a.undo.canDo())a.undo.saveStep();n=e(this);n.data("start-x",i);n.data("start-y",r);s.show();a.popups.hideAll();ie()}function H(e){if(!a.core.sameInstance(d))return true;if(n){e.preventDefault();var t=e.pageX||(e.originalEvent.touches?e.originalEvent.touches[0].pageX:null);var i=e.pageY||(e.originalEvent.touches?e.originalEvent.touches[0].pageY:null);if(!t||!i){return false}var r=n.data("start-x");var o=n.data("start-y");n.data("start-x",t);n.data("start-y",i);var s=t-r;var f=i-o;var v=l.find("iframe, embed, video");var u=v.width();var p=v.height();if(n.hasClass("fr-hnw")||n.hasClass("fr-hsw")){s=0-s}if(n.hasClass("fr-hnw")||n.hasClass("fr-hne")){f=0-f}v.css("width",u+s);v.css("height",p+f);v.removeAttr("width");v.removeAttr("height");Q()}}function X(e){if(!a.core.sameInstance(d))return true;if(n&&l){if(e)e.stopPropagation();n=null;s.hide();Q();w();a.undo.saveStep()}}function K(e){return'<div class="fr-handler fr-h'+e+'"></div>'}function W(e,t,i,r){e.pageX=t;e.pageY=t;Y.call(this,e);e.pageX=e.pageX+i*Math.floor(Math.pow(1.1,r));e.pageY=e.pageY+i*Math.floor(Math.pow(1.1,r));H.call(this,e);X.call(this,e);return++r}function j(){var t;if(!a.shared.$video_resizer){a.shared.$video_resizer=e('<div class="fr-video-resizer"></div>');d=a.shared.$video_resizer;a.events.$on(d,"mousedown",function(e){e.stopPropagation()},true);if(a.opts.videoResize){d.append(K("nw")+K("ne")+K("sw")+K("se"));a.shared.$vid_overlay=e('<div class="fr-video-overlay"></div>');s=a.shared.$vid_overlay;t=d.get(0).ownerDocument;e(t).find("body:first").append(s)}}else{d=a.shared.$video_resizer;s=a.shared.$vid_overlay;a.events.on("destroy",function(){d.removeClass("fr-active").appendTo(e("body:first"))},true)}a.events.on("shared.destroy",function(){d.html("").removeData().remove();d=null;if(a.opts.videoResize){s.remove();s=null}},true);if(!a.helpers.isMobile()){a.events.$on(e(a.o_win),"resize.video",function(){ee(true)})}if(a.opts.videoResize){t=d.get(0).ownerDocument;a.events.$on(d,a._mousedown,".fr-handler",Y);a.events.$on(e(t),a._mousemove,H);a.events.$on(e(t.defaultView||t.parentWindow),a._mouseup,X);a.events.$on(s,"mouseleave",X);var i=1;var r=null;var o=0;a.events.on("keydown",function(t){if(l){var s=navigator.userAgent.indexOf("Mac OS X")!=-1?t.metaKey:t.ctrlKey;var n=t.which;if(n!==r||t.timeStamp-o>200){i=1}if((n==e.FE.KEYCODE.EQUALS||a.browser.mozilla&&n==e.FE.KEYCODE.FF_EQUALS)&&s&&!t.altKey){i=W.call(this,t,1,1,i)}else if((n==e.FE.KEYCODE.HYPHEN||a.browser.mozilla&&n==e.FE.KEYCODE.FF_HYPHEN)&&s&&!t.altKey){i=W.call(this,t,2,-1,i)}r=n;o=t.timeStamp}});a.events.on("keyup",function(){i=1})}}var q;function G(){var t=Array.prototype.slice.call(a.el.querySelectorAll("video"));var i=[];var r;for(r=0;r<t.length;r++){i.push(t[r].getAttribute("src"));e(t[r]).toggleClass("fr-draggable",a.opts.videoMove);if(t[r].getAttribute("class")==="")t[r].removeAttribute("class");if(t[r].getAttribute("style")==="")t[r].removeAttribute("style")}if(q){for(r=0;r<q.length;r++){if(i.indexOf(q[r].getAttribute("src"))<0){a.events.trigger("video.removed",[e(q[r])])}}}q=t}function Q(){if(!d)j();(a.$wp||a.$sc).append(d);d.data("instance",a);var e=l.find("iframe, embed, video");d.css("top",(a.opts.iframe?e.offset().top-1:e.offset().top-a.$wp.offset().top-1)+a.$wp.scrollTop()).css("left",(a.opts.iframe?e.offset().left-1:e.offset().left-a.$wp.offset().left-1)+a.$wp.scrollLeft()).css("width",e.outerWidth()).css("height",e.height()).addClass("fr-active")}var Z;function J(t){if(t&&t.type=="touchend"&&Z){return true}if(t&&a.edit.isDisabled()){t.stopPropagation();t.preventDefault();return false}if(a.edit.isDisabled()){return false}for(var i=0;i<e.FE.INSTANCES.length;i++){if(e.FE.INSTANCES[i]!=a){e.FE.INSTANCES[i].events.trigger("video.hideResizer")}}a.toolbar.disable();if(a.helpers.isMobile()){a.events.disableBlur();a.$el.blur();a.events.enableBlur()}l=e(this);e(this).addClass("fr-active");if(a.opts.iframe){a.size.syncIframe()}Se();Q();w();a.selection.clear();a.button.bulkRefresh();a.events.trigger("image.hideResizer")}function ee(e){if(l&&(re()||e===true)){d.removeClass("fr-active");a.toolbar.enable();l.removeClass("fr-active");l=null;ie()}}a.shared.vid_exit_flag=false;function te(){a.shared.vid_exit_flag=true}function ie(){a.shared.vid_exit_flag=false}function re(){return a.shared.vid_exit_flag}function oe(t){var i=t.originalEvent.dataTransfer;if(i&&i.files&&i.files.length){var r=i.files[0];if(r&&r.type&&r.type.indexOf("video")!==-1){a.markers.remove();a.markers.insertAtPoint(t.originalEvent);a.$el.find(".fr-marker").replaceWith(e.FE.MARKERS);a.popups.hideAll();var o=a.popups.get("video.insert");if(!o)o=E();a.popups.setContainer("video.insert",a.$sc);a.popups.show("video.insert",t.originalEvent.pageX,t.originalEvent.pageY);I();if(a.opts.videoAllowedTypes.indexOf(r.type.replace(/video\//g,""))>=0){ae(i.files)}else{de(h)}t.preventDefault();t.stopPropagation();return false}}}function ae(s){if(typeof s!="undefined"&&s.length>0){if(a.events.trigger("video.beforeUpload",[s])===false){return false}var n=s[0];if(n.size>a.opts.videoMaxSize){de(c);return false}if(a.opts.videoAllowedTypes.indexOf(n.type.replace(/video\//g,""))<0){de(h);return false}var d;if(a.drag_support.formdata){d=a.drag_support.formdata?new FormData:null}if(d){var f;if(a.opts.videoUploadToS3!==false){d.append("key",a.opts.videoUploadToS3.keyStart+(new Date).getTime()+"-"+(n.name||"untitled"));d.append("success_action_status","201");d.append("X-Requested-With","xhr");d.append("Content-Type",n.type);for(f in a.opts.videoUploadToS3.params){if(a.opts.videoUploadToS3.params.hasOwnProperty(f)){d.append(f,a.opts.videoUploadToS3.params[f])}}}for(f in a.opts.videoUploadParams){if(a.opts.videoUploadParams.hasOwnProperty(f)){d.append(f,a.opts.videoUploadParams[f])}}d.append(a.opts.videoUploadParam,n);var v=a.opts.videoUploadURL;t=e("textarea[data-server]").attr("data-server");i=e("textarea[data-server]").attr("data-loc");r=window.location.pathname;o=r.split("/")[1];var u=new XMLHttpRequest;var p=new FormData;p.append("success_action_status","200");p.append("X-Requested-With","xhr");p.append("Content-Type",n.type);if(o=="admin"){var g=t+i+"portal/resource/file";u.open("POST",g,true);p.append("resource_type","file");p.append("resource_content_type","generic");p.append("resource",n);p.append("region_id","1")}else if(o=="campaign-setup"||o=="rewards"||o=="campaign-manager"){var m;if(o=="campaign-manager"){m=r.split("/")[3]}else{m=r.split("/")[2]}var g=t+i+"campaign/"+m+"/resource/file";u.open("POST",g,true);p.append("entry_id",m);p.append("resource_type","file");p.append("resource_content_type","generic");p.append("resource",n);p.append("region_id","2")}u.withCredentials=true;u.onload=function(){L.call(u,l)};u.onerror=T;u.upload.onprogress=M;u.onabort=N;I();a.edit.off();u.send(p)}}}function se(t){a.events.$on(t,"dragover dragenter",".fr-video-upload-layer",function(){e(this).addClass("fr-drop");return false});a.events.$on(t,"dragleave dragend",".fr-video-upload-layer",function(){e(this).removeClass("fr-drop");return false});a.events.$on(t,"drop",".fr-video-upload-layer",function(i){i.preventDefault();i.stopPropagation();e(this).removeClass("fr-drop");var r=i.originalEvent.dataTransfer;if(r&&r.files){var o=t.data("instance")||a;o.events.disableBlur();o.video.upload(r.files);o.events.enableBlur()}});a.events.$on(t,"change",'.fr-video-upload-layer input[type="file"]',function(){if(this.files){var i=t.data("instance")||a;i.events.disableBlur();t.find("input:focus").blur();i.events.enableBlur();i.video.upload(this.files)}e(this).val("")})}function ne(){a.events.on("drop",oe,true);a.events.on("mousedown window.mousedown",te);a.events.on("window.touchmove",ie);a.events.on("mouseup window.mouseup",ee);a.events.on("commands.mousedown",function(e){if(e.parents(".fr-toolbar").length>0){ee()}});a.events.on("blur video.hideResizer commands.undo commands.redo element.dropped",function(){ee(true)})}function de(e,t){a.edit.on();if(l)l.find("video").addClass("fr-error");k(a.language.translate("Something went wrong. Please try again."));a.events.trigger("video.error",[{code:e,message:m[e]},t])}function le(){var e="";if(a.opts.videoEditButtons.length>0){e+='<div class="fr-buttons">';e+=a.button.buildList(a.opts.videoEditButtons);e+="</div>";var t={buttons:e};var i=a.popups.create("video.edit",t);a.events.$on(a.$wp,"scroll.video-edit",function(){if(l&&a.popups.isVisible("video.edit")){a.events.disableBlur();O(l)}});return i}return false}function fe(){if(l){var e=a.popups.get("video.size");var t=l.find("iframe, embed, video");e.find('input[name="width"]').val(t.get(0).style.width||t.attr("width")).trigger("change");e.find('input[name="height"]').val(t.get(0).style.height||t.attr("height")).trigger("change")}}function ve(){var e=a.popups.get("video.size");if(!e)e=ue();$();a.popups.refresh("video.size");a.popups.setContainer("video.size",a.$sc);var t=l.find("iframe, embed, video");var i=t.offset().left+t.width()/2;var r=t.offset().top+t.height();a.popups.show("video.size",i,r,t.height())}function ue(e){if(e){a.popups.onRefresh("video.size",fe);return true}var t="";t='<div class="fr-buttons">'+a.button.buildList(a.opts.videoSizeButtons)+"</div>";var i="";i='<div class="fr-video-size-layer fr-layer fr-active" id="fr-video-size-layer-'+a.id+'"><div class="fr-video-group"><div class="fr-input-line"><input id="fr-video-size-layer-width-'+a.id+'" type="text" name="width" placeholder="'+a.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input id="fr-video-size-layer-height-'+a.id+'" type="text" name="height" placeholder="'+a.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="videoSetSize" tabIndex="2" role="button">'+a.language.translate("Update")+"</button></div></div>";var r={buttons:t,size_layer:i};var o=a.popups.create("video.size",r);a.events.$on(a.$wp,"scroll",function(){if(l&&a.popups.isVisible("video.size")){a.events.disableBlur();O(l)}});return o}function pe(e){if(typeof e=="undefined")e=l;if(e){if(e.hasClass("fr-fvl")){return"left"}else if(e.hasClass("fr-fvr")){return"right"}else if(e.hasClass("fr-dvb")||e.hasClass("fr-dvi")){return"center"}else{if(e.css("display")=="block"){if(e.css("text-algin")=="left"){return"left"}else if(e.css("text-align")=="right"){return"right"}}else{if(e.css("float")=="left"){return"left"}else if(e.css("float")=="right"){return"right"}}}}return"center"}function ce(e){l.removeClass("fr-fvr fr-fvl");if(!a.opts.htmlUntouched&&a.opts.useClasses){if(e=="left"){l.addClass("fr-fvl")}else if(e=="right"){l.addClass("fr-fvr")}}else{_e(l,me(),e)}Se();Q();w();a.selection.clear()}function he(e){if(!l)return false;e.find("> *:first").replaceWith(a.icon.create("video-align-"+pe()))}function ge(e,t){if(l){t.find('.fr-command[data-param1="'+pe()+'"]').addClass("fr-active").attr("aria-selected",true)}}function me(e){if(typeof e=="undefined")e=l;var t=e.css("float");e.css("float","none");if(e.css("display")=="block"){e.css("float","");if(e.css("float")!=t)e.css("float",t);return"block"}else{e.css("float","");if(e.css("float")!=t)e.css("float",t);return"inline"}return"inline"}function be(e){l.removeClass("fr-dvi fr-dvb");if(!a.opts.htmlUntouched&&a.opts.useClasses){if(e=="inline"){l.addClass("fr-dvi")}else if(e=="block"){l.addClass("fr-dvb")}}else{_e(l,e,pe())}Se();Q();w();a.selection.clear()}function ye(e,t){if(l){t.find('.fr-command[data-param1="'+me()+'"]').addClass("fr-active").attr("aria-selected",true)}}function we(){var e=a.popups.get("video.insert");if(!e)e=E();if(!a.popups.isVisible("video.insert")){$();a.popups.refresh("video.insert");a.popups.setContainer("video.insert",a.$sc)}var t=l.offset().left+l.width()/2;var i=l.offset().top+l.height();a.popups.show("video.insert",t,i,l.outerHeight())}function Ee(){if(l){if(a.events.trigger("video.beforeRemove",[l])!==false){var e=l;a.popups.hideAll();ee(true);a.selection.setBefore(e.get(0))||a.selection.setAfter(e.get(0));e.remove();a.selection.restore();a.html.fillEmptyBlocks();a.events.trigger("video.removed",[e])}}}function Ce(){$()}function _e(e,t,i){if(!a.opts.htmlUntouched&&a.opts.useClasses){e.removeClass("fr-fvl fr-fvr fr-dvb fr-dvi");e.addClass("fr-fv"+i[0]+" fr-dv"+t[0])}else{if(t=="inline"){e.css({display:"inline-block"});if(i=="center"){e.css({float:"none"})}else if(i=="left"){e.css({float:"left"})}else{e.css({float:"right"})}}else{e.css({display:"block",clear:"both"});if(i=="left"){e.css({textAlign:"left"})}else if(i=="right"){e.css({textAlign:"right"})}else{e.css({textAlign:"center"})}}}}function xe(e){if(!e.hasClass("fr-dvi")&&!e.hasClass("fr-dvb")){e.addClass("fr-fv"+pe(e)[0]);e.addClass("fr-dv"+me(e)[0])}}function Ae(e){var t=e.hasClass("fr-dvb")?"block":e.hasClass("fr-dvi")?"inline":null;var i=e.hasClass("fr-fvl")?"left":e.hasClass("fr-fvr")?"right":pe(e);_e(e,t,i);e.removeClass("fr-dvb fr-dvi fr-fvr fr-fvl")}function De(){a.$el.find("video").filter(function(){return e(this).parents("span.fr-video").length===0}).wrap('<span class="fr-video" contenteditable="false"></span>');a.$el.find("embed, iframe").filter(function(){if(a.browser.safari&&this.getAttribute("src")){this.setAttribute("src",this.src)}if(e(this).parents("span.fr-video").length>0)return false;var t=e(this).attr("src");for(var i=0;i<e.FE.VIDEO_PROVIDERS.length;i++){var r=e.FE.VIDEO_PROVIDERS[i];if(r.test_regex.test(t)&&new RegExp(a.opts.videoAllowedProviders.join("|")).test(r.provider)){return true}}return false}).map(function(){return e(this).parents("object").length===0?this:e(this).parents("object").get(0)}).wrap('<span class="fr-video" contenteditable="false"></span>');var t=a.$el.find("span.fr-video, video");for(var i=0;i<t.length;i++){var r=e(t[i]);if(!a.opts.htmlUntouched&&a.opts.useClasses){xe(r);if(!a.opts.videoTextNear){r.removeClass("fr-dvi").addClass("fr-dvb")}}else if(!a.opts.htmlUntouched&&!a.opts.useClasses){Ae(r)}}t.toggleClass("fr-draggable",a.opts.videoMove)}function Re(){ne();if(a.helpers.isMobile()){a.events.$on(a.$el,"touchstart","span.fr-video",function(){Z=false});a.events.$on(a.$el,"touchmove",function(){Z=true})}a.events.on("html.set",De);De();a.events.$on(a.$el,"mousedown","span.fr-video",function(e){e.stopPropagation()});a.events.$on(a.$el,"click touchend","span.fr-video",J);a.events.on("keydown",function(t){var i=t.which;if(l&&(i==e.FE.KEYCODE.BACKSPACE||i==e.FE.KEYCODE.DELETE)){t.preventDefault();Ee();return false}if(l&&i==e.FE.KEYCODE.ESC){ee(true);t.preventDefault();return false}if(l&&i!=e.FE.KEYCODE.F10&&!a.keys.isBrowserAction(t)){t.preventDefault();return false}},true);a.events.on("toolbar.esc",function(){if(l){a.events.disableBlur();a.events.focus();return false}},true);a.events.on("toolbar.focusEditor",function(){if(l){return false}},true);a.events.on("keydown",function(){a.$el.find("span.fr-video:empty").remove()});E(true);ue(true)}function Se(){if(l){a.selection.clear();var e=a.doc.createRange();e.selectNode(l.get(0));var t=a.selection.get();t.addRange(e)}}function Ie(){if(l){a.events.disableBlur();l.trigger("click")}else{a.events.disableBlur();a.selection.restore();a.events.enableBlur();a.popups.hide("video.insert");a.toolbar.showInline()}}function $e(e,t){if(l){var i=a.popups.get("video.size");var r=l.find("iframe, embed, video");r.css("width",e||i.find('input[name="width"]').val());r.css("height",t||i.find('input[name="height"]').val());if(r.get(0).style.width)r.removeAttr("width");if(r.get(0).style.height)r.removeAttr("height");i.find("input:focus").blur();setTimeout(function(){l.trigger("click")},a.helpers.isAndroid()?50:0)}}function Be(){return l}return{_init:Re,showInsertPopup:y,showLayer:C,refreshByURLButton:_,refreshEmbedButton:x,refreshUploadButton:A,upload:ae,insertByURL:F,insertEmbed:U,insert:D,align:ce,refreshAlign:he,refreshAlignOnShow:ge,display:be,refreshDisplayOnShow:ye,remove:Ee,hideProgressBar:$,showSizePopup:ve,replace:we,back:Ie,setSize:$e,get:Be}};e.FE.RegisterCommand("insertVideo",{title:"Insert Video",undo:false,focus:true,refreshAfterCallback:false,popup:true,callback:function(){if(!this.popups.isVisible("video.insert")){this.video.showInsertPopup()}else{if(this.$el.find(".fr-marker").length){this.events.disableBlur();this.selection.restore()}this.popups.hide("video.insert")}},plugin:"video"});e.FE.DefineIcon("insertVideo",{NAME:"video-camera"});e.FE.DefineIcon("videoByURL",{NAME:"link"});e.FE.RegisterCommand("videoByURL",{title:"By URL",undo:false,focus:false,toggle:true,callback:function(){this.video.showLayer("video-by-url")},refresh:function(e){this.video.refreshByURLButton(e)}});e.FE.DefineIcon("videoEmbed",{NAME:"code"});e.FE.RegisterCommand("videoEmbed",{title:"Embedded Code",undo:false,focus:false,toggle:true,callback:function(){this.video.showLayer("video-embed")},refresh:function(e){this.video.refreshEmbedButton(e)}});e.FE.DefineIcon("videoUpload",{NAME:"upload"});e.FE.RegisterCommand("videoUpload",{title:"Upload Video",undo:false,focus:false,toggle:true,callback:function(){this.video.showLayer("video-upload")},refresh:function(e){this.video.refreshUploadButton(e)}});e.FE.RegisterCommand("videoInsertByURL",{undo:true,focus:true,callback:function(){this.video.insertByURL()}});e.FE.RegisterCommand("videoInsertEmbed",{undo:true,focus:true,callback:function(){this.video.insertEmbed()}});e.FE.DefineIcon("videoDisplay",{NAME:"star"});e.FE.RegisterCommand("videoDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(e,t){this.video.display(t)},refresh:function(e){if(!this.opts.videoTextNear)e.addClass("fr-hidden")},refreshOnShow:function(e,t){this.video.refreshDisplayOnShow(e,t)}});e.FE.DefineIcon("video-align",{NAME:"align-left"});e.FE.DefineIcon("video-align-left",{NAME:"align-left"});e.FE.DefineIcon("video-align-right",{NAME:"align-right"});e.FE.DefineIcon("video-align-center",{NAME:"align-justify"});e.FE.DefineIcon("videoAlign",{NAME:"align-center"});e.FE.RegisterCommand("videoAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"None",right:"Align Right"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">';var i=e.FE.COMMANDS.videoAlign.options;for(var r in i){if(i.hasOwnProperty(r)){t+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="videoAlign" data-param1="'+r+'" title="'+this.language.translate(i[r])+'">'+this.icon.create("video-align-"+r)+'<span class="fr-sr-only">'+this.language.translate(i[r])+"</span></a></li>"}}t+="</ul>";return t},callback:function(e,t){this.video.align(t)},refresh:function(e){this.video.refreshAlign(e)},refreshOnShow:function(e,t){this.video.refreshAlignOnShow(e,t)}});e.FE.DefineIcon("videoReplace",{NAME:"exchange"});e.FE.RegisterCommand("videoReplace",{title:"Replace",undo:false,focus:false,popup:true,refreshAfterCallback:false,callback:function(){this.video.replace()}});e.FE.DefineIcon("videoRemove",{NAME:"trash"});e.FE.RegisterCommand("videoRemove",{title:"Remove",callback:function(){this.video.remove()}});e.FE.DefineIcon("videoSize",{NAME:"arrows-alt"});e.FE.RegisterCommand("videoSize",{undo:false,focus:false,popup:true,title:"Change Size",callback:function(){this.video.showSizePopup()}});e.FE.DefineIcon("videoBack",{NAME:"arrow-left"});e.FE.RegisterCommand("videoBack",{title:"Back",undo:false,focus:false,back:true,callback:function(){this.video.back()},refresh:function(e){var t=this.video.get();if(!t&&!this.opts.toolbarInline){e.addClass("fr-hidden");e.next(".fr-separator").addClass("fr-hidden")}else{e.removeClass("fr-hidden");e.next(".fr-separator").removeClass("fr-hidden")}}});e.FE.RegisterCommand("videoDismissError",{title:"OK",undo:false,callback:function(){this.video.hideProgressBar(true)}});e.FE.RegisterCommand("videoSetSize",{undo:true,focus:false,title:"Update",refreshAfterCallback:false,callback:function(){this.video.setSize()}})});